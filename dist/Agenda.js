import{r as o,j as e,C as L,T as z,a6 as V,a8 as C,ae as R,a9 as G,e as F,af as Y,ag as q,X as U}from"./vendor.js";import{D as B}from"./DashboardLayout.js";import{g as M,i as W,b as X}from"./index.js";import{A as H}from"./AgendaFAB.js";import"./logo2.js";function te(){const[l,g]=o.useState([]),[i,r]=o.useState(null),[d,u]=o.useState(!0),[a,v]=o.useState(new Date().getMonth()+1),[c,y]=o.useState(new Date().getFullYear()),[h,w]=o.useState(new Date().toISOString().split("T")[0]),[p,b]=o.useState(null);o.useEffect(()=>{j()},[a,c]);const j=async()=>{u(!0);try{const[t,s]=await Promise.all([M(`/agente/agenda/visite?month=${a}&year=${c}`),M(`/agente/agenda/statistiche?month=${a}&year=${c}`)]);g(t||[]),r(s||null)}catch(t){console.error("Errore caricamento dati:",t)}finally{u(!1)}},T=async t=>{if(confirm("Sei sicuro di voler eliminare questa visita?"))try{await W(`/agente/agenda/visite/${t}`),j()}catch(s){console.error("Errore eliminazione:",s),alert("Errore nell'eliminazione della visita")}},A=t=>{b(t)},k=async t=>{try{await X(`/agente/agenda/visite/${p.ID}`,t),b(null),j()}catch(s){console.error("Errore aggiornamento:",s),alert("Errore nell'aggiornamento della visita")}},I=o.useMemo(()=>{const t=new Date(c,a-1,1),n=new Date(c,a,0).getDate(),x=t.getDay(),f=[];for(let m=0;m<x;m++)f.push(null);for(let m=1;m<=n;m++){const N=`${c}-${String(a).padStart(2,"0")}-${String(m).padStart(2,"0")}`,P=l.filter(O=>O.DataVisita===N);f.push({day:m,date:N,visite:P,isToday:N===new Date().toISOString().split("T")[0]})}return f},[c,a,l]),D=o.useMemo(()=>l.filter(t=>t.DataVisita===h).sort((t,s)=>(t.OraInizio||"").localeCompare(s.OraInizio||"")),[l,h]),$=t=>t<60?"bg-green-100 text-green-700 border-green-200":t<=120?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-red-100 text-red-700 border-red-200",S=t=>{const s=Math.floor(t/60),n=t%60;return s===0?`${n}min`:n===0?`${s}h`:`${s}h ${n}min`},E=t=>{if(!t)return"N/D";if(typeof t=="string"){const s=t.trim(),n=s.match(/^(\d{2}):(\d{2})/);if(n)return`${n[1]}:${n[2]}`;const x=new Date(s);if(!isNaN(x))return x.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}else{const s=new Date(t);if(!isNaN(s))return s.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}return"N/D"};return e.jsxs(B,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ðŸ“… Agenda Visite"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gestisci le tue visite ai dealer"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("select",{value:a,onChange:t=>v(parseInt(t.target.value)),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500",children:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"].map((t,s)=>e.jsx("option",{value:s+1,children:t},s))}),e.jsx("select",{value:c,onChange:t=>y(parseInt(t.target.value)),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500",children:[2024,2025,2026].map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),i&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Visite Totali"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:i.statistiche?.TotaleVisite||0})]}),e.jsx(L,{className:"w-8 h-8 text-blue-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 font-medium",children:"Completate"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:i.statistiche?.VisiteCompletate||0})]}),e.jsx(z,{className:"w-8 h-8 text-green-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Dealer Visitati"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:i.statistiche?.DealerVisitati||0})]}),e.jsx(V,{className:"w-8 h-8 text-purple-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-4 border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-orange-600 font-medium",children:"Ore Totali"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:[Math.round((i.statistiche?.MinutiTotali||0)/60),"h"]})]}),e.jsx(C,{className:"w-8 h-8 text-orange-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4 border border-pink-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-pink-600 font-medium",children:"Programmate"}),e.jsx("p",{className:"text-2xl font-bold text-pink-900",children:i.statistiche?.VisiteProgrammate||0})]}),e.jsx(R,{className:"w-8 h-8 text-pink-600 opacity-50"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Calendario"}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"].map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:I.map((t,s)=>{if(!t)return e.jsx("div",{className:"aspect-square"},`empty-${s}`);const n=t.date===h,x=t.visite.length>0;return e.jsxs("button",{onClick:()=>w(t.date),className:`aspect-square rounded-lg border-2 transition-all relative ${n?"border-blue-500 bg-blue-50":t.isToday?"border-blue-300 bg-blue-50/50":x?"border-green-200 bg-green-50 hover:border-green-300":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.day}),x&&e.jsx("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),t.visite.length>1&&e.jsx("div",{className:"absolute top-1 right-1 text-[10px] bg-green-500 text-white rounded-full w-4 h-4 flex items-center justify-center",children:t.visite.length})]},t.date)})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:["Visite del ",new Date(h).toLocaleDateString("it-IT",{day:"numeric",month:"long"})]}),d?e.jsx("div",{className:"text-sm text-gray-500",children:"Caricamento..."}):D.length===0?e.jsx("div",{className:"text-sm text-gray-500 text-center py-8",children:"Nessuna visita programmata"}):e.jsx("div",{className:"space-y-3",children:D.map(t=>e.jsxs("div",{className:`border-2 rounded-lg p-3 ${$(t.DurataMinuti)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1 text-xs text-gray-600",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:E(t.OraInizio)}),e.jsxs("span",{children:["(",S(t.DurataMinuti),")"]}),e.jsx("span",{className:"text-[11px] text-gray-500",children:new Date(t.DataVisita).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs mb-1",children:[e.jsx(V,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:t.RagioneSocialeDealer})]}),t.Referente&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs mb-1",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{children:t.Referente})]}),t.Argomento&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx(F,{className:"w-3 h-3"}),e.jsx("span",{children:t.Argomento})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>A(t),className:"p-1 hover:bg-white/50 rounded transition-colors",title:"Modifica",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>T(t.ID),className:"p-1 hover:bg-white/50 rounded transition-colors",title:"Elimina",children:e.jsx(q,{className:"w-4 h-4"})})]})]}),t.Note&&e.jsx("div",{className:"text-xs mt-2 pt-2 border-t border-current/20",children:t.Note}),e.jsx("div",{className:"mt-2 pt-2 border-t border-current/20",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t.StatoVisita==="COMPLETATA"?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,children:t.StatoVisita})})]},t.ID))})]})})]}),i&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"ðŸ† Top Dealer Visitati"}),i.topDealers?.length>0?e.jsx("div",{className:"space-y-3",children:i.topDealers.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold text-sm",children:s+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:t.RagioneSocialeDealer}),e.jsxs("div",{className:"text-xs text-gray-500",children:[S(t.MinutiTotali||0)," totali"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-blue-600",children:t.NumVisite}),e.jsx("div",{className:"text-xs text-gray-500",children:"visite"})]})]},t.IDDealer))}):e.jsx("div",{className:"text-sm text-gray-500 text-center py-8",children:"Nessun dato disponibile"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"ðŸ’¬ Argomenti PiÃ¹ Trattati"}),i.topArgomenti?.length>0?e.jsx("div",{className:"space-y-3",children:i.topArgomenti.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center font-bold text-sm",children:s+1}),e.jsx("div",{className:"font-medium text-sm text-gray-900",children:t.Argomento})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-purple-600",children:t.NumVisite}),e.jsx("div",{className:"text-xs text-gray-500",children:"volte"})]})]},s))}):e.jsx("div",{className:"text-sm text-gray-500 text-center py-8",children:"Nessun dato disponibile"})]})]})]}),p&&e.jsx(J,{visita:p,onClose:()=>b(null),onSave:k}),e.jsx(H,{onVisitaCreated:t=>{if(t?.dataVisita){const s=new Date(t.dataVisita);v(s.getMonth()+1),y(s.getFullYear()),w(t.dataVisita)}}})]})}function J({visita:l,onClose:g,onSave:i}){const[r,d]=o.useState({dataVisita:l.DataVisita,oraInizio:l.OraInizio?.slice(0,5),durataMinuti:l.DurataMinuti,referente:l.Referente||"",argomento:l.Argomento||"",note:l.Note||"",statoVisita:l.StatoVisita}),u=a=>{a.preventDefault(),i(r)};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:g}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl w-full max-w-md p-6 m-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Modifica Visita"}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data"}),e.jsx("input",{type:"date",value:r.dataVisita,onChange:a=>d({...r,dataVisita:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ora"}),e.jsx("input",{type:"time",value:r.oraInizio,onChange:a=>d({...r,oraInizio:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Durata"}),e.jsxs("select",{value:r.durataMinuti,onChange:a=>d({...r,durataMinuti:parseInt(a.target.value)}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[e.jsx("option",{value:15,children:"15 minuti"}),e.jsx("option",{value:30,children:"30 minuti"}),e.jsx("option",{value:45,children:"45 minuti"}),e.jsx("option",{value:60,children:"1 ora"}),e.jsx("option",{value:90,children:"1 ora e 30 min"}),e.jsx("option",{value:120,children:"2 ore"}),e.jsx("option",{value:180,children:"3 ore"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Referente"}),e.jsx("input",{type:"text",value:r.referente,onChange:a=>d({...r,referente:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Argomento"}),e.jsx("input",{type:"text",value:r.argomento,onChange:a=>d({...r,argomento:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note"}),e.jsx("textarea",{value:r.note,onChange:a=>d({...r,note:a.target.value}),rows:3,className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stato"}),e.jsxs("select",{value:r.statoVisita,onChange:a=>d({...r,statoVisita:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"PROGRAMMATA",children:"Programmata"}),e.jsx("option",{value:"COMPLETATA",children:"Completata"}),e.jsx("option",{value:"ANNULLATA",children:"Annullata"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Annulla"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Salva"})]})]})]})]})}export{te as default};
