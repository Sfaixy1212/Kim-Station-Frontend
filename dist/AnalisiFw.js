import{r as o,j as e,i as A,k as w,l as z,m as M,Y as T,o as S,p as F,q as g,z as P}from"./vendor.js";import{S as R}from"./Topbar2.js";import{C as l}from"./Card.js";import{e as I}from"./index.js";const k=[{value:"DEALER",label:"Dealer"},{value:"AGENTE",label:"Agenti"}],a=i=>new Intl.NumberFormat("it-IT",{maximumFractionDigits:0}).format(Number(i||0)),D=i=>new Intl.NumberFormat("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2}).format(Number(i||0)),C=Array.from({length:12},(i,r)=>({value:r+1,label:new Date(2e3,r,1).toLocaleDateString("it-IT",{month:"long"})})),B=Array.from({length:4},(i,r)=>{const c=new Date().getFullYear()-r;return{value:c,label:String(c)}}),H=()=>{const i=new Date,r=new Date(i.getFullYear(),i.getMonth()-1,1);return{year:r.getFullYear(),month:r.getMonth()+1}};function O(){const[i,r]=o.useState("DEALER"),[{year:d,month:c},u]=o.useState(H),[p,b]=o.useState(!1),[m,j]=o.useState([]),[h,N]=o.useState(""),n=o.useMemo(()=>m.length?m.reduce((t,s)=>(t.totAttivazioni+=Number(s.TotAttivazioni||0),t.attivazioniFisso+=Number(s.AttivazioniFisso||0),t.attivazioniMobile+=Number(s.AttivazioniMobile||0),t.bonus+=Number(s.BonusRicAutoTot||0),t.penalita+=Number(s.PenalitaVodafoneHoTot||0),t.punteggioTotale+=Number(s.PunteggioTotale||0),t.ricAuto+=Number(s.AttivazioniRicAuto||0),t.vodafoneHo+=Number(s.AttivazioniVodafoneHo||0),t),{totAttivazioni:0,attivazioniFisso:0,attivazioniMobile:0,bonus:0,penalita:0,punteggioTotale:0,ricAuto:0,vodafoneHo:0}):{totAttivazioni:0,attivazioniFisso:0,attivazioniMobile:0,bonus:0,penalita:0,punteggioTotale:0,ricAuto:0,vodafoneHo:0},[m]),f=async()=>{try{b(!0),N("");const t=await I({scope:i,year:d,month:c});j(t?.rows||[])}catch(t){console.error("[AnalisiFw] loadData error:",t);const s=t?.message||"Errore durante il caricamento dei dati";N(s),P.error(s),j([])}finally{b(!1)}};o.useEffect(()=>{f()},[i,d,c]);const x=o.useMemo(()=>[...m].sort((t,s)=>Number(s.PunteggioTotale||0)-Number(t.PunteggioTotale||0)),[m]),y=o.useMemo(()=>x.slice(0,10).map(t=>({name:t.EntityName,fisso:Number(t.AttivazioniFisso||0),mobile:Number(t.AttivazioniMobile||0)})),[x]),v=o.useMemo(()=>x.slice(0,10).map(t=>({name:t.EntityName,bonus:Number(t.BonusRicAutoTot||0),penalita:Math.abs(Number(t.PenalitaVodafoneHoTot||0))})),[x]),E=new Date(d||new Date().getFullYear(),(c||1)-1,1).toLocaleDateString("it-IT",{month:"long",year:"numeric"});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(R,{}),e.jsx("main",{className:"px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Analisi FW"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Ultimo ranking Fastweb aggiornato sull’ultimo batch disponibile del periodo selezionato."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("select",{value:i,onChange:t=>r(t.target.value),className:"text-sm border-gray-300 rounded-md px-3 py-2 bg-white shadow-sm focus:ring-blue-500 focus:border-blue-500",children:k.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("select",{value:c,onChange:t=>u(s=>({...s,month:Number(t.target.value)})),className:"text-sm border-gray-300 rounded-md px-3 py-2 bg-white shadow-sm focus:ring-blue-500 focus:border-blue-500",children:C.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("select",{value:d,onChange:t=>u(s=>({...s,year:Number(t.target.value)})),className:"text-sm border-gray-300 rounded-md px-3 py-2 bg-white shadow-sm focus:ring-blue-500 focus:border-blue-500",children:B.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs("button",{onClick:f,className:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md border border-gray-300 bg-white shadow-sm hover:bg-gray-50",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-4.99m0 0l-3.535 3.535A9 9 0 104.5 19.5"})}),"Aggiorna"]})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Periodo"}),e.jsx("div",{className:"text-lg font-medium text-gray-900",children:E})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(l,{className:"bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:"Totale attivazioni"}),e.jsx("div",{className:"text-2xl font-semibold text-gray-900 mt-1",children:a(n.totAttivazioni)})]}),e.jsxs(l,{className:"bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:"Fisso"}),e.jsx("div",{className:"text-2xl font-semibold text-gray-900 mt-1",children:a(n.attivazioniFisso)})]}),e.jsxs(l,{className:"bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:"Mobile"}),e.jsx("div",{className:"text-2xl font-semibold text-gray-900 mt-1",children:a(n.attivazioniMobile)})]}),e.jsxs(l,{className:"bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:"Score complessivo"}),e.jsx("div",{className:"text-2xl font-semibold text-gray-900 mt-1",children:D(n.punteggioTotale)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4",children:[e.jsxs(l,{className:"bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:"Bonus RA"}),e.jsxs("div",{className:"text-lg font-semibold text-emerald-600 mt-1",children:["+",a(n.bonus)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Credito extra assegnato per SIM in ricarica automatica."})]}),e.jsxs(l,{className:"bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:"Penalità MNP Vodafone/Ho"}),e.jsx("div",{className:"text-lg font-semibold text-rose-600 mt-1",children:a(n.penalita)}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Penalità applicata alle portabilità da Vodafone o Ho."})]}),e.jsxs(l,{className:"bg-white",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500",children:"SIM RA / MNP critiche"}),e.jsxs("div",{className:"flex items-baseline gap-2 mt-1",children:[e.jsx("span",{className:"text-lg font-semibold text-blue-600",children:a(n.ricAuto)}),e.jsx("span",{className:"text-sm text-gray-400",children:"RA"}),e.jsx("span",{className:"text-base font-semibold text-orange-500",children:a(n.vodafoneHo)}),e.jsx("span",{className:"text-sm text-gray-400",children:"MNP"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Confronto tra RA attive e portabilità da operatori penalizzanti."})]})]}),e.jsx(l,{title:"Legenda punteggi Fastweb",className:"mt-6",children:e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("p",{children:["Il ranking è ordinato per ",e.jsx("strong",{children:"Punteggio Totale"}),", calcolato sommando base score, bonus e penalità su tutte le attivazioni dell’ultimo batch del periodo selezionato."]}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Base score"}),": per ogni attivazione viene sommato il valore configurato in `fastweb_quality_weights` (1 = entry, 5 = mid, 7 = top) in funzione del piano normalizzato."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bonus RA"}),": +5 punti per ciascuna SIM mobile con ricarica automatica (`TipoRicarica = AUTOMATICA`). Il bonus è moltiplicato per il numero di SIM registrato sull’ordine."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Penalità MNP Vodafone/Ho"}),": −5 punti per ogni SIM mobile portata da Vodafone, Ho o Ho.Mobile."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tot/Fisso/Mobile"}),": conteggio delle attivazioni ponderate (incluse multi-SIM). Le colonne RA e MNP riportano rispettivamente quante SIM hanno ricevuto bonus o penalità."]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"I pesi e le categorie sono allineati al dizionario offerte Fastweb mantenuto in `KAM.dbo.fastweb_offerte_base` / `fastweb_offerte_syn`."})]})})]}),e.jsxs("section",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[e.jsx(l,{title:"Mix attivazioni Fisso vs Mobile",subtitle:`Top 10 ${i==="DEALER"?"dealer":"agenti"} per punteggio`,className:"h-full",children:y.length?e.jsx("div",{className:"h-80",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(w,{data:y,margin:{top:16,right:24,left:0,bottom:8},children:[e.jsx(z,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(M,{dataKey:"name",tick:{fontSize:10},interval:0,angle:-35,textAnchor:"end",height:80}),e.jsx(T,{allowDecimals:!1,tick:{fontSize:12}}),e.jsx(S,{formatter:(t,s)=>[a(t),s==="fisso"?"Fisso":"Mobile"]}),e.jsx(F,{wrapperStyle:{fontSize:12}}),e.jsx(g,{dataKey:"fisso",stackId:"mix",fill:"#3B82F6",radius:[4,4,0,0]}),e.jsx(g,{dataKey:"mobile",stackId:"mix",fill:"#22C55E",radius:[4,4,0,0]})]})})}):e.jsx("p",{className:"text-sm text-gray-500",children:"Nessun dato disponibile per il grafico."})}),e.jsx(l,{title:"Bonus vs Penalità",subtitle:"Impatto su punteggio (Top 10)",className:"h-full",children:v.length?e.jsx("div",{className:"h-80",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(w,{data:v,margin:{top:16,right:24,left:0,bottom:8},children:[e.jsx(z,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(M,{dataKey:"name",tick:{fontSize:10},interval:0,angle:-35,textAnchor:"end",height:80}),e.jsx(T,{allowDecimals:!1,tick:{fontSize:12}}),e.jsx(S,{formatter:(t,s)=>[a(t),s==="bonus"?"Bonus RA":"Penalità MNP"]}),e.jsx(F,{wrapperStyle:{fontSize:12}}),e.jsx(g,{dataKey:"bonus",fill:"#10B981",radius:[4,4,0,0]}),e.jsx(g,{dataKey:"penalita",fill:"#F97316",radius:[4,4,0,0]})]})})}):e.jsx("p",{className:"text-sm text-gray-500",children:"Nessun dato disponibile per il grafico."})})]}),e.jsxs("section",{className:"bg-white shadow-sm border border-gray-200 rounded-xl",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Classifica ",i==="DEALER"?"dealer":"agenti"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ordine per punteggio totale. Include breakdown Fisso/Mobile e bonus/penalità."})]}),p&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Caricamento..."]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:i==="DEALER"?"Dealer":"Agente"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Tot"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Fisso"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Mobile"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Bonus"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Penalità"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Score"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"RA"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"MNP Vod/Ho"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[h&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-4 py-6 text-center text-sm text-rose-600",children:h})}),!h&&!p&&x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-4 py-6 text-center text-sm text-gray-500",children:"Nessun dato disponibile per il periodo selezionato."})}),!h&&x.map((t,s)=>e.jsxs("tr",{className:s===0?"bg-yellow-50/60":"",children:[e.jsx("td",{className:"px-4 py-3 text-xs font-semibold text-gray-500",children:s+1}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.EntityName}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold text-gray-900",children:a(t.TotAttivazioni)}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-700",children:a(t.AttivazioniFisso)}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-700",children:a(t.AttivazioniMobile)}),e.jsxs("td",{className:"px-4 py-3 text-right text-emerald-600 font-medium",children:["+",a(t.BonusRicAutoTot)]}),e.jsx("td",{className:"px-4 py-3 text-right text-rose-600 font-medium",children:a(t.PenalitaVodafoneHoTot)}),e.jsx("td",{className:"px-4 py-3 text-right text-blue-700 font-semibold",children:D(t.PunteggioTotale)}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-700",children:a(t.AttivazioniRicAuto)}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-700",children:a(t.AttivazioniVodafoneHo)})]},`${t.EntityName}-${s}`))]})]})})]})]})})]})}export{O as default};
