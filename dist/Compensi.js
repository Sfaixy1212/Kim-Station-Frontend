import{r as h,z as O,j as e}from"./vendor.js";import{S as q}from"./Topbar2.js";import{C as M}from"./Card.js";import{g as I,c as H}from"./index.js";const c=l=>new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(Number(l||0)),b=l=>new Intl.NumberFormat("it-IT",{maximumFractionDigits:0}).format(Number(l||0)),D=l=>l?new Date(l).toLocaleDateString("it-IT",{month:"long",year:"numeric"}):"",Z={BONUS:"Bonus",CONTRIBUTO:"Contributi",DETTAGLIO_FISSO:"Dettaglio Fisso",DETTAGLIO_SIM_EXTRA:"Dettaglio SIM Extra",FW_RA_EXTRA:"Fastweb RA Extra",FW_RA_EXTRA_DETT:"Dettaglio Fastweb RA Extra",PRODOTTO:"Prodotti",PRODOTTI:"Prodotti",PRODOTTO_DETT:"Dettaglio Prodotti",SIM:"SIM",SIM_BASE:"SIM Base"},J={"BONUS FISSI":"Bonus Fissi",FISSI:"Bonus Fissi","RIMBORSO SPESE":"Rimborso Spese",FW_FISSO_CONV:"Fastweb Fisso Convergenza",FULL:"Full & Maxi","FW MOBILE":"Fastweb Mobile",MAXI:"Mobile Ultra/Maxi","FW ENERGY":"Fastweb Energy",FW_ENERGY:"Fastweb Energy","FW FISSO":"Fastweb Fisso",FW_FISSO:"Fastweb Fisso","SKY CORE":"Sky Core",SKY_CORE:"Sky Core","COMPENSO BASE":"Compenso Base","EXTRA RIC. AUTO":"Extra Ricarica Automatica",FW_RA:"Fastweb RA",FW_RA_EXTRA:"Fastweb RA Extra",FW_RA_EXTRA_DETT:"Dettaglio RA Extra","1MOBILE":"1Mobile",FASTWEB:"Fastweb",ILIAD:"Iliad",SKY:"Sky"},ee=l=>l?String(l).replace(/[_\s]+/g," ").split(" ").filter(Boolean).map(m=>m.length<=3?m.toUpperCase():m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()).join(" "):"",Y=(l,m,u)=>{if(!l)return u;if(m&&Object.prototype.hasOwnProperty.call(m,l))return m[l];const p=String(l).toUpperCase();return m&&Object.prototype.hasOwnProperty.call(m,p)?m[p]:(console.log("[COMPENSI] No label match for:",l,"| upper:",p),ee(p))},te=l=>Y(l,Z,"Altro"),se=l=>Y(l,J,"Generale");function ie({title:l,value:m,icon:u,definition:p,onClick:_,isActive:v}){const[N,R]=h.useState(!1),y=typeof _=="function";return e.jsxs("div",{className:`relative bg-white border rounded-lg shadow-sm p-4 transition-all ${y?`cursor-pointer hover:shadow-md ${v?"ring-2 ring-blue-500 bg-blue-50":"hover:bg-gray-50"}`:"cursor-default"}`,onClick:y?_:void 0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:l}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-lg",children:u})})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:m}),N&&e.jsxs("div",{className:"absolute z-10 bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg max-w-xs",children:[p,e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]})}function ae({title:l,value:m,icon:u,onClick:p,color:_="blue"}){const v={blue:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",green:"bg-green-50 border-green-200 text-green-700 hover:bg-green-100",purple:"bg-purple-50 border-purple-200 text-purple-700 hover:bg-purple-100",orange:"bg-orange-50 border-orange-200 text-orange-700 hover:bg-orange-100",gray:"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"};return e.jsxs("div",{className:`border rounded-lg shadow-sm p-4 transition-all cursor-pointer ${v[_]}`,onClick:p,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase tracking-wide",children:l}),e.jsx("span",{className:"text-lg",children:u})]}),e.jsx("div",{className:"text-xl font-bold",children:m})]})}function ue(){const[l,m]=h.useState({months:[],agents:[]}),[u,p]=h.useState(""),[_,v]=h.useState(""),[N,R]=h.useState([]),[y,F]=h.useState(!1),[re,P]=h.useState(""),[V,k]=h.useState(!1),[g,oe]=h.useState({loading:!1,rows:[],title:"",summary:null}),[le,ne]=h.useState(!1),[z,A]=h.useState(!1),[W,T]=h.useState(!1),[E,C]=h.useState({loading:!1,rows:[],title:"",type:""});h.useEffect(()=>{let t=!0;return(async()=>{try{const r=await I("/compensi/filters?v=3&t="+Date.now()),o=Array.isArray(r?.months)?r.months:[],n=Array.isArray(r?.agents)?r.agents:[],i=o,a=new Set(["GIACOMO","LUIGI"]),j=Array.from(new Set(n.map(s=>String(s||"").trim()).filter(s=>s.length>0).map(s=>s.toUpperCase()).filter(s=>a.has(s))));if(!t)return;m({months:i,agents:j}),p(""),v("")}catch{O.error("Errore nel caricamento filtri")}})(),()=>{t=!1}},[]);const w=()=>u?`${u.slice(0,7)}-01`:"",B=async()=>{if(!N.length||y)return;const t=new URLSearchParams,r=w();r&&t.set("monthStart",r),_&&t.set("agente",_);try{const o=await H(`/compensi/export${t.toString()?`?${t.toString()}`:""}`),n=URL.createObjectURL(o),i=document.createElement("a"),a=u?u.replace(/[^0-9A-Za-z_-]/g,"-"):"tutti";i.href=n,i.download=`compensi_agenti_${a}.xlsx`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}catch(o){console.error("[COMPENSI][export] errore export XLSX:",o),O.error("Errore durante l'esportazione")}},U=async()=>{const t=new URLSearchParams,r=w();r&&t.set("monthStart",r),_&&t.set("agente",_),F(!0),P("");try{const o=await I(`/compensi${t.toString()?`?${t.toString()}`:""}`),n=Array.isArray(o?.rows)?o.rows:[],i=(s,d)=>{for(const S of d){const f=[S,S.toLowerCase(),S.toUpperCase()];for(const L of f)if(Object.prototype.hasOwnProperty.call(s,L))return s[L]}},a=s=>{const d=Number(s);return Number.isFinite(d)?d:0},j=n.map(s=>({MonthStart:i(s,["MonthStart","month_start"])||s.MonthStart||s.monthStart,MESE_LABEL:i(s,["MESE_LABEL","mese_label","meseLabel"])||s.MESE_LABEL||s.meseLabel,Agente:i(s,["Agente","agente"])||s.Agente||s.agente,Fissi_Pda:a(i(s,["Fissi_Pda"])),Mobile_Pda:a(i(s,["Mobile_Pda"])),Perc_RA_su_Mobile:a(i(s,["Perc_RA_su_Mobile"])),Sim_RA_Tot:a(i(s,["Sim_RA_Tot"])),Sim_RA_Conv:a(i(s,["Sim_RA_Conv"])),Sim_RA_OnlyMobile:a(i(s,["Sim_RA_OnlyMobile"])),Mobile_Pura_Pda:a(i(s,["Mobile_Pura_Pda"])),Energy_Pda:a(i(s,["Energy_Pda"])),Sky_Pda:a(i(s,["Sky_Pda"])),Sim_Vendute:a(i(s,["Sim_Vendute","SimTotali_Vendute"])),Euro_RA:a(i(s,["Euro_RA"])),Euro_Prodotti:a(i(s,["Euro_Prodotti"])),Euro_SimVendute:a(i(s,["Euro_SimVendute"])),Euro_Bonus:a(i(s,["Euro_Bonus"])),Euro_Contributo:a(i(s,["Euro_Contributo"])),Euro_Bonus_MobileAuto:a(i(s,["Euro_Bonus_MobileAuto"])),Euro_Extra_FissiComposizione:a(i(s,["Euro_Extra_FissiComposizione"])),Euro_Totale_Completo:a(i(s,["Euro_Totale_Completo"])),Euro_Totale:a(i(s,["Euro_Totale_Completo","Euro_Totale"])),SimTotali_Vendute:a(i(s,["Sim_Vendute","SimTotali_Vendute","TOT_SIM_QTY"])),FW_FISSI_QTY:a(i(s,["Fissi_Pda","FW_FISSI_QTY"])),FW_RA_SIMS_QTY:a(i(s,["Sim_RA_Tot","FW_RA_SIMS_QTY","FW_SIM_RA"])),FW_RA_IN_CONV_QTY:a(i(s,["Sim_RA_Conv","FW_RA_IN_CONV_QTY","FW_RA_IN_CONV","FW_CONV_RA"])),FW_RA_ONLYMOBILE_QTY:a(i(s,["Sim_RA_OnlyMobile","FW_RA_ONLYMOBILE_QTY","FW_RA_ONLYMOBILE","FW_ONLYMOB_RA"])),FW_ENERGY_QTY:a(i(s,["Energy_Pda","FW_ENERGY_QTY"])),SKY_CORE_QTY:a(i(s,["Sky_Pda","SKY_CORE_QTY"])),TOT_SIM_QTY:a(i(s,["Sim_Vendute","SimTotali_Vendute","TOT_SIM_QTY"])),EURO_FW_FISSI:a(i(s,["Euro_Prodotti","EURO_FW_FISSI"])),EURO_FW_RA_EXTRA:a(i(s,["Euro_RA","EURO_FW_RA_EXTRA"])),EURO_SIM_BASE:a(i(s,["Euro_SimVendute","EURO_SIM_BASE"])),EURO_FW_ENERGY:a(i(s,["Euro_Prodotti","EURO_FW_ENERGY"])),EURO_SKY_CORE:a(i(s,["Euro_Prodotti","EURO_SKY_CORE"])),BONUS_FISSI:a(i(s,["Euro_Bonus","BONUS_FISSI"])),BONUS_ENERGY:a(i(s,["Euro_Bonus","BONUS_ENERGY"])),EURO_CONTRIBUTO:a(i(s,["Euro_Contributo","EURO_CONTRIBUTO"])),EURO_TOTALE:a(i(s,["Euro_Totale","EURO_TOTALE"]))}));if(R(j),n.length===0)try{O.dismiss(),O("Nessun dato per i filtri selezionati",{icon:"‚ÑπÔ∏è"})}catch{}}catch(o){console.error("[COMPENSI][ERR]",o),P("Errore nel caricamento dati"),R([])}finally{F(!1)}},x=h.useMemo(()=>{const t=o=>N.reduce((n,i)=>n+Number(i[o]||0),0),r=o=>{const n=N.map(i=>Number(i[o]||0)).filter(i=>i>0);return n.length>0?n.reduce((i,a)=>i+a,0)/n.length:0};return{Fissi_Pda:t("Fissi_Pda"),Mobile_Pda:t("Mobile_Pda"),Perc_RA_su_Mobile:r("Perc_RA_su_Mobile"),Sim_RA_Tot:t("Sim_RA_Tot"),Sim_RA_Conv:t("Sim_RA_Conv"),Sim_RA_OnlyMobile:t("Sim_RA_OnlyMobile"),Mobile_Pura_Pda:t("Mobile_Pura_Pda"),Energy_Pda:t("Energy_Pda"),Sky_Pda:t("Sky_Pda"),Sim_Vendute:t("Sim_Vendute"),Euro_RA:t("Euro_RA"),Euro_Prodotti:t("Euro_Prodotti"),Euro_SimVendute:t("Euro_SimVendute"),Euro_Bonus:t("Euro_Bonus"),Euro_Contributo:t("Euro_Contributo"),Euro_Bonus_MobileAuto:t("Euro_Bonus_MobileAuto"),Euro_Extra_FissiComposizione:t("Euro_Extra_FissiComposizione"),Euro_Totale_Completo:t("Euro_Totale_Completo"),Euro_Totale:t("Euro_Totale_Completo")||t("Euro_Totale"),SimTotali_Vendute:t("Sim_Vendute")||t("SimTotali_Vendute")||t("TOT_SIM_QTY"),Euro_Fissi:t("Euro_Prodotti"),Euro_Energy:t("Euro_Prodotti"),Euro_Sky:t("Euro_Prodotti")}},[N]),Q=h.useMemo(()=>{if(!g.rows.length)return[];const t=new Map;return g.rows.forEach(r=>{const o=r.sezione?String(r.sezione):"ALTRO";t.has(o)||t.set(o,[]),t.get(o).push(r)}),Array.from(t.entries()).map(([r,o])=>{const n=new Map;o.forEach(s=>{const d=s.sottoVoce?String(s.sottoVoce):"";n.has(d)||n.set(d,[]),n.get(d).push(s)});const i=Array.from(n.entries()).map(([s,d])=>({key:s,label:s?se(s):"Generale",totalEuro:d.reduce((S,f)=>S+Number(f.euro||0),0),totalQty:d.reduce((S,f)=>S+Number(f.qty||0),0),rows:d.slice().sort((S,f)=>(S.dettaglio||"").localeCompare(f.dettaglio||"","it",{sensitivity:"base"}))})).sort((s,d)=>s.label.localeCompare(d.label,"it",{sensitivity:"base"})),a=o.reduce((s,d)=>s+Number(d.euro||0),0),j=o.reduce((s,d)=>s+Number(d.qty||0),0);return{key:r,label:te(r),totalEuro:a,totalQty:j,subsections:i}}).sort((r,o)=>r.label.localeCompare(o.label,"it",{sensitivity:"base"}))},[g.rows]),$=[{key:"FISSI_PDA",title:"FISSI PDA",value:b(x.Fissi_Pda),icon:"üì∂",definition:"Attivazioni FTTH/FTTC completate"},{key:"MOBILE_PDA",title:"MOBILE PDA",value:b(x.Mobile_Pda),icon:"üì±",definition:"Totale attivazioni Mobile PDA"},{key:"PERC_RA",title:"% RA su Mobile",value:`${(x.Perc_RA_su_Mobile||0).toFixed(1)}%`,icon:"üìä",definition:"Percentuale RA su Mobile totali"},{key:"SIM_RA_TOT",title:"SIM RA (TOT)",value:b(x.Sim_RA_Tot),icon:"üîÅ",definition:"Totale SIM con Ricarica Automatica"},{key:"SIM_RA_CONV",title:"di cui CONV RA",value:b(x.Sim_RA_Conv),icon:"ü§ù",definition:"SIM RA in convergenza (FISSO+MOBILE)"},{key:"SIM_RA_ONLYMOBILE",title:"di cui ONLYMOB. RA",value:b(x.Sim_RA_OnlyMobile),icon:"üì±",definition:"SIM RA solo mobile"},{key:"MOBILE_PURA",title:"Mobile Pura",value:b(x.Mobile_Pura_Pda),icon:"üì≥",definition:"Mobile senza RA (pura)"},{key:"ENERGY_PDA",title:"ENERGY PDA",value:b(x.Energy_Pda),icon:"üîå",definition:"Attivazioni Energy completate"},{key:"SKY_PDA",title:"SKY PDA",value:b(x.Sky_Pda),icon:"üì∫",definition:"Attivazioni Sky completate"},{key:"SIM_VENDUTE",title:"SIM VENDUTE",value:b(x.Sim_Vendute),icon:"üßæ",definition:"Totale SIM vendute nel periodo"}],G=[{key:"EURO_RA",title:"‚Ç¨ RA (TOT)",value:c(x.Euro_RA),icon:"üîÅ",color:"green"},{key:"EURO_PRODOTTI",title:"‚Ç¨ PRODOTTI",value:c(x.Euro_Prodotti),icon:"üì¶",color:"blue"},{key:"EURO_SIM",title:"‚Ç¨ SIM VENDUTE",value:c(x.Euro_SimVendute),icon:"üßæ",color:"purple"},{key:"EURO_BONUS",title:"‚Ç¨ BONUS",value:c(x.Euro_Bonus),icon:"üéØ",color:"orange"},{key:"EURO_BONUS_MOBILEAUTO",title:"‚Ç¨ BONUS MOBILE AUTO",value:c(x.Euro_Bonus_MobileAuto),icon:"üì±",color:"orange"},{key:"EURO_CONTRIBUTO",title:"‚Ç¨ CONTRIBUTO",value:c(x.Euro_Contributo),icon:"üíº",color:"gray"},{key:"EURO_EXTRA_FISSI",title:"‚Ç¨ EXTRA FISSI COMP.",value:c(x.Euro_Extra_FissiComposizione),icon:"üè†",color:"blue"},{key:"EURO_TOTALE",title:"‚Ç¨ TOTALE COMPLETO",value:c(x.Euro_Totale),icon:"üí∂",color:"green"}],X=async(t,r)=>{try{T(!0),C({loading:!0,rows:[],title:r,type:t});const o=new URLSearchParams,n=w();n&&o.set("monthStart",n),_&&o.set("agente",_);const i=await I(`/compensi/breakdown?${o.toString()}`),j=(Array.isArray(i?.rows)?i.rows:[]).filter(s=>{const d=String(s.sezione||"").toUpperCase();switch(t){case"EURO_RA":return d.includes("MOBILE_RA");case"EURO_FISSI":return d.includes("PRODOTTO")&&String(s.dettaglio||"").includes("FISSO");case"EURO_ENERGY":return d.includes("PRODOTTO")&&String(s.dettaglio||"").includes("ENERGY");case"EURO_SKY":return d.includes("PRODOTTO")&&String(s.dettaglio||"").includes("SKY");case"EURO_SIM":return d.includes("SIM_BASE");case"EURO_BONUS":return d.includes("BONUS");case"EURO_CONTRIBUTO":return d.includes("CONTRIBUTO");default:return!0}});C({loading:!1,rows:j,title:r,type:t})}catch{C({loading:!1,rows:[],title:r,type:t}),O.error("Errore nel caricamento breakdown")}},K=()=>{l.months.length>0&&p(l.months[0].monthStart?.slice(0,10)),v(""),R([])};return e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Compensi Agenti"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[u?`Dati per ${D(u)}`:"Dati aggregati tutti i mesi",N.length>0&&` ‚Ä¢ ${N.length} agenti`]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>A(!0),className:"px-3 py-2 text-xs rounded-md border text-gray-600 hover:bg-gray-50",children:"üìñ Definizioni"})})]}),e.jsx(M,{title:"Filtri & Ricerca",children:e.jsx("form",{onSubmit:t=>{t.preventDefault(),U()},children:e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Mese"}),e.jsxs("select",{className:"border-gray-300 rounded-md text-sm",value:u,onChange:t=>p(t.target.value),children:[e.jsx("option",{value:"",children:"-- Seleziona mese --"}),l.months.filter(t=>t.monthStart&&String(t.monthStart).trim()!=="").map(t=>e.jsx("option",{value:String(t.monthStart).slice(0,10),children:t.meseLabel},String(t.monthStart)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Agente"}),e.jsxs("select",{className:"border-gray-300 rounded-md text-sm",value:_,onChange:t=>v(t.target.value),children:[e.jsx("option",{value:"",children:"Tutti gli agenti"}),l.agents.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("button",{type:"submit",disabled:y,className:`px-4 py-2 text-sm rounded-md text-white font-medium ${y?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:y?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"Caricamento..."]}):"üîç Cerca"}),e.jsx("button",{type:"button",onClick:K,className:"px-3 py-2 text-sm rounded-md border text-gray-700 hover:bg-gray-50",children:"‚Üª Reset"}),e.jsx("button",{type:"button",disabled:y,onClick:()=>{N.length?B():U().then(()=>B())},className:`ml-auto px-3 py-2 text-sm rounded-md border ${y?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-50"}`,children:"üìä Esporta XLSX"})]})})}),y&&e.jsx("div",{className:"w-full h-1 bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"h-1 bg-blue-600 animate-[progress_1.2s_ease-in-out_infinite]",style:{width:"40%"}})}),e.jsx(M,{title:"üìä KPI del Mese",subtitle:"Conteggi attivazioni del periodo selezionato",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-4",children:$.map(t=>e.jsx(ie,{title:t.title,value:t.value,icon:t.icon,definition:t.definition,onClick:null,isActive:!1},t.key))})}),e.jsx(M,{title:"üí∂ Compensi in Euro",subtitle:"Clicca su una card per vedere il breakdown dettagliato",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-8 gap-4",children:G.map(t=>e.jsx(ae,{title:t.title,value:t.value,icon:t.icon,color:t.color,onClick:()=>X(t.key,t.title)},t.key))})}),V&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:()=>k(!1)}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full sm:w-[520px] bg-white shadow-xl p-4 overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"Dettagli extra"}),e.jsx("div",{className:"text-sm text-gray-500",children:g.title})]}),e.jsx("button",{onClick:()=>k(!1),className:"px-3 py-1.5 rounded-md border text-gray-700 hover:bg-gray-50",children:"Chiudi"})]}),g.loading?e.jsx("div",{className:"text-sm text-gray-500",children:"Caricamento‚Ä¶"}):g.rows.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"Nessun dettaglio"}):e.jsxs("div",{className:"space-y-6",children:[g.summary&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Totale compensi"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.totaleCompensi)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"SIM vendute"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:b(g.summary.totaleSim)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Compensi fissi"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.compensiFissi)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Compensi RA"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.compensiRa)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Compensi OnlyMob RA"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.compensiOnlyMob)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Compensi Energy"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.compensiEnergy)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Bonus fissi"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.bonusFissi)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Bonus energy"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.bonusEnergy)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Compensi SKY"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.compensiSky)})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-gray-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Rimborso spese"}),e.jsx("div",{className:"text-base font-semibold text-gray-900",children:c(g.summary.rimborsoSpese)})]})]}),Q.map(t=>e.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:t.label}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:c(t.totalEuro)})]}),e.jsx("div",{className:"divide-y",children:t.subsections.map((r,o)=>e.jsxs("div",{className:"px-4 py-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600",children:r.label}),e.jsxs("div",{className:"text-xs text-gray-500",children:[b(r.totalQty)," elementi ¬∑ ",c(r.totalEuro)]})]}),e.jsx("div",{className:"overflow-auto border rounded-md",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left w-1/2",children:"Dettaglio"}),e.jsx("th",{className:"px-3 py-2 text-right w-1/6",children:"Quantit√†"}),e.jsx("th",{className:"px-3 py-2 text-right w-1/6",children:"Valore unitario"}),e.jsx("th",{className:"px-3 py-2 text-right w-1/6",children:"Importo"})]})}),e.jsx("tbody",{children:r.rows.map((n,i)=>e.jsxs("tr",{className:"border-t last:border-0",children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:n.dettaglio||"‚Äî"}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-700",children:b(n.qty)}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-700",children:c(n.euroUnit)}),e.jsx("td",{className:"px-3 py-2 text-right font-medium text-gray-900",children:c(n.euro)})]},`${t.key}-${r.key||"general"}-${i}`))})]})})]},`${t.key}-${r.key||"general"}-${o}`))})]},t.key))]})]})]}),z&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>A(!1)}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"üìñ Glossario Compensi"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Definizioni operative e calcoli"})]}),e.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 text-sm rounded-md border text-gray-700 hover:bg-gray-50",children:"‚úï Chiudi"})]}),e.jsxs("div",{className:"p-6 overflow-auto max-h-[60vh]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"üî¢ Conteggi (KPI)"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"CONV RA"}),e.jsx("div",{className:"text-blue-700",children:"TIPO=MOBILE & Tipo Ordine=FISSO E MOBILE"})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"OnlyMobile RA"}),e.jsx("div",{className:"text-blue-700",children:"TIPO=MOBILE & Tipo Ordine=MOBILE"})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"RA (Ricarica Automatica)"}),e.jsx("div",{className:"text-blue-700",children:"TipoRicarica='AUTOMATICA' (o 'RA' normalizzato)"})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Fissi PDA"}),e.jsx("div",{className:"text-blue-700",children:"Attivazioni FTTH/FTTC completate"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"üí∂ Compensi"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-900",children:"‚Ç¨ RA (Totale)"}),e.jsx("div",{className:"text-green-700",children:"Somma compensi Conv RA + OnlyMobile RA"})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-900",children:"‚Ç¨ Bonus"}),e.jsx("div",{className:"text-green-700",children:"Bonus raggiungimento soglie (Fissi + Energy)"})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-900",children:"‚Ç¨ Contributo"}),e.jsx("div",{className:"text-green-700",children:"Rimborso spese e contributi vari"})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-900",children:"‚Ç¨ SIM Vendute"}),e.jsx("div",{className:"text-green-700",children:"Compensi base per vendita SIM"})]})]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"‚ÑπÔ∏è Note Tecniche"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Fonte dati:"})," Vista ",e.jsx("code",{children:"vw_compensi_agenti_mese_totale"})," (nuova versione completa)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Breakdown:"})," Funzione ",e.jsx("code",{children:"fn_compensi_agente_breakdown(@MonthStart,@Agente)"})]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Ultimo giorno utile:"})," Dati aggiornati al ",u?new Date(u).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"}):"periodo selezionato"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Cache:"})," Aggiornamento tramite ",e.jsx("code",{children:"sp_refresh_compensi_agenti_mese"})]})]})]})]})]})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:()=>T(!1)}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full sm:w-[600px] bg-white shadow-xl flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"üìä Breakdown Dettagliato"}),e.jsx("div",{className:"text-sm text-gray-500",children:E.title}),u&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[D(u)," ‚Ä¢ ",_||"Tutti gli agenti"]})]}),e.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 text-sm rounded-md border text-gray-700 hover:bg-gray-50",children:"‚úï Chiudi"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 pb-8",children:E.loading?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-600 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Caricamento breakdown..."})]})}):E.rows.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"üìã"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Nessun dettaglio disponibile"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Prova con filtri diversi"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900",children:["Totale ",E.title]}),e.jsx("div",{className:"text-lg font-bold text-blue-900",children:c(E.rows.reduce((t,r)=>t+(Number(r.qty)||0)*(Number(r.euroUnit)||0),0))})]}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:[E.rows.length," elementi ‚Ä¢ ",b(E.rows.reduce((t,r)=>t+Number(r.qty||0),0))," quantit√† totale"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Dettaglio"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-700",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"‚Ç¨ Unit"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700",children:"‚Ç¨ Totale"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:E.rows.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.dettaglio||"‚Äî"}),t.sottoVoce&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[t.sezione==="MOBILE_RA"&&e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${String(t.sottoVoce).includes("CONV")?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:String(t.sottoVoce).includes("CONV")?"ü§ù Convergenza":"üì± OnlyMobile"}),t.sezione!=="MOBILE_RA"&&t.sottoVoce]})]}),e.jsx("td",{className:"px-4 py-3 text-center font-mono",children:b(t.qty)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono",children:c(t.euroUnit)}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:c((Number(t.qty)||0)*(Number(t.euroUnit)||0))})]},r))})]})})]})})]})]})]})]})}export{ue as default};
