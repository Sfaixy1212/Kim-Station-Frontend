import{r,j as e,V}from"./vendor.js";import{D as Ve}from"./DashboardLayout.js";import{g as u,k as h}from"./index.js";import"./logo2.js";function Qe(x){if(!x)return"bg-gray-100 text-gray-800";const c=x.toString().toUpperCase();return c==="PAGATO"||c==="PAGATO CON CC"?"bg-green-100 text-green-800":c==="IN ATTESA PAGAMENTO"?"bg-yellow-100 text-yellow-800":c==="ANNULLATO"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}function Fe(x){if(!x)return"bg-gray-100 text-gray-800";const c=x.toString().toUpperCase();return c==="CONSEGNATO"||c==="SPEDITO"?"bg-green-100 text-green-800":c==="DA SPEDIRE"?"bg-yellow-100 text-yellow-800":c==="ANNULLATO"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}function Ke(){const[x,c]=r.useState([]),[ue,Q]=r.useState(!1),[F,q]=r.useState(null),[j,W]=r.useState(""),[S,he]=r.useState(""),[i,Z]=r.useState(null),[ye,H]=r.useState(!1),[J,K]=r.useState(!1),[y,X]=r.useState(!1),[C,Y]=r.useState(!1),[O,ee]=r.useState(!1),[A,te]=r.useState(!1),[E,se]=r.useState(!1),[fe,ae]=r.useState(0),[je,re]=r.useState(!1),[qe,ie]=r.useState(null),[k,ne]=r.useState([]),[Ne,le]=r.useState(!1),[oe,de]=r.useState(!1),[be,ce]=r.useState(!1),[z,ve]=r.useState([]),[we,xe]=r.useState(!1),[me,pe]=r.useState(null),[N,ge]=r.useState(""),[D,Se]=r.useState(""),[P,Ce]=r.useState(""),[T,Oe]=r.useState(100),[L,b]=r.useState({open:!1,visible:!1,data:null}),[n,M]=r.useState(null),[Ae,I]=r.useState(!1);r.useEffect(()=>{let t=!0;return(async()=>{Q(!0),q(null);try{const a=await u("/masterprodotti/ordini");if(!t)return;c(Array.isArray(a)?a:[])}catch(a){if(!t)return;q(a.message||"Errore caricamento ordini")}finally{t&&Q(!1)}})(),()=>{t=!1}},[]),r.useEffect(()=>{let t=!0;return(async()=>{xe(!0),pe(null);try{const a=Math.max(1,Math.min(200,Number(T)||100)),l=new URLSearchParams;a&&l.set("limit",String(a));const d=Number(P);!Number.isNaN(d)&&d>0&&l.set("days",String(d));const p=l.toString(),w=await u(`/stripe/movimenti${p?`?${p}`:""}`);if(!t)return;const _e=Array.isArray(w)?w:Array.isArray(w?.data)?w.data:[];ve(_e)}catch(a){if(!t)return;pe(a.message||"Errore caricamento movimenti Stripe")}finally{t&&xe(!1)}})(),()=>{t=!1}},[P,T]);const $=r.useMemo(()=>D?z.filter(t=>[t?.data,t?.dealer,t?.tipo,t?.importo,t?.valuta,t?.descrizione].join(" ").toString().toLowerCase().includes(D)):z,[z,D]),Ee=t=>{const s=Number(t);return Number.isNaN(s)?"-":s.toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})},o=t=>{const s=Number(t);return Number.isNaN(s)?"-":s.toLocaleString("it-IT",{style:"currency",currency:"EUR",minimumFractionDigits:2})};r.useEffect(()=>{const t=setTimeout(()=>he(j.trim().toLowerCase()),250);return()=>clearTimeout(t)},[j]),r.useEffect(()=>{const t=setTimeout(()=>Se(N.trim().toLowerCase()),250);return()=>clearTimeout(t)},[N]);const R=r.useMemo(()=>S?x.filter(t=>[t?.Data,t?.IDOrdineProdotto,t?.RagioneSociale,t?.TotaleOrdine,t?.StatoEsteso,t?.Stato_spedizione||t?.stato_spedizione||t?.StatoSpedizioneEsteso,t?.NOTE].join(" ").toString().toLowerCase().includes(S)):x,[x,S]),g=async t=>{if(t)try{X(!0),H(!0),setTimeout(()=>K(!0),0);const s=await u(`/masterprodotti/ordine/${t}`);Z(s)}catch(s){console.error("Errore recupero dettaglio ordine:",s),alert("Errore nel caricamento del dettaglio ordine")}finally{X(!1)}},U=()=>{K(!1),setTimeout(()=>{H(!1),Z(null)},200)},v=t=>t?.IDOrdine||t?.IDOrdineProdotto,ke=t=>{const s=String(t?.StatoEsteso||"").toUpperCase(),a=Number(t?.idStatoOrdineProdotto??t?.IDStatoOrdineProdotto);return s.includes("PAGATO")||a===20||a===22},f=t=>{const s=Array.isArray(t?.prodotti)?t.prodotti:[],a=Array.isArray(t?.Prodotti)?t.Prodotti:[];return s.length?s:a},ze=t=>{const s=f(t);return Array.isArray(s)&&s.some(a=>Number(a?.idOfferta??a?.IDOfferta??a?.id)===446)},De=t=>{const s=f(t);if(!Array.isArray(s)||s.length===0)return!1;let a=!1,l=!1;for(const d of s){const p=Number(d?.idOfferta??d?.IDOfferta??d?.id);if(p&&(p===446?a=!0:l=!0,l&&a))break}return a&&!l},m=async()=>{re(!0),ie(null);try{const t=await u("/ordini/in-attesa-pagamento"),s=Array.isArray(t)?t:Array.isArray(t?.data)?t.data:[];ae(s.length)}catch(t){ie(t?.message||"Errore caricamento badge ordini in attesa")}finally{re(!1)}};r.useEffect(()=>{m()},[]),r.useEffect(()=>{const t=setInterval(()=>{m()},36e5);return()=>clearInterval(t)},[]),r.useEffect(()=>{const t=()=>m(),s=()=>{document.visibilityState==="visible"&&m()};return window.addEventListener("focus",t),document.addEventListener("visibilitychange",s),()=>{window.removeEventListener("focus",t),document.removeEventListener("visibilitychange",s)}},[]);const Pe=async()=>{le(!0),setTimeout(()=>de(!0),0),await B()},G=()=>{de(!1),setTimeout(()=>{le(!1),ne([])},200)},B=async()=>{ce(!0);try{const t=await u("/ordini/in-attesa-pagamento"),s=Array.isArray(t)?t:Array.isArray(t?.data)?t.data:[];ne(s),ae(s.length)}catch(t){alert(`Errore caricamento ordini in attesa: ${t?.message||t}`)}finally{ce(!1)}},Te=async t=>{try{await h(`/ordini/${t}/segna-pagato`,{}),await B()}catch(s){alert(`Errore segna pagato: ${s?.message||s}`)}},Le=async t=>{try{await h(`/ordini/${t}/segna-spedito`,{}),await B()}catch(s){alert(`Errore segna spedito: ${s?.message||s}`)}},Me=t=>{const a=(Number(t)||0)/24,l=Math.floor(a).toString();let d="bg-green-50 text-green-700 ring-green-200";return a>=3?d="bg-red-50 text-red-700 ring-red-200":a>=1&&(d="bg-amber-50 text-amber-700 ring-amber-200"),{label:l,cls:d}},Ie=async()=>{if(!i)return;const t=v(i);if(!t)return alert("ID ordine mancante");try{Y(!0);const s=window.prompt("Note opzionali per il dealer (lascia vuoto per nessuna):")||"";await h(`/masterprodotti/ordini/${t}/aggiorna-spedizione`,{idStatoSpedizione:3,stato_spedizione:"Spedito",noteDealer:s}),await g(t),await m()}catch(s){console.error("Errore aggiornamento spedizione:",s),alert(`Errore aggiornamento spedizione: ${s?.message||s}`)}finally{Y(!1)}},$e=async()=>{if(!i)return;const t=v(i);if(!t)return alert("ID ordine mancante");try{ee(!0),await h(`/ordini/${t}/segna-pagato`,{}),await g(t),await m()}catch(s){console.error("Errore segna pagato:",s),alert(`Errore segna pagato: ${s?.message||s}`)}finally{ee(!1)}},Re=async()=>{if(!i)return;const t=v(i);if(!t)return alert("ID ordine mancante");try{te(!0);const s=window.prompt("Note opzionali per il dealer (lascia vuoto per nessuna):")||"";await h(`/masterprodotti/ordini/${t}/segna-ricaricato`,{noteDealer:s}),await g(t),await m()}catch(s){console.error("Errore segna ricaricato:",s),alert(`Errore segna ricaricato: ${s?.message||s}`)}finally{te(!1)}},Ue=t=>{if(!t)return!1;const s=(t.StatoEsteso||"").toUpperCase(),a=(t.StatoSpedizione||"").toUpperCase();return s==="IN ATTESA PAGAMENTO"&&a==="DA SPEDIRE"},Ge=async()=>{if(!i)return;const t=v(i);if(!t)return alert("ID ordine mancante");if(window.confirm("Sei sicuro di voler annullare questo ordine? Questa azione non puÃ² essere annullata."))try{se(!0);const s=window.prompt("Note per l'annullamento (opzionale):")||"";await h(`/masterprodotti/ordini/${t}/annulla`,{noteDealer:s}),await g(t),await m()}catch(s){console.error("Errore annullamento ordine:",s),alert(`Errore annullamento ordine: ${s?.message||s}`)}finally{se(!1)}},Be=async t=>{if(!(t.tipo!=="EROGAZIONE"||!t.dettagli)){b({open:!0,visible:!1,data:t}),M(null),I(!0),setTimeout(()=>b(s=>({...s,visible:!0})),0);try{const s=await u(`/stripe/payout/${t.id}`);M(s)}catch(s){console.error("Errore caricamento dettagli payout:",s),alert("Errore nel caricamento dei dettagli del payout")}finally{I(!1)}}},_=()=>{b(t=>({...t,visible:!1})),setTimeout(()=>{b({open:!1,visible:!1,data:null}),M(null),I(!1)},200)};return e.jsx(Ve,{title:"Home",children:e.jsx("div",{className:"w-full max-w-[2300px] mx-auto px-1 sm:px-2 lg:px-2 py-2 sm:py-3 lg:py-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"bg-white rounded-2xl shadow-sm ring-1 ring-gray-100 h-[42vh] flex flex-col",children:[e.jsx("div",{className:"px-5 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Ordini"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:block text-xs text-gray-500",children:[R.length," risultati"]}),e.jsxs("div",{className:"relative w-[220px] sm:w-[260px]",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-4.35-4.35m0 0A7.5 7.5 0 103 10.5a7.5 7.5 0 0013.65 6.15z"})})}),e.jsx("input",{type:"text",value:j,onChange:t=>W(t.target.value),placeholder:"Cerca ordini...",className:"w-full rounded-lg border border-gray-200 pl-9 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-login-bg focus:border-transparent placeholder:text-gray-400"}),j&&e.jsx("button",{type:"button",onClick:()=>W(""),className:"absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-gray-600","aria-label":"Cancella ricerca",children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 8.586l4.95-4.95a1 1 0 111.414 1.415L11.414 10l4.95 4.95a1 1 0 01-1.414 1.415L10 11.414l-4.95 4.95a1 1 0 01-1.414-1.415L8.586 10l-4.95-4.95A1 1 0 115.05 3.636L10 8.586z",clipRule:"evenodd"})})}),Ne&&V.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:`absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-200 ${oe?"opacity-100":"opacity-0"}`,onClick:G}),e.jsxs("div",{className:`relative bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden transition-all duration-200 ease-out transform ${oe?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 translate-y-1"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Ordini in attesa di pagamento"}),e.jsx("button",{onClick:G,className:"text-gray-400 hover:text-gray-600","aria-label":"Chiudi",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:be?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"Caricamentoâ€¦"}):k.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"Nessun ordine in attesa"}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Totale ordini in attesa: ",e.jsx("span",{className:"font-semibold text-gray-900",children:k.length})]}),e.jsx("div",{className:"border border-gray-100 rounded",children:e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"ID"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Data"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Dealer"}),e.jsx("th",{className:"text-right px-3 py-2",children:"Totale"}),e.jsx("th",{className:"text-center px-3 py-2",children:"Giorni attesa"}),e.jsx("th",{className:"text-center px-3 py-2",children:"Stato spedizione"}),e.jsx("th",{className:"text-right px-3 py-2",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:k.map((t,s)=>{const a=t?.IDOrdine||t?.IDOrdineProdotto||t?.ID,l=t?.DataOrdine||t?.Data||"-",d=Me(t?.OreAttesa),p=String(t?.stato_spedizione||t?.Stato_spedizione||"").toLowerCase().includes("sped");return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-3 py-2",children:["#",a||"-"]}),e.jsx("td",{className:"px-3 py-2",children:l}),e.jsx("td",{className:"px-3 py-2",children:t?.RagioneSociale||"â€”"}),e.jsx("td",{className:"px-3 py-2 text-right",children:o(t?.Totale||t?.TotaleOrdine)}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ring-1 ${d.cls}`,children:[d.label,"g"]})}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ring-1 ${p?"bg-emerald-50 text-emerald-700 ring-emerald-200":"bg-gray-50 text-gray-700 ring-gray-200"}`,children:p?"Spedito":"Non spedito"})}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-gray-700",onClick:()=>g(a),children:"Dettagli"}),e.jsx("button",{className:"px-2 py-1 rounded bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>Te(a),children:"Segna pagato"}),e.jsx("button",{className:"px-2 py-1 rounded bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>Le(a),children:"Segna spedito"})]})})]},s)})})]})})]})}),e.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:e.jsx("button",{onClick:G,className:"px-3 py-1.5 text-sm rounded bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Chiudi"})})]})]}),document.body)]}),e.jsxs("button",{type:"button",onClick:Pe,className:"relative inline-flex items-center gap-2 rounded-lg px-3 py-2 text-xs sm:text-sm font-medium bg-red-50 text-red-700 ring-1 ring-red-200 hover:bg-red-100",title:"Ordini in attesa pagamento",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M12 22a2 2 0 01-2-2h4a2 2 0 01-2 2zm6-6V11a6 6 0 10-12 0v5l-2 2v1h16v-1l-2-2z"})}),e.jsx("span",{className:"inline-flex items-center justify-center min-w-[1.5rem] h-6 px-2 rounded-full bg-red-600 text-white text-xs",children:je?"â€¦":fe})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:ue?e.jsx("div",{className:"p-6 text-sm text-gray-500",children:"Caricamentoâ€¦"}):F?e.jsx("div",{className:"p-6 text-sm text-red-600",children:F}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID Ordine"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ragione Sociale"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Totale"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stato Ordine"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stato Spedizione"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Note"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:R.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-sm text-gray-500",colSpan:7,children:"Nessun ordine trovato."})}):R.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",onClick:()=>g(t?.IDOrdineProdotto),children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 cursor-pointer",children:t?.Data??"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 cursor-pointer",children:t?.IDOrdineProdotto??"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 cursor-pointer",children:t?.RagioneSociale??"Sconosciuto"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 cursor-pointer",children:o(t?.TotaleOrdine)}),e.jsx("td",{className:"px-4 py-3 text-sm cursor-pointer",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Qe(t?.StatoEsteso)}`,children:t?.StatoEsteso??"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm cursor-pointer",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Fe(t?.Stato_spedizione??t?.stato_spedizione??t?.StatoSpedizioneEsteso)}`,children:t?.Stato_spedizione??t?.stato_spedizione??t?.StatoSpedizioneEsteso??"Non Spedito"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 truncate max-w-[360px] cursor-pointer",title:t?.NOTE||"",children:t?.NOTE??"-"})]},s))})]})})]}),ye&&V.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:`absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-200 ${J?"opacity-100":"opacity-0"}`,onClick:U}),e.jsxs("div",{className:`relative bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden transition-all duration-200 ease-out transform ${J?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 translate-y-1"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center gap-3",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Dettaglio Ordine ",i?.IDOrdine||i?.IDOrdineProdotto?`#${i.IDOrdine||i.IDOrdineProdotto}`:"",i?.RagioneSociale&&e.jsxs("span",{className:"text-base font-normal text-gray-600 ml-2",children:["- ",i.RagioneSociale]})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",id:"mp-action-buttons",children:[!De(i)&&e.jsx("button",{id:"btn-mp-spedito",onClick:Ie,disabled:C||y,className:`px-3 py-1.5 text-xs sm:text-sm rounded font-medium text-white shadow-sm transition-colors ${C?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"}`,title:"Aggiorna stato spedizione a Spedito",children:C?"Aggiornamentoâ€¦":"SEGNA COME SPEDITO"}),ze(i)&&e.jsx("button",{id:"btn-mp-ricaricato",onClick:Re,disabled:A||y,className:`px-3 py-1.5 text-xs sm:text-sm rounded font-medium text-white shadow-sm transition-colors ${A?"bg-gray-400":"bg-violet-600 hover:bg-violet-700"}`,title:"Imposta stato spedizione a RICARICATO (26)",children:A?"Aggiornamentoâ€¦":"SEGNA COME RICARICATO"}),!ke(i)&&e.jsx("button",{id:"btn-mp-pagato",onClick:$e,disabled:O||y,className:`px-3 py-1.5 text-xs sm:text-sm rounded font-medium text-white shadow-sm transition-colors ${O?"bg-gray-400":"bg-emerald-600 hover:bg-emerald-700"}`,title:"Segna ordine come pagato",children:O?"Aggiornamentoâ€¦":"SEGNA COME PAGATO"}),Ue(i)&&e.jsx("button",{id:"btn-mp-annulla",onClick:Ge,disabled:E||y,className:`px-3 py-1.5 text-xs sm:text-sm rounded font-medium text-white shadow-sm transition-colors ${E?"bg-gray-400":"bg-red-600 hover:bg-red-700"}`,title:"Annulla ordine",children:E?"Annullamentoâ€¦":"ANNULLA ORDINE"}),e.jsx("button",{onClick:U,className:"ml-1 text-gray-400 hover:text-gray-600","aria-label":"Chiudi",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:y?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"Caricamento dettagli..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Data ordine"}),e.jsx("div",{className:"text-gray-900",children:i?.Data??"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Stato"}),e.jsx("div",{className:"text-gray-900",children:i?.StatoEsteso??"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Importo totale"}),e.jsx("div",{className:"font-semibold text-gray-900",children:o(i?.ImportoTotale??i?.TotaleOrdine)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Metodo pagamento"}),e.jsx("div",{className:"text-gray-900",children:i?.MetodoPagamento??"-"})]})]}),Array.isArray(f(i))&&f(i).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Prodotti"}),e.jsx("div",{className:"border border-gray-100 rounded",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-600",children:[e.jsx("th",{className:"text-left px-2 py-1",children:"Prodotto"}),e.jsx("th",{className:"text-left px-2 py-1",children:"QuantitÃ "}),e.jsx("th",{className:"text-left px-2 py-1",children:"Prezzo Unitario"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Totale"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:f(i).map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1",children:t?.Titolo||t?.titolo||"-"}),e.jsx("td",{className:"px-2 py-1",children:t?.Quantita??t?.quantita??"-"}),e.jsx("td",{className:"px-2 py-1",children:o(t?.PrezzoUnitario??t?.CostoUnitario??t?.prezzo??0)}),e.jsx("td",{className:"px-2 py-1",children:o((t?.PrezzoUnitario??t?.CostoUnitario??t?.prezzo??0)*(t?.Quantita??t?.quantita??1))})]},s))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Informazioni aggiuntive"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Ordinato da"}),e.jsx("div",{className:"text-gray-800",children:i?.OrdineDA??"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Stato spedizione"}),e.jsx("div",{className:"text-gray-800",children:i?.StatoSpedizione??i?.stato_spedizione??"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Spese spedizione"}),e.jsx("div",{className:"text-gray-800",children:o(i?.SpeseSpedizione??0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Totale ordine"}),e.jsx("div",{className:"text-gray-800",children:o(i?.TotaleOrdine)})]})]})]}),Array.isArray(i?.allegati)&&i.allegati.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Foto allegate"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:i.allegati.map((t,s)=>{const a=t?.url;if(!a)return null;const l=t?.nome||`Allegato ${s+1}`,d=t?.id??`${s}-${a}`;return e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"group block overflow-hidden rounded-lg border border-gray-200 hover:border-blue-300 hover:shadow-sm transition",children:[e.jsx("div",{className:"aspect-[4/3] bg-gray-100",children:e.jsx("img",{src:a,alt:l,className:"h-full w-full object-cover transition-transform duration-200 group-hover:scale-105"})}),e.jsx("div",{className:"px-2 py-2 text-xs text-gray-600 truncate",title:l,children:l})]},d)})})]}),i?.NOTE&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Note"}),e.jsx("div",{className:"text-sm text-gray-800 bg-gray-50 p-3 rounded whitespace-pre-wrap",children:i.NOTE})]})]})}),e.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:e.jsx("button",{onClick:U,className:"px-3 py-1.5 text-sm rounded bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Chiudi"})})]})]}),document.body),e.jsxs("section",{className:"bg-white rounded-2xl shadow-sm ring-1 ring-gray-100 h-[42vh] flex flex-col",children:[e.jsx("div",{className:"px-5 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Movimenti Stripe"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:block text-xs text-gray-500",children:[$.length," risultati"]}),e.jsx("input",{type:"number",inputMode:"numeric",min:1,max:365,placeholder:"Giorni",value:P,onChange:t=>Ce(t.target.value),className:"w-[90px] rounded-lg border border-gray-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-login-bg focus:border-transparent placeholder:text-gray-400",title:"Filtra per ultimi N giorni"}),e.jsx("input",{type:"number",inputMode:"numeric",min:1,max:200,placeholder:"Limit",value:T,onChange:t=>Oe(t.target.value),className:"w-[90px] rounded-lg border border-gray-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-login-bg focus:border-transparent placeholder:text-gray-400",title:"Numero massimo di movimenti"}),e.jsxs("div",{className:"relative w-[220px] sm:w-[260px]",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-4.35-4.35m0 0A7.5 7.5 0 103 10.5a7.5 7.5 0 0013.65 6.15z"})})}),e.jsx("input",{type:"text",value:N,onChange:t=>ge(t.target.value),placeholder:"Cerca movimenti...",className:"w-full rounded-lg border border-gray-200 pl-9 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-login-bg focus:border-transparent placeholder:text-gray-400"}),N&&e.jsx("button",{type:"button",onClick:()=>ge(""),className:"absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-gray-600","aria-label":"Cancella ricerca",children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 8.586l4.95-4.95a1 1 0 111.414 1.415L11.414 10l4.95 4.95a1 1 0 01-1.414 1.415L10 11.414l-4.95 4.95a1 1 0 01-1.414-1.415L8.586 10l-4.95-4.95A1 1 0 115.05 3.636L10 8.586z",clipRule:"evenodd"})})})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:we?e.jsx("div",{className:"p-6 text-sm text-gray-500",children:"Caricamentoâ€¦"}):me?e.jsx("div",{className:"p-6 text-sm text-red-600",children:me}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dealer"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Importo"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valuta"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descrizione"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:$.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-sm text-gray-500",colSpan:6,children:"Nessun movimento trovato."})}):$.map((t,s)=>{const a=(t?.tipo||"").toUpperCase(),l=a==="EROGAZIONE",d=a==="INCASSO"?"bg-emerald-50 text-emerald-700 ring-emerald-200":a==="EROGAZIONE"?"bg-amber-50 text-amber-700 ring-amber-200":"bg-gray-50 text-gray-700 ring-gray-200";return e.jsxs("tr",{className:`hover:bg-gray-50 ${l?"cursor-pointer":""}`,onClick:()=>l&&Be(t),title:l?"Clicca per vedere i dettagli del payout":"",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t?.data??"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:t?.dealer||"â€”"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ring-1 ${d}`,children:[a||"â€”",l&&e.jsx("span",{className:"ml-1",children:"ðŸ‘ï¸"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Ee(t?.importo)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(t?.valuta||"").toUpperCase()}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 truncate max-w-[420px]",title:t?.descrizione||"",children:t?.descrizione||"â€”"})]},s)})})]})})]}),L.open&&V.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:`absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-200 ${L.visible?"opacity-100":"opacity-0"}`,onClick:_}),e.jsxs("div",{className:`relative bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden transition-all duration-200 ease-out transform ${L.visible?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 translate-y-1"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Dettagli Payout Stripe"}),e.jsx("button",{onClick:_,className:"text-gray-400 hover:text-gray-600","aria-label":"Chiudi",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:Ae?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"Caricamento dettagli payout..."}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg",children:[e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:[o(n.payout.amount)," ",n.payout.currency]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Bonifico ",n.payout.status==="paid"?"Completato":"In elaborazione"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:n.payout.created})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Tempistiche"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Bonifico completato"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.payout.arrival_date||n.payout.created})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Pagamento disposto in automatico"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.payout.created})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Riepilogo"}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"text-center px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Conteggio"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Lordo"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Commissioni"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Totale"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:"Addebiti"}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700",children:n.riepilogo.addebiti.conteggio}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:o(n.riepilogo.addebiti.lordo)}),e.jsxs("td",{className:"px-3 py-2 text-right text-red-600",children:["-",o(n.riepilogo.addebiti.commissioni)]}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:o(n.riepilogo.addebiti.totale)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:"Rimborsi"}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700",children:n.riepilogo.rimborsi.conteggio}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:n.riepilogo.rimborsi.lordo}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-700",children:o(n.riepilogo.rimborsi.commissioni)}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:n.riepilogo.rimborsi.totale})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:"Rettifiche"}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700",children:n.riepilogo.rettifiche.conteggio}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:o(n.riepilogo.rettifiche.lordo)}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-700",children:o(n.riepilogo.rettifiche.commissioni)}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:o(n.riepilogo.rettifiche.totale)})]}),e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:"Bonifici"}),e.jsx("td",{className:"px-3 py-2 text-center",children:"-"}),e.jsx("td",{className:"px-3 py-2 text-right",children:"-"}),e.jsx("td",{className:"px-3 py-2 text-right",children:"-"}),e.jsx("td",{className:"px-3 py-2 text-right text-blue-700",children:o(n.payout.amount)})]})]})]})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:["Transazioni (",n.transazioni.length,")"]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Lordo"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Commissione"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Totale"}),e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Descrizione"}),e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-gray-500 uppercase",children:"Giorno"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:n.transazioni.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ring-1 ${t.tipo==="Pagamento"?"bg-emerald-50 text-emerald-700 ring-emerald-200":t.tipo==="Rimborso"?"bg-red-50 text-red-700 ring-red-200":"bg-gray-50 text-gray-700 ring-gray-200"}`,children:t.tipo})}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:o(t.lordo)}),e.jsxs("td",{className:"px-3 py-2 text-right text-red-600",children:["-",o(t.commissione)]}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900",children:o(t.totale)}),e.jsx("td",{className:"px-3 py-2 text-gray-700 truncate max-w-[200px]",title:t.descrizione,children:t.descrizione}),e.jsx("td",{className:"px-3 py-2 text-gray-500",children:t.data})]},s))})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Dettagli Tecnici"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"ID Payout"}),e.jsx("div",{className:"font-mono text-gray-900 break-all",children:n.payout.id})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Metodo"}),e.jsx("div",{className:"text-gray-900 capitalize",children:n.payout.method||"standard"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Automatico"}),e.jsx("div",{className:"text-gray-900",children:n.payout.automatic?"SÃ¬":"No"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Tipo"}),e.jsx("div",{className:"text-gray-900 capitalize",children:n.payout.type||"bank_account"})]})]})]})]}):e.jsx("div",{className:"py-8 text-center text-gray-500",children:"Errore nel caricamento dei dettagli"})}),e.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:e.jsx("button",{onClick:_,className:"px-3 py-1.5 text-sm rounded bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Chiudi"})})]})]}),document.body)]})})})}export{Ke as default};
