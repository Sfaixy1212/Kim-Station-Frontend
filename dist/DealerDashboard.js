import{u as ee,r as n,j as e,w as de,x as me,n as xe,y as ge,A as ue,P as he,C as H,W as ne,D as ie,Z as le,T as Z,G as oe,M as ce,E as Q,H as ae,g as re,J,X as pe,K as fe,O as be}from"./vendor.js";import{a as X,D as je}from"./DashboardLayout.js";import{g as te,u as Y}from"./index.js";import{R as Ne,a as ye}from"./RecentOrders.js";import"./logo2.js";function ve({dealerId:i}){const r=ee(),[c,m]=n.useState(!0),[x,b]=n.useState(""),[u,l]=n.useState([]),N=async()=>{try{m(!0),b("");const h=new URLSearchParams;h.set("scope","dealer"),h.set("active","true"),i!=null&&i!==""&&h.set("dealerId",String(i));const S=await te(`/supermaster/news?${h.toString()}`),y=Array.isArray(S)?S:[];l(y.slice(0,2))}catch(h){b(h?.message||"Errore caricamento news")}finally{m(!1)}};return n.useEffect(()=>{N()},[i]),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-4 flex flex-col h-full",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"News"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Comunicazioni per il tuo punto vendita"})]}),c&&e.jsx("div",{className:"space-y-2 flex-1",children:Array.from({length:2}).map((h,S)=>e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"},S))}),!c&&x&&e.jsx("div",{className:"text-xs text-red-600",children:x}),!c&&!x&&e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsx("div",{onClick:()=>r("/dealer/activations"),className:"bg-gradient-to-r from-yellow-50 to-amber-50 border-l-4 border-yellow-400 rounded-lg p-3 cursor-pointer hover:shadow-md transition-all group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-white rounded-lg p-1.5 shadow-sm",children:e.jsx("img",{src:"https://kimweb.agency/wp-content/uploads/2024/11/Eni_Plenitude_logo.svg.png",alt:"ENI Plenitude",className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-bold text-yellow-900 mb-1",children:"Nuovo operatore disponibile!"}),e.jsxs("div",{className:"text-xs text-yellow-800 mb-1.5",children:["Da oggi puoi attivare le offerte ",e.jsx("span",{className:"font-semibold",children:"ENI Plenitude"})," Luce & Gas con condizioni esclusive."]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-300 rounded px-2 py-1.5 mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] font-bold text-green-800",children:"ðŸŒ Fibra Ultraveloce"}),e.jsx("span",{className:"text-[9px] bg-red-500 text-white font-bold px-1.5 py-0.5 rounded-full",children:"OFFERTA"})]}),e.jsx("div",{className:"text-[10px] text-green-700 mb-1",children:"Se sei cliente Eni Plenitude Luce: fino a 2,5 Gbps download e 1 Gbps upload"}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white rounded px-2 py-1 border border-green-400",children:[e.jsx("span",{className:"text-base font-black text-green-700",children:"16,90â‚¬"}),e.jsxs("span",{className:"text-[9px] text-gray-600",children:["/mese per ",e.jsx("span",{className:"font-semibold text-green-700",children:"3 anni"})]})]})]}),e.jsxs("div",{className:"text-xs text-yellow-700 font-medium group-hover:text-yellow-900 flex items-center gap-1",children:["ðŸ”— Scopri di piÃ¹",e.jsx("svg",{className:"w-3 h-3 group-hover:translate-x-0.5 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})}),e.jsxs("ul",{className:"space-y-2",children:[u.map(h=>e.jsxs("li",{className:"border-b last:border-none border-gray-100 pb-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-800 line-clamp-1",children:h.Titolo}),e.jsx("div",{className:"text-xs text-gray-500 line-clamp-2",children:h.Messaggio})]},h.ID)),u.length===0&&e.jsx("li",{className:"text-xs text-gray-500",children:"Nessuna news al momento."})]})]})]})}const we=[50,100,250,500];function Se({onClose:i,onSuccess:r}){const c=ge(),m=ue(),[x,b]=n.useState("50"),[u,l]=n.useState(!1),[N,h]=n.useState(""),{user:S}=Y(),y=async C=>{if(C.preventDefault(),!(!c||!m))try{l(!0),h("");const{error:g}=await c.confirmPayment({elements:m,confirmParams:{return_url:window.location.href,receipt_email:S?.email},redirect:"if_required"});if(g)throw g;r?.(),i?.()}catch(g){h(g?.message||"Errore durante il pagamento")}finally{l(!1)}};return e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx("div",{className:"rounded-md border border-gray-200 p-3",children:e.jsx(he,{options:{layout:"tabs"}})}),N?e.jsx("p",{className:"text-sm text-red-600",children:N}):null,e.jsxs("div",{className:"flex justify-between gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200",children:"Annulla"}),e.jsx("button",{disabled:u||!c,type:"submit",className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:u?"Elaborazioneâ€¦":"Procedi al pagamento"})]})]})}function Ee(){const[i,r]=n.useState(!1),[c,m]=n.useState(""),[x,b]=n.useState(50),[u,l]=n.useState(""),[N,h]=n.useState(!1),[S,y]=n.useState(""),{user:C}=Y();n.useEffect(()=>{const f=()=>r(!0);return window.addEventListener("open-plafond-topup",f),()=>window.removeEventListener("open-plafond-topup",f)},[]),n.useEffect(()=>{i&&(async()=>{try{const{data:f}=await X.get("/api/stripe/public-key");m(f?.publicKey||"")}catch{}})()},[i]),n.useEffect(()=>{!i||!c||(async()=>{try{h(!0),y("");const{data:f}=await X.post("/api/ricarica-plafond",{amount:x,emailCliente:C?.email}),I=f?.client_secret;if(!I)throw new Error("Client secret non ricevuto");l(I)}catch(f){y(f?.response?.data?.error||f?.message||"Errore creazione pagamento")}finally{h(!1)}})()},[i,c,x,C?.email]);const g=n.useMemo(()=>c?de(c):null,[c]),z=()=>{window.dispatchEvent(new CustomEvent("plafond-updated")),xe.success("Pagamento riuscito! Il tuo plafond sarÃ  aggiornato a breve.",{duration:3e3})};return i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md p-5",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ricarica credito plafond"}),c?.startsWith("pk_test_")&&e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded bg-yellow-100 text-yellow-800 border border-yellow-200",children:"TEST MODE"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Dati carta di credito:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:we.map(f=>e.jsx("button",{type:"button",onClick:()=>b(f),className:`px-3 py-1.5 rounded-lg text-sm font-medium ${x===f?"bg-blue-600 text-white":"bg-blue-50 text-blue-700 hover:bg-blue-100"}`,children:f.toLocaleString("it-IT",{style:"currency",currency:"EUR"})},f))}),e.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Importo:"})," ",Number(x).toLocaleString("it-IT",{style:"currency",currency:"EUR"})]}),C?.email?e.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",C.email]}):null,!g||!u?e.jsx("div",{className:"text-sm text-gray-600",children:N?"Preparazione pagamentoâ€¦":S||"Inizializzazione pagamentoâ€¦"}):e.jsx(me,{stripe:g,options:{clientSecret:u,appearance:{theme:"stripe"},locale:"it"},children:e.jsx(Se,{onClose:()=>r(!1),onSuccess:z})},u)]})}):null}function Me(){const[i,r]=n.useState([]),[c,m]=n.useState(!0),[x,b]=n.useState(null),[u,l]=n.useState(1),[N,h]=n.useState(!0),[S,y]=n.useState(0),{user:C}=Y(),g=(C?.role||"").toString().toLowerCase(),z=g==="agente"||g==="agent",f=z?"/agente":"/dealer";n.useEffect(()=>{let o=!0;return(async()=>{try{m(!0);const v=await te(`${f}/obiettivi`),q=v?.data&&!Array.isArray(v.data)?v.data:v,K=Array.isArray(q?.data)?q.data:Array.isArray(v?.data)?v.data:Array.isArray(v)?v:[];if(z){const P={MOBILE:{current:0,target:0,mancano:0,valore:0},FISSO:{current:0,target:0,mancano:0,valore:0},ENERGIA:{current:0,target:0,mancano:0,valore:0},RIC_RA:{current:0,target:0,mancano:0,valore:0}},A=(w,j)=>{const t=Number(j.fatto??j.done??j.attuale??j.valore??0)||0,a=j.target??j.obiettivo??j.prossimoTarget;let s=Number(a)||0;const d=Number(j.mancano??0)||0;!s&&(d||t)&&(s=t+d),P[w].current+=t,P[w].target+=s,P[w].mancano+=Math.max(0,s-t);const p=Number(j.valore??j.raw??j.extra??0)||0;P[w].valore=(P[w].valore||0)+p};for(const w of K){const j=Array.isArray(w.categorie)?w.categorie:[];for(const t of j){const a=(t.categoria||t.nome||t.label||"").toString().toLowerCase();/ric/.test(a)&&/auto/.test(a)?A("RIC_RA",t):/mob/i.test(a)?A("MOBILE",t):/fiss/i.test(a)?A("FISSO",t):/ener/i.test(a)&&A("ENERGIA",t)}}const $={MOBILE:"bg-red-500",FISSO:"bg-orange-500",ENERGIA:"bg-gray-400",RIC_RA:"bg-violet-500"},U=[{key:"MOBILE",title:"MOBILE",unit:"attivazioni"},{key:"FISSO",title:"FISSO",unit:"attivazioni"},{key:"ENERGIA",title:"ENERGIA",unit:"attivazioni"},{key:"RIC_RA",title:"% RIC. AUTOMATICA",unit:"percentuale"}].map((w,j)=>{const t=P[w.key]||{current:0,target:0,mancano:0,valore:0};let a=t.current,s=t.target||0,d=Math.max(0,s-a),p=s>0?Math.round(a/s*100):0,D=w.unit==="percentuale"?"%":"attivazioni",O;return w.unit==="percentuale"&&(a=Math.round(a),s=100,p=a,d=0,O={ra:Math.round(t.valore||0),mobile:Math.round(P.MOBILE.current||0)}),{id:j+1,title:w.title,current:a,target:s,unit:D,progress:p,color:$[w.key]||"bg-gray-500",mancano:d,livello:0,extra:O}});o&&(r(U),l(1))}else{const P=[];let A=1;for(const $ of K)for(const G of $.categorie||[]){const U={SKY:"bg-blue-500","FASTWEB MOBILE":"bg-green-500","FASTWEB FISSO":"bg-purple-500","FASTWEB ENERGY":"bg-orange-500"},w=$.operatore?.toUpperCase()||"",j=G.nome||"";let t=j,a=w;w==="FASTWEB"&&(j.includes("MOBILE")?(a="FASTWEB MOBILE",t=j.replace("MOBILE ","")):j.includes("FISSO")?(a="FASTWEB FISSO",t=j.replace("FISSO ","")):j.includes("ENERGY")&&(a="FASTWEB ENERGY",t=j.replace("ENERGY ",""))),P.push({id:A++,title:t,current:G.attuale||0,target:G.prossimoTarget||1,unit:"attivazioni",progress:G.percentuale||0,color:U[a]||"bg-gray-500",mancano:G.mancano||0,livello:G.livelloRaggiunto||0})}o&&(r(P),l(1))}}catch(v){console.error("Errore fetch obiettivi:",v),o&&b(v.message||"Errore di caricamento")}finally{o&&m(!1)}})(),()=>{o=!1}},[]),n.useEffect(()=>{const v=Math.max(1,Math.ceil(i.length/4));u>v&&l(v),u<1&&l(1)},[i]),n.useEffect(()=>{if(!N||c||i.length===0)return;const v=Math.max(1,Math.ceil(i.length/4));if(v<=1)return;const q=setInterval(()=>{Date.now()-S<1e4||l(P=>P>=v?1:P+1)},2e3);return()=>clearInterval(q)},[N,c,i.length,S]);const I=o=>o>=80?"text-green-600":o>=60?"text-yellow-600":"text-red-600",L=o=>{y(Date.now()),l(o)},B=()=>{h(!N),y(Date.now())},E=4,W=Math.max(1,Math.ceil(i.length/E)),T=Math.min(Math.max(u,1),W),_=(T-1)*E,se=i.slice(_,_+E);return e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:"Obiettivi del Mese"}),e.jsxs("div",{className:"flex items-center space-x-3 flex-nowrap",children:[e.jsxs("div",{className:"text-xs text-gray-500 whitespace-nowrap",children:["Pagina ",T," di ",W]}),W>1&&e.jsxs("button",{onClick:B,className:`inline-flex items-center px-2 py-1 rounded-full text-[10px] font-medium transition-colors ${N?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:N?"Autoscroll attivo (clicca per disattivare)":"Autoscroll disattivo (clicca per attivare)",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full mr-1 ${N?"bg-green-500":"bg-gray-400"}`}),"Auto"]}),e.jsxs("div",{className:"space-x-2 whitespace-nowrap",children:[e.jsx("button",{"aria-label":"Pagina precedente",className:`inline-flex items-center justify-center px-2 py-1 rounded-full text-[11px] font-medium border transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 shrink-0 ${T<=1?"bg-gray-50 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-300 shadow-sm"}`,disabled:T<=1,onClick:()=>L(Math.max(1,T-1)),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-3 w-3",children:e.jsx("path",{fillRule:"evenodd",d:"M12.78 4.22a.75.75 0 010 1.06L8.06 10l4.72 4.72a.75.75 0 11-1.06 1.06l-5.25-5.25a.75.75 0 010-1.06l5.25-5.25a.75.75 0 011.06 0z",clipRule:"evenodd"})})}),e.jsx("button",{"aria-label":"Pagina successiva",className:`inline-flex items-center justify-center px-2 py-1 rounded-full text-[11px] font-medium border transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 shrink-0 ${T>=W?"bg-gray-50 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-300 shadow-sm"}`,disabled:T>=W,onClick:()=>L(Math.min(W,T+1)),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-3 w-3",children:e.jsx("path",{fillRule:"evenodd",d:"M7.22 15.78a.75.75 0 010-1.06L11.94 10 7.22 5.28a.75.75 0 111.06-1.06l5.25 5.25a.75.75 0 010 1.06l-5.25 5.25a.75.75 0 01-1.06 0z",clipRule:"evenodd"})})})]})]})]}),c&&e.jsx("div",{className:"py-6 text-sm text-gray-500 text-center",children:"Caricamento obiettivi..."}),x&&!c&&e.jsx("div",{className:"py-6 text-sm text-red-600 text-center",children:x}),!c&&!x&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.length===0?e.jsx("div",{className:"col-span-full py-6 text-sm text-gray-500 text-center",children:"Nessun obiettivo configurato per questo mese"}):se.map(o=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2.5",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h4",{className:"text-base font-medium text-gray-900",children:o.title})}),e.jsxs("span",{className:`text-sm font-semibold ${I(o.progress)}`,children:[o.progress,"%"]})]}),e.jsxs("div",{className:"mb-2.5",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:o.unit==="%"?e.jsxs(e.Fragment,{children:[o.current,"%",o.extra?` (${o.extra.ra} su ${o.extra.mobile})`:""]}):e.jsxs(e.Fragment,{children:[o.current," / ",o.target," ",o.unit]})}),e.jsx("span",{children:o.mancano>0?`Mancano: ${o.mancano}`:"Raggiunto!"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${o.color}`,style:{width:`${Math.min(o.progress,100)}%`}})})]}),o.title!=="% RIC. AUTOMATICA"&&e.jsxs("div",{className:"text-xs text-gray-500",children:[o.progress>=100?e.jsx("span",{className:"text-green-600 font-medium",children:"Obiettivo raggiunto!"}):o.progress>=80?e.jsx("span",{className:"text-green-600",children:"Quasi raggiunto"}):o.progress>=60?e.jsx("span",{className:"text-yellow-600",children:"Buon progresso"}):e.jsx("span",{className:"text-red-600",children:"Serve piÃ¹ impegno"}),o.livello>0&&e.jsxs("span",{className:"ml-2 text-blue-600 font-medium",children:["Livello ",o.livello]})]})]},o.id))})})]})}function Ae(){const[i,r]=n.useState(null),[c,m]=n.useState(!0),[x,b]=n.useState(null),u=async()=>{try{m(!0),b(null);const l=await X.get("/api/dealer/andamento-mensile");r(l.data)}catch(l){console.error("[useAndamentoMensile] Errore:",l),b(l.response?.data?.error||l.message||"Errore nel caricamento dati")}finally{m(!1)}};return n.useEffect(()=>{u()},[]),{data:i,loading:c,error:x,refetch:u}}function Ce(){const{data:i,loading:r,error:c}=Ae();if(r)return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Andamento Mensile"}),e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Attivazioni"})]})]}),e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-4"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-16 bg-gray-200 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 rounded"})]})]})]});if(c)return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Andamento Mensile"}),e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Attivazioni"})]})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-500 text-sm mb-2",children:"Errore nel caricamento"}),e.jsx("div",{className:"text-gray-500 text-xs",children:c})]})]});const m=i?.current||{},x=i?.variation||{},b=i?.monthlyData||[];console.log("[AndamentoMensile] Data ricevuta:",i),console.log("[AndamentoMensile] monthlyData:",b);const u=m.month?new Date(m.month).toLocaleDateString("it-IT",{month:"long",year:"numeric"}):"N/D",l=()=>x.trend==="up"?e.jsx(Z,{className:"w-4 h-4"}):x.trend==="down"?e.jsx(oe,{className:"w-4 h-4"}):e.jsx(ce,{className:"w-4 h-4"}),N=()=>x.trend==="up"?"text-green-600":x.trend==="down"?"text-red-600":"text-gray-600",h=()=>x.trend==="up"?"bg-green-50":x.trend==="down"?"bg-red-50":"bg-gray-50";return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Andamento Mensile"}),e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Attivazioni"})]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-600",children:u}),e.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${h()} ${N()}`,children:[l(),e.jsxs("span",{children:[Math.abs(x.percentage||0),"%"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"text-center p-1.5 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center mb-0.5",children:e.jsx(ne,{className:"w-3 h-3 text-blue-600"})}),e.jsx("div",{className:"text-xs font-semibold text-blue-900",children:m.fisso||0}),e.jsx("div",{className:"text-xs text-blue-700",children:"Fisso"})]}),e.jsxs("div",{className:"text-center p-1.5 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center mb-0.5",children:e.jsx(ie,{className:"w-3 h-3 text-purple-600"})}),e.jsx("div",{className:"text-xs font-semibold text-purple-900",children:m.mobile||0}),e.jsx("div",{className:"text-xs text-purple-700",children:"Mobile"})]}),e.jsxs("div",{className:"text-center p-1.5 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center mb-0.5",children:e.jsx(le,{className:"w-3 h-3 text-green-600"})}),e.jsx("div",{className:"text-xs font-semibold text-green-900",children:m.energia||0}),e.jsx("div",{className:"text-xs text-green-700",children:"Energia"})]})]}),e.jsxs("div",{className:"border-t pt-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:"Ultimi 6 mesi"}),b.length===0?e.jsx("div",{className:"text-xs text-gray-500 text-center py-2",children:"Nessun dato disponibile"}):e.jsx("div",{className:"flex items-end justify-between space-x-1 h-8",children:(()=>{const S=new Date,y=[];for(let g=5;g>=0;g--){const z=new Date(S.getFullYear(),S.getMonth()-g,1),f=z.toISOString().substring(0,7),I=b.find(L=>L.month?new Date(L.month).toISOString().substring(0,7)===f:!1);y.push({date:z,monthName:z.toLocaleDateString("it-IT",{month:"short"}),totale:I?I.totale:0})}const C=Math.max(...y.map(g=>g.totale),1);return y.map((g,z)=>{const f=C>0?g.totale/C*100:0;return console.log(`[AndamentoMensile] ${g.monthName}: totale=${g.totale}, height=${f}%`),e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full bg-blue-500 rounded-t transition-all duration-300 hover:bg-blue-600",style:{height:g.totale>0?`${Math.max(f,10)}%`:"2px",minHeight:g.totale>0?"8px":"2px"},title:`${g.monthName}: ${g.totale} attivazioni`}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:g.monthName})]},z)})})()})]}),m.mobileRa>0&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"di cui Mobile RA:"}),e.jsx("span",{className:"font-semibold text-amber-600",children:m.mobileRa})]})})]})}function ze(){const[i,r]=n.useState(null),[c,m]=n.useState(!0),[x,b]=n.useState(null),u=async()=>{try{m(!0),b(null);const l=await te("/dealer/performance-settimanale");r(l.data)}catch(l){console.error("[usePerformanceSettimanale] Errore:",l),b(l.response?.data?.error||l.message||"Errore nel caricamento dati")}finally{m(!1)}};return n.useEffect(()=>{u()},[]),{data:i,loading:c,error:x,refetch:u}}function Ie(){const{data:i,loading:r,error:c}=ze();if(r)return e.jsx("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse w-6 h-6 bg-blue-300 rounded"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})})]})});if(c)return e.jsx("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"ðŸ“Š"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Performance Settimanale"}),e.jsx("p",{className:"text-2xl font-bold text-gray-400",children:"--"}),e.jsx("p",{className:"text-xs text-red-500",children:"Errore caricamento"})]})]})});const m=i?.weeklyData||[],x=i?.totalWeek||0;i?.previousWeek;const b=i?.trend||"stable",u=i?.trendValue||0,l=m.length>0,N=l?x:12,h=l?b:"up",S=l?Math.abs(u):3,y=()=>h==="up"?e.jsx(Z,{className:"w-3 h-3"}):h==="down"?e.jsx(oe,{className:"w-3 h-3"}):e.jsx(ce,{className:"w-3 h-3"}),C=()=>h==="up"?"text-green-600":h==="down"?"text-red-600":"text-gray-600",g=()=>{if(!l){const f=[2,1,3,0,2,1,3],I=Math.max(...f,1);return e.jsx("div",{className:"flex items-end space-x-0.5 h-6 mt-2",children:f.map((L,B)=>e.jsx("div",{className:"flex-1 bg-blue-200 rounded-t",style:{height:`${L/I*100}%`,minHeight:L>0?"4px":"2px"},title:`Giorno ${B+1}: ${L} attivazioni`},B))})}const z=Math.max(...m,1);return e.jsx("div",{className:"flex items-end space-x-0.5 h-6 mt-2",children:m.map((f,I)=>e.jsx("div",{className:"flex-1 bg-blue-500 rounded-t",style:{height:`${f/z*100}%`,minHeight:f>0?"4px":"2px"},title:`Giorno ${I+1}: ${f} attivazioni`},I))})};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"ðŸ“Š"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Performance Settimanale"}),e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N}),e.jsxs("div",{className:`flex items-center space-x-1 ${C()}`,children:[y(),e.jsxs("span",{className:"text-sm font-medium",children:["+",S]})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ultimi 7 giorni"})]})]})}),e.jsxs("div",{className:"mt-3",children:[g(),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:"7gg fa"}),e.jsx("span",{children:"Oggi"})]})]}),!l&&e.jsx("div",{className:"mt-2 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"Dati di esempio - In attesa di integrazione API"})]})}const R=new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"});function Pe(){const{user:i}=Y(),[r,c]=n.useState(null),[m,x]=n.useState(!0),[b,u]=n.useState(null),[l,N]=n.useState(!1),[h,S]=n.useState(!1),y=new Date,C=`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}`,[g,z]=n.useState(C),I=(()=>{const t=[],a=new Date(2025,8,1),s=new Date;let d=new Date(a);for(;d<=s;){const p=d.getFullYear(),D=String(d.getMonth()+1).padStart(2,"0");t.push({value:`${p}-${D}`,label:d.toLocaleDateString("it-IT",{month:"long",year:"numeric"})}),d.setMonth(d.getMonth()+1)}return t.reverse()})();n.useEffect(()=>{i&&(async()=>{try{x(!0),u(null);const a=`${g}-01`;console.log("[CompensiRealtimeWide] Fetching compensi for month:",a);const s=localStorage.getItem("token"),d=await fetch("/api/supermaster/compensi-dealer",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({monthStart:a})});if(!d.ok)throw new Error("Errore nel caricamento dei dati");const p=await d.json();console.log("[CompensiRealtimeWide] API Response:",p),console.log("[CompensiRealtimeWide] Dettagli count:",p?.dettagli?.length||0),console.log("[CompensiRealtimeWide] Totale compensi:",p?.totaleCompensi),c(p)}catch(a){console.error("[CompensiRealtimeWide] Errore caricamento compensi:",a),u(a?.response?.data?.message||"Errore caricamento dati")}finally{x(!1)}})()},[i,g]);const L=()=>{N(!0),setTimeout(()=>S(!0),10)},B=()=>{S(!1),setTimeout(()=>N(!1),300)};if(m)return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-100 to-emerald-100 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"I Tuoi Compensi"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Caricamento dati..."})]})]})}),e.jsxs("div",{className:"animate-pulse grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-20 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded-lg"})]})]});if(b)return e.jsx("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-red-100 to-orange-100 rounded flex items-center justify-center",children:e.jsx(Q,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"I Tuoi Compensi"}),e.jsx("p",{className:"text-sm text-red-500",children:b})]})]})});const E=r?.totaleCompensi||0;console.log("[CompensiRealtimeWide] Calcolo compensi:",{totaleCompensi:r?.totaleCompensi,totaleGenerale:r?.totaleGenerale,maturato:E,dettagliCount:r?.dettagli?.length});const W=E>0||r?.dettagli&&r.dettagli.length>0,[T,_]=g.split("-").map(Number),o=new Date(T,_-1,y.getDate()).getDate(),v=new Date(T,_,0).getDate(),q=T===y.getFullYear()&&_===y.getMonth()+1,K=q&&o>0?E/o*v:E;console.log("[CompensiRealtimeWide] Calcolo proiezione:",{selectedMonth:g,isCurrentMonth:q,dayOfMonth:o,daysInMonth:v,maturato:E,proiezione:K});const A=(()=>{if(!r?.soglie||!r?.dettagli)return console.log("[CompensiRealtimeWide] Nessuna soglia disponibile"),E*1.3;console.log("[CompensiRealtimeWide] Soglie disponibili:",r.soglie.length);const t=new Map;r.dettagli.forEach(s=>{if(s.ambito!=="TLC")return;const d=`${s.categoria}_${s.segmento}`;t.has(d)||t.set(d,{categoria:s.categoria,segmento:s.segmento,qtyTotale:0,euroAttuali:0});const p=t.get(d);p.qtyTotale+=s.qty||0,p.euroAttuali+=s.euroCalcolati||0}),console.log("[CompensiRealtimeWide] Attivazioni per categoria:",Array.from(t.entries()));let a=E;return t.forEach((s,d)=>{const p=r.soglie.filter(k=>k.categoria===s.categoria&&k.segmento===s.segmento&&k.ambito==="TLC").sort((k,V)=>k.sogliaMin-V.sogliaMin);if(p.length===0)return;const D=p.reduce((k,V)=>V.sogliaMax===null||V.sogliaMax===0?V:k.sogliaMax===null||k.sogliaMax===0?k:V.sogliaMax>k.sogliaMax?V:k),M=(D.sogliaMax||D.sogliaMin+10)*D.importoPerPezzo,F=M-s.euroAttuali;F>0&&(a+=F),console.log(`[CompensiRealtimeWide] ${d}:`,{qtyAttuale:s.qtyTotale,euroAttuali:s.euroAttuali,sogliaMax:D.sogliaMin+"-"+(D.sogliaMax||"âˆž"),importoPerPezzo:D.importoPerPezzo,compensoMassimo:M,differenza:F})}),a})(),$={};if(r?.dettagli&&Array.isArray(r.dettagli)){console.log("[CompensiRealtimeWide] Processing dettagli:",r.dettagli.length);const t=new Map;r.dettagli.forEach(a=>{const s=a.ambito||"ALTRO";t.has(s)||t.set(s,{euro:0,qty:0});const d=t.get(s);d.euro+=a.euroCalcolati||0,d.qty+=a.qty||0}),t.forEach((a,s)=>{$[s.toLowerCase()]=a}),console.log("[CompensiRealtimeWide] Breakdown calculated:",$)}else console.log("[CompensiRealtimeWide] No dettagli found in data:",r);const U=(()=>{const t=[];if(!r?.soglie||!r?.dettagli)return t;const a=new Map;if(r.dettagli.forEach(s=>{if(s.ambito!=="TLC")return;const d=`${s.categoria}_${s.segmento}`;a.has(d)||a.set(d,{categoria:s.categoria,segmento:s.segmento,qtyTotale:0,euroAttuali:0,sogliaAttuale:s.sogliaMin});const p=a.get(d);p.qtyTotale+=s.qty||0,p.euroAttuali+=s.euroCalcolati||0}),a.forEach((s,d)=>{const p=r.soglie.filter(M=>M.categoria===s.categoria&&M.segmento===s.segmento&&M.ambito==="TLC").sort((M,F)=>M.sogliaMin-F.sogliaMin);if(p.length===0)return;let D=null,O=null;for(let M=0;M<p.length;M++){const F=p[M];if(s.qtyTotale>=F.sogliaMin&&(F.sogliaMax===null||s.qtyTotale<=F.sogliaMax)){D=F,O=p[M+1]||null;break}}if(O){const M=O.sogliaMin-s.qtyTotale,k=O.sogliaMin*O.importoPerPezzo-s.euroAttuali;t.push({tipo:"SOGLIA_SUCCESSIVA",descrizione:`Raggiungi ${s.categoria} ${s.segmento} livello ${O.sogliaMin}+`,categoria:`${s.categoria} ${s.segmento}`,attualeQty:s.qtyTotale,targetQty:O.sogliaMin,mancano:M,importoAttuale:D?.importoPerPezzo||0,importoProssimo:O.importoPerPezzo,guadagnoExtra:Math.max(0,k),urgenza:M<=2?"alta":M<=5?"media":"bassa",percentualeAttuale:Math.round(s.qtyTotale/O.sogliaMin*100),percentualeTarget:100})}}),A>E){const s=A-E,d=Math.round(E/A*100);t.push({tipo:"POTENZIALE",descrizione:"Raggiungi il potenziale massimo",percentualeAttuale:d,percentualeTarget:100,guadagnoExtra:s,urgenza:d<70?"alta":d<85?"media":"bassa"})}return t.sort((s,d)=>{const p={alta:3,media:2,bassa:1};return p[s.urgenza]!==p[d.urgenza]?p[d.urgenza]-p[s.urgenza]:d.guadagnoExtra-s.guadagnoExtra})})(),w=U.slice(0,3),j=t=>{const a=t.toLowerCase();return a.includes("fisso")||a.includes("tlc")?e.jsx(ne,{className:"w-3 h-3 text-blue-600"}):a.includes("mobile")?e.jsx(ie,{className:"w-3 h-3 text-purple-600"}):a.includes("energia")?e.jsx(le,{className:"w-3 h-3 text-green-600"}):e.jsx(J,{className:"w-3 h-3 text-gray-600"})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm ring-1 ring-gray-100 p-4",children:[e.jsx("div",{className:"mb-2 bg-amber-50 border-l-4 border-amber-400 p-1.5 rounded-r-lg",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ae,{className:"w-3 h-3 text-amber-600 flex-shrink-0"}),e.jsx("p",{className:"text-xs font-medium text-amber-900",children:"âš™ï¸ Dati indicativi"})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-green-100 to-emerald-100 rounded flex items-center justify-center",children:e.jsx(Q,{className:"w-3 h-3 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-900",children:"Compensi"}),e.jsx("select",{value:g,onChange:t=>z(t.target.value),className:"text-xs text-gray-600 bg-transparent border-none cursor-pointer hover:text-gray-900 focus:outline-none",children:I.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsx("button",{onClick:L,className:"p-0.5 rounded hover:bg-gray-100 transition-colors",title:"Apri dettaglio",children:e.jsx(re,{className:"w-3 h-3 text-gray-600"})})]}),!W&&e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"ðŸ“Š Nessun dato disponibile"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Non ci sono compensi calcolati per questo mese o non sono ancora state configurate le regole di compenso."})]}),W&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-1.5 mb-2",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded p-1.5 border border-green-200",children:[e.jsx("p",{className:"text-xs font-medium text-green-900",children:"Maturato"}),e.jsx("p",{className:"text-sm font-bold text-green-600",children:R.format(E)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded p-1.5 border border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-blue-900",children:"Proiezione"}),e.jsx("p",{className:"text-sm font-bold text-blue-600",children:R.format(K)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded p-1.5 border border-purple-200",children:[e.jsx("p",{className:"text-xs font-medium text-purple-900",children:"Potenziale"}),e.jsx("p",{className:"text-sm font-bold text-purple-600",children:R.format(A)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(Z,{className:"w-3 h-3 mr-1 text-blue-600"}),"Breakdown"]}),e.jsx("div",{className:"space-y-1",children:Object.entries($).length>0?Object.entries($).map(([t,a])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[j(t),e.jsx("span",{className:"text-gray-700 capitalize",children:t.replace("_"," ").replace("tlc ","")})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:R.format(a.euro)}),e.jsxs("span",{className:"text-gray-500 text-xs",children:["(",a.qty,")"]})]})]},t)):e.jsx("p",{className:"text-xs text-gray-500",children:"Nessun dato"})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center",children:[e.jsx(J,{className:"w-3 h-3 mr-1 text-orange-600"}),"Obiettivi"]}),w.length>0?e.jsx("div",{className:"space-y-1",children:w.slice(0,2).map((t,a)=>e.jsxs("div",{className:`flex items-center justify-between p-1.5 rounded text-xs ${t.urgenza==="alta"?"bg-red-50 border border-red-200":t.urgenza==="media"?"bg-orange-50 border border-orange-200":"bg-blue-50 border border-blue-200"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx("span",{className:"text-xs text-gray-700",children:t.descrizione})}),t.tipo==="SOGLIA_SUCCESSIVA"&&t.mancano&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Mancano ",t.mancano," attivazioni"]}),t.tipo==="POTENZIALE"&&t.percentualeAttuale&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[t.percentualeAttuale,"% â†’ ",t.percentualeTarget||100,"%"]})]}),e.jsxs("span",{className:"font-bold text-green-600 text-xs ml-2",children:["+",R.format(t.guadagnoExtra)]})]},a))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Nessun obiettivo disponibile"})]})]})]}),W&&e.jsx("div",{className:"mt-2 pt-1.5 border-t border-gray-200",children:e.jsxs("button",{onClick:L,className:"w-full flex items-center justify-center space-x-1 px-2 py-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded text-xs font-medium transition-all",children:[e.jsx("span",{children:"Dettagli"}),e.jsx(re,{className:"w-3 h-3"})]})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 bg-black/30 backdrop-blur-sm z-40 transition-opacity duration-300 ${h?"opacity-100":"opacity-0"}`,onClick:B}),e.jsxs("div",{className:`fixed top-0 right-0 h-full w-full max-w-2xl bg-white shadow-xl z-50 flex flex-col transition-transform duration-300 ${h?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Compensi Dettagliati"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(T,_-1).toLocaleDateString("it-IT",{month:"long",year:"numeric"})})]}),e.jsx("button",{onClick:B,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(pe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"mb-6 bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ae,{className:"w-6 h-6 text-amber-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-amber-900 mb-1",children:"âš™ï¸ Dati in Fase di Integrazione"}),e.jsx("p",{className:"text-xs text-amber-700",children:"I compensi e le simulazioni mostrate sono indicativi. Stiamo completando l'integrazione con il sistema di calcolo ufficiale. I dati definitivi saranno disponibili a breve."})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 mb-6 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900 mb-1",children:"Totale Maturato"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:R.format(E)})]}),e.jsx("div",{className:"w-16 h-16 bg-green-200 rounded-full flex items-center justify-center",children:e.jsx(Q,{className:"w-8 h-8 text-green-700"})})]})}),Object.keys($).length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Z,{className:"w-5 h-5 mr-2 text-blue-600"}),"Breakdown per Categoria"]}),e.jsx("div",{className:"space-y-3",children:Object.entries($).map(([t,a])=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 uppercase",children:t.replace("_"," ")}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:R.format(a.euro)})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:[a.qty," attivazioni"]}),e.jsxs("span",{children:["Media: ",R.format(a.importoMedio)]})]})]},t))})]}),U.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(J,{className:"w-5 h-5 mr-2 text-orange-600"}),"OpportunitÃ  di Guadagno"]}),e.jsx("div",{className:"space-y-4",children:U.map((t,a)=>e.jsxs("div",{className:`border-2 rounded-xl p-4 ${t.urgenza==="alta"?"border-red-300 bg-red-50":t.urgenza==="media"?"border-orange-300 bg-orange-50":"border-blue-300 bg-blue-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:t.tipo==="POTENZIALE"?"ðŸš€":t.tipo==="SOGLIA_SUCCESSIVA"?"ðŸŽ¯":"âš–ï¸"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.descrizione}),t.categoria&&e.jsx("p",{className:"text-xs text-gray-600",children:t.categoria})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+",R.format(t.guadagnoExtra)]})})]}),t.tipo==="SOGLIA_SUCCESSIVA"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Attivazioni attuali:"}),e.jsx("span",{className:"font-semibold",children:t.attualeQty})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Prossima soglia:"}),e.jsx("span",{className:"font-semibold",children:t.targetQty})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold",children:[e.jsx("span",{className:"text-gray-900",children:"Mancano:"}),e.jsxs("span",{className:"text-orange-600",children:[t.mancano," attivazioni"]})]}),e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-xs text-blue-900",children:["ðŸ’° Compenso attuale: ",R.format(t.importoAttuale),"/pezzo â†’ Prossimo: ",R.format(t.importoProssimo),"/pezzo"]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${t.percentualeAttuale}%`}})})})]}),t.tipo==="POTENZIALE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Progresso attuale:"}),e.jsxs("span",{className:"font-semibold",children:[t.percentualeAttuale,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Obiettivo:"}),e.jsxs("span",{className:"font-semibold",children:[t.percentualeTarget,"%"]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${t.percentualeAttuale}%`}})})})]})]},a))})]}),A>0&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(fe,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-900",children:"Potenziale Massimo"}),e.jsx("p",{className:"text-sm text-purple-700",children:r?.potenzialeMassimo?.dettaglio||"Con tutti i livelli e bonus raggiungibili"})]})]}),e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsx("span",{className:"text-4xl font-bold text-purple-600",children:R.format(A)}),A>E&&e.jsxs("span",{className:"text-lg font-semibold text-purple-500",children:["(+",r?.potenzialeMassimo?.incrementoPercentuale||Math.round((A-E)/E*100),"%)"]})]})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:e.jsx("button",{onClick:B,className:"w-full px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors font-medium",children:"Chiudi"})})]})]})]})}function Te(){const i=ee(),[r,c]=n.useState(!1),[m,x]=n.useState(!1);n.useEffect(()=>{const l=localStorage.getItem("eni-promo-dismissed"),N=new Date().toDateString();if(l===N)return;const h=setTimeout(()=>{c(!0)},2e3);return()=>clearTimeout(h)},[]);const b=()=>{c(!1),x(!0),localStorage.setItem("eni-promo-dismissed",new Date().toDateString())},u=()=>{b(),i("/dealer/activations")};return!r||m?null:e.jsx("div",{className:"fixed bottom-6 right-6 z-50 animate-slide-up",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl ring-1 ring-gray-200 max-w-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-yellow-400 to-amber-500 px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âš¡"}),e.jsx("span",{className:"text-sm font-bold text-white",children:"NovitÃ !"})]}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-100 transition-colors","aria-label":"Chiudi",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-white rounded-lg p-2 shadow-sm ring-1 ring-gray-100",children:e.jsx("img",{src:"https://kimweb.agency/wp-content/uploads/2024/11/Eni_Plenitude_logo.svg.png",alt:"ENI Plenitude",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900",children:"Nuovo operatore disponibile!"}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-yellow-700",children:"ENI Plenitude"})," Ã¨ ora attivo"]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Scopri le offerte Luce & Gas con condizioni esclusive per i tuoi clienti."}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-300 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-bold text-green-800",children:"ðŸŒ Fibra Ultraveloce di Plenitude"}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-md",children:"OFFERTA SPECIALE"})]}),e.jsxs("p",{className:"text-xs text-green-700 mb-2",children:["Se sei cliente Eni Plenitude Luce puoi avere la ",e.jsx("span",{className:"font-semibold",children:"Fibra fino a 2,5 Gbps in download"})," e ",e.jsx("span",{className:"font-semibold",children:"fino a 1 Gbps in upload"}),"."]}),e.jsx("div",{className:"bg-white rounded-lg p-2 border-2 border-green-400",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-2xl font-black text-green-700",children:"16,90â‚¬"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-[10px] text-gray-600 leading-tight",children:"/mese"}),e.jsx("div",{className:"text-[10px] font-semibold text-green-700 leading-tight",children:"per 3 anni"})]})]})})]}),e.jsxs("button",{onClick:u,className:"w-full bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white font-semibold py-2.5 px-4 rounded-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2 shadow-md",children:[e.jsx("span",{children:"ðŸ‘‰ Scopri le offerte"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})})}function $e(){const{user:i}=Y(),r=be(),c=ee(),[m,x]=n.useState(0);n.useEffect(()=>{const u=()=>x(l=>l+1);return window.addEventListener("plafond-updated",u),()=>window.removeEventListener("plafond-updated",u)},[]),n.useEffect(()=>{if(r?.state&&r.state.openTopUp){try{window.dispatchEvent(new Event("open-plafond-topup"))}catch{}c(r.pathname,{replace:!0,state:{}})}},[r,c]);const b=i?.dealerId||i?.idDealer||null;return e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsx(Ie,{},m)}),e.jsx("div",{children:e.jsx(ve,{dealerId:b})}),e.jsx("div",{children:e.jsx(Pe,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[e.jsx(Ne,{}),e.jsx(ye,{})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[e.jsx(Me,{}),e.jsx(Ce,{})]}),e.jsx(Ee,{}),e.jsx(Te,{})]})})}export{$e as default};
