import{r as t,j as e,U as j,S,_ as C,$ as N,T as z,z as L}from"./vendor.js";import{u as A}from"./index.js";import{D as E}from"./DashboardLayout.js";import"./logo2.js";function O(){const{user:I}=A(),[r,x]=t.useState(null),[i,h]=t.useState(""),[v,w]=t.useState([]),[u,n]=t.useState(!1),[o,d]=t.useState(null),[m,g]=t.useState(!1),[p,c]=t.useState("");t.useEffect(()=>{(async()=>{try{const a=await fetch("/api/supermaster/compensi-dealer/dealers",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const l=await a.json();w(l.dealers||[])}}catch(a){console.error("Errore caricamento dealer:",a)}})()},[]);const b=v.filter(s=>s.ragioneSociale?.toLowerCase().includes(i.toLowerCase())||s.agente?.toLowerCase().includes(i.toLowerCase())||s.citta?.toLowerCase().includes(i.toLowerCase())||s.provincia?.toLowerCase().includes(i.toLowerCase())),y=s=>{x(s),h(s.ragioneSociale),n(!1),f(s)},f=async(s=r)=>{if(!s){c("Seleziona un dealer");return}g(!0),c("");try{const a=await fetch(`/api/masterprodotti/plafond/${s.idDealer}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const l=await a.json();console.log("[PLAFOND] Risposta API:",l),d(l)}else{const l=await a.json();console.error("[PLAFOND] Errore API:",l),c(l.error||"Errore nel caricamento del plafond"),d(null)}}catch(a){c("Errore di connessione"),console.error("Errore ricerca plafond:",a),d(null)}finally{g(!1)}},D=()=>{r&&(f(),L.success("Plafond aggiornato"))};return e.jsx(E,{children:e.jsx("div",{className:"space-y-6 p-4 sm:p-6 lg:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Plafond Dealer"}),e.jsx("p",{className:"text-gray-600",children:"Visualizza il credito disponibile per ogni dealer"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(j,{className:"inline w-4 h-4 mr-1"}),"Cerca Dealer"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:s=>{h(s.target.value),n(!0),s.target.value||(x(null),d(null))},onFocus:()=>n(!0),placeholder:"Cerca per nome, agente, città...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10"}),e.jsx(S,{className:"absolute right-3 top-2.5 w-4 h-4 text-gray-400"}),u&&b.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:b.slice(0,10).map(s=>e.jsxs("div",{onClick:()=>y(s),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.ragioneSociale}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center justify-between",children:[e.jsxs("span",{children:["Agente: ",s.agente||"N/A"]}),e.jsxs("span",{children:[s.citta," (",s.provincia,")"]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",s.idDealer]})]},s.idDealer))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:D,disabled:m||!r,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Caricamento..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4"}),"Aggiorna"]})})})]}),p&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-red-600 text-sm",children:p})})]}),o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:r?.ragioneSociale}),e.jsxs("p",{className:"text-gray-600",children:["Agente: ",r?.agente||"N/A"," • ",r?.citta," (",r?.provincia,")"]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-500 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900 mb-1",children:"Credito Plafond Disponibile"}),e.jsx("p",{className:"text-4xl font-bold text-green-900",children:o.credito?.toLocaleString("it-IT",{style:"currency",currency:"EUR",minimumFractionDigits:2})||"€0,00"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"ID Dealer"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:o.dealerId||r?.idDealer})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-purple-900",children:"Stato"})]}),e.jsx("p",{className:"text-lg font-semibold text-purple-900",children:o.credito>0?"✅ Credito Disponibile":"⚠️ Nessun Credito"})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-1",children:"Informazioni sul Plafond"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Il credito plafond rappresenta il saldo disponibile per questo dealer, calcolato dalla somma di tutte le transazioni registrate nel sistema."})]})]})})]}),!o&&!m&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun dato disponibile"}),e.jsx("p",{className:"text-gray-500",children:"Cerca un dealer per visualizzare il credito plafond disponibile"})]}),u&&e.jsx("div",{className:"fixed inset-0 z-5",onClick:()=>n(!1)})]})})})}export{O as default};
