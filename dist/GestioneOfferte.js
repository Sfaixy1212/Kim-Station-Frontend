import{r as o,j as e,z as n}from"./vendor.js";import{b as T,g as C,p as z}from"./index.js";import{A as I}from"./Topbar.js";function A({offerta:t,onUpdate:p}){const[c,x]=o.useState(!1),[g,u]=o.useState(!1),[i,h]=o.useState({ValidaDal:t.ValidaDal?t.ValidaDal.split("T")[0]:"",ValidaAl:t.ValidaAl?t.ValidaAl.split("T")[0]:"",Crediti:(t.Crediti||0)/100,Titolo:t.Titolo||"",DescrizioneBreve:t.DescrizioneBreve||""}),y=new Date(t.ValidaAl)>=new Date,m=(d,b)=>{h(r=>({...r,[d]:b}))},v=()=>{x(!0)},j=()=>{h({ValidaDal:t.ValidaDal?t.ValidaDal.split("T")[0]:"",ValidaAl:t.ValidaAl?t.ValidaAl.split("T")[0]:"",Crediti:(t.Crediti||0)/100,Titolo:t.Titolo||"",DescrizioneBreve:t.DescrizioneBreve||""}),x(!1)},N=async()=>{if(!i.ValidaDal||!i.ValidaAl){n.error("Date validità obbligatorie");return}if(new Date(i.ValidaDal)>new Date(i.ValidaAl)){n.error('Data "Valida Dal" deve essere precedente a "Valida Al"');return}if(i.Crediti<0){n.error("Crediti non possono essere negativi");return}if(!i.Titolo.trim()){n.error("Titolo obbligatorio");return}u(!0);const d=n.loading("Salvataggio in corso...");try{const b={...i,Crediti:Math.round(i.Crediti*100)};await T(`/admin/offerte/${t.IDOfferta}`,b),n.success("Offerta aggiornata con successo"),x(!1),p()}catch(b){console.error("[SAVE OFFERTA][ERR]",b),n.error(b?.message||"Errore durante il salvataggio")}finally{n.dismiss(d),u(!1)}};return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden transition-all ${c?"ring-2 ring-blue-500":""} ${y?"":"opacity-75"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.LogoOperatore&&e.jsx("img",{src:t.LogoOperatore,alt:t.NomeOperatore,className:"h-8 w-auto object-contain"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t.NomeOperatore})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${y?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:y?"ATTIVA":"SCADUTA"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Titolo"}),c?e.jsx("input",{type:"text",value:i.Titolo,onChange:d=>m("Titolo",d.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded px-2 py-1 text-sm",maxLength:200}):e.jsx("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t.Titolo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Descrizione Breve"}),c?e.jsx("textarea",{value:i.DescrizioneBreve,onChange:d=>m("DescrizioneBreve",d.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded px-2 py-1 text-sm",rows:3,maxLength:500}):e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-3",children:t.DescrizioneBreve||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Crediti (€)"}),c?e.jsx("input",{type:"number",step:"0.01",value:i.Crediti,onChange:d=>m("Crediti",parseFloat(d.target.value)||0),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded px-2 py-1 text-sm"}):e.jsxs("p",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400",children:["€ ",(parseFloat(t.Crediti||0)/100).toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Valida Dal"}),c?e.jsx("input",{type:"date",value:i.ValidaDal,onChange:d=>m("ValidaDal",d.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded px-2 py-1 text-xs"}):e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date(t.ValidaDal).toLocaleDateString("it-IT")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Valida Al"}),c?e.jsx("input",{type:"date",value:i.ValidaAl,onChange:d=>m("ValidaAl",d.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded px-2 py-1 text-xs"}):e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date(t.ValidaAl).toLocaleDateString("it-IT")})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tipo:"}),e.jsx("span",{className:"font-medium",children:t.Tipo})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Segmento:"}),e.jsx("span",{className:"font-medium",children:t.Segmento})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Template:"}),e.jsx("span",{className:"font-medium text-xs truncate ml-2",children:t.TemplateDatiOfferta})]})]})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700",children:c?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:j,disabled:g,className:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md text-sm font-medium transition-colors disabled:opacity-50",children:"Annulla"}),e.jsx("button",{onClick:N,disabled:g,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-medium transition-colors disabled:opacity-50",children:g?"Salvataggio...":"Salva"})]}):e.jsx("button",{onClick:v,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm font-medium transition-colors",children:"Modifica"})})]})}function V({isOpen:t,onClose:p,onSuccess:c}){const[x,g]=o.useState("base"),[u,i]=o.useState(!1),[h,y]=o.useState(!1),[m,v]=o.useState([]),[j,N]=o.useState([]),[d,b]=o.useState({tipoOfferta:[],segmento:[],tipo:[],simType:[]}),[r,f]=o.useState({idOperatore:"",Titolo:"",DescrizioneBreve:"",Descrizione:"",Tipo:"",Segmento:"",tipoOfferta:"",ValidaDal:"",ValidaAl:"",TemplateDatiOfferta:"",Crediti:0,SpeseSpedizione:0,FixedDiscountPct:0,SIMTYPE:"",SIMCOUNT:1,LimiteSIM:0,LogoLink:"",FullLink:"",isConvergenza:!1,IDOffertaCollegata:0,Offerta_Inviata:!1,OnlyFor:"",RequireCode:!1,CodePrefix:"",CodeLen:null});o.useEffect(()=>{t&&l()},[t]);const l=async()=>{i(!0);try{const[a,k,D]=await Promise.all([C("/admin/operatori"),C("/admin/templates"),C("/admin/offerte/valori-dropdown")]);v(a||[]),N(k||[]),b(D||{tipoOfferta:[],segmento:[],tipo:[],simType:[]}),a&&a.length>0&&f(O=>({...O,idOperatore:a[0].IDOperatore}))}catch(a){console.error("[LOAD INITIAL DATA][ERR]",a),n.error("Errore caricamento dati iniziali")}finally{i(!1)}},s=(a,k)=>{f(D=>({...D,[a]:k}))},S=async()=>{if(!r.idOperatore||!r.Titolo||!r.DescrizioneBreve||!r.Tipo||!r.Segmento||!r.tipoOfferta||!r.ValidaDal||!r.ValidaAl||!r.TemplateDatiOfferta){n.error("Compila tutti i campi obbligatori");return}if(new Date(r.ValidaDal)>new Date(r.ValidaAl)){n.error('Data "Valida Dal" deve essere precedente a "Valida Al"');return}y(!0);const a=n.loading("Creazione offerta in corso...");try{const k={...r,Crediti:Math.round(r.Crediti*100),SpeseSpedizione:Math.round(r.SpeseSpedizione*100)};await z("/admin/offerte",k),n.success("Offerta creata con successo!"),c(),p(),w()}catch(k){console.error("[CREATE OFFERTA][ERR]",k),n.error(k?.message||"Errore durante la creazione")}finally{n.dismiss(a),y(!1)}},w=()=>{f({idOperatore:m[0]?.IDOperatore||"",Titolo:"",DescrizioneBreve:"",Descrizione:"",Tipo:"",Segmento:"",tipoOfferta:"",ValidaDal:"",ValidaAl:"",TemplateDatiOfferta:"",Crediti:0,SpeseSpedizione:0,FixedDiscountPct:0,SIMTYPE:"",SIMCOUNT:1,LimiteSIM:0,LogoLink:"",FullLink:"",isConvergenza:!1,IDOffertaCollegata:0,Offerta_Inviata:!1,OnlyFor:"",RequireCode:!1,CodePrefix:"",CodeLen:null}),g("base")};return t?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:p}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Crea Nuova Offerta"}),e.jsx("button",{onClick:p,className:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex -mb-px px-6",children:[{id:"base",label:"Info Base"},{id:"pricing",label:"Pricing"},{id:"sim",label:"SIM"},{id:"avanzate",label:"Avanzate"}].map(a=>e.jsx("button",{onClick:()=>g(a.id),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors ${x===a.id?"border-red-600 text-red-600 dark:text-red-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:a.label},a.id))})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Caricamento..."})]}):e.jsxs(e.Fragment,{children:[x==="base"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Operatore ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:r.idOperatore,onChange:a=>s("idOperatore",parseInt(a.target.value)),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",children:m.map(a=>e.jsx("option",{value:a.IDOperatore,children:a.Denominazione},a.IDOperatore))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Tipo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.Tipo,onChange:a=>s("Tipo",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seleziona..."}),d.tipo.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Titolo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.Titolo,onChange:a=>s("Titolo",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",maxLength:200})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Descrizione Breve ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:r.DescrizioneBreve,onChange:a=>s("DescrizioneBreve",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",rows:3,maxLength:500})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Descrizione Completa"}),e.jsx("textarea",{value:r.Descrizione,onChange:a=>s("Descrizione",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Segmento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.Segmento,onChange:a=>s("Segmento",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seleziona..."}),d.segmento.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Tipo Offerta ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.tipoOfferta,onChange:a=>s("tipoOfferta",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seleziona..."}),d.tipoOfferta.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Valida Dal ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:r.ValidaDal,onChange:a=>s("ValidaDal",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Valida Al ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:r.ValidaAl,onChange:a=>s("ValidaAl",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Template Dati Offerta ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.TemplateDatiOfferta,onChange:a=>s("TemplateDatiOfferta",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seleziona template..."}),j.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),x==="pricing"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Crediti (€)"}),e.jsx("input",{type:"number",step:"0.01",value:r.Crediti,onChange:a=>s("Crediti",parseFloat(a.target.value)||0),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",placeholder:"Es: 7.00 per 7 euro"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Spese Spedizione (€)"}),e.jsx("input",{type:"number",step:"0.01",value:r.SpeseSpedizione,onChange:a=>s("SpeseSpedizione",parseFloat(a.target.value)||0),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sconto Fisso (%)"}),e.jsx("input",{type:"number",step:"0.01",value:r.FixedDiscountPct,onChange:a=>s("FixedDiscountPct",parseFloat(a.target.value)||0),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]})]})}),x==="sim"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tipo SIM"}),e.jsxs("select",{value:r.SIMTYPE,onChange:a=>s("SIMTYPE",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seleziona..."}),d.simType.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Numero SIM"}),e.jsx("input",{type:"number",value:r.SIMCOUNT,onChange:a=>s("SIMCOUNT",parseInt(a.target.value)||1),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Limite SIM"}),e.jsx("input",{type:"number",value:r.LimiteSIM,onChange:a=>s("LimiteSIM",parseInt(a.target.value)||0),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]})]})}),x==="avanzate"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Logo Link (URL)"}),e.jsx("input",{type:"text",value:r.LogoLink,onChange:a=>s("LogoLink",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Link (URL)"}),e.jsx("input",{type:"text",value:r.FullLink,onChange:a=>s("FullLink",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",placeholder:"https://..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isConvergenza",checked:r.isConvergenza,onChange:a=>s("isConvergenza",a.target.checked),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("label",{htmlFor:"isConvergenza",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"È Convergenza"})]}),r.isConvergenza&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ID Offerta Collegata"}),e.jsx("input",{type:"number",value:r.IDOffertaCollegata,onChange:a=>s("IDOffertaCollegata",parseInt(a.target.value)||0),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Solo Per (IDGruppo)"}),e.jsx("input",{type:"text",value:r.OnlyFor,onChange:a=>s("OnlyFor",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"RequireCode",checked:r.RequireCode,onChange:a=>s("RequireCode",a.target.checked),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("label",{htmlFor:"RequireCode",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Richiede Codice Promo"})]}),r.RequireCode&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Prefisso Codice"}),e.jsx("input",{type:"text",value:r.CodePrefix,onChange:a=>s("CodePrefix",a.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",maxLength:10})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Lunghezza Codice"}),e.jsx("input",{type:"number",value:r.CodeLen||"",onChange:a=>s("CodeLen",parseInt(a.target.value)||null),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"Offerta_Inviata",checked:r.Offerta_Inviata,onChange:a=>s("Offerta_Inviata",a.target.checked),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("label",{htmlFor:"Offerta_Inviata",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Offerta Inviata"})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:p,disabled:h,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-md transition-colors disabled:opacity-50",children:"Annulla"}),e.jsx("button",{onClick:S,disabled:h||u,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors disabled:opacity-50",children:h?"Creazione...":"Crea Offerta"})]})]})})]}):null}function R(){const[t,p]=o.useState([]),[c,x]=o.useState(""),[g,u]=o.useState("tutte"),[i,h]=o.useState([]),[y,m]=o.useState(!1),[v,j]=o.useState({attive:0,scadute:0,totali:0}),[N,d]=o.useState(!1);o.useEffect(()=>{b()},[]),o.useEffect(()=>{c&&r()},[c,g]);const b=async()=>{try{const l=await C("/admin/operatori");p(l||[]),l&&l.length>0&&x(String(l[0].IDOperatore))}catch(l){console.error("[LOAD OPERATORI][ERR]",l),n.error("Errore caricamento operatori")}},r=async()=>{m(!0);try{const l=new URLSearchParams({operatore:c,stato:g}),s=await C(`/admin/offerte?${l}`);h(s?.offerte||[]),j(s?.stats||{attive:0,scadute:0,totali:0})}catch(l){console.error("[LOAD OFFERTE][ERR]",l),n.error("Errore caricamento offerte")}finally{m(!1)}},f=()=>{r()};return e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Gestione Offerte"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Visualizza e modifica le offerte disponibili"})]}),e.jsx("div",{className:"mb-6 bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Operatore"}),e.jsx("select",{value:c,onChange:l=>x(l.target.value),className:"w-full border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md px-3 py-2 text-sm",children:t.map(l=>e.jsx("option",{value:l.IDOperatore,children:l.Denominazione},l.IDOperatore))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Stato Offerte"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("tutte"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${g==="tutte"?"bg-red-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Tutte"}),e.jsx("button",{onClick:()=>u("attive"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${g==="attive"?"bg-green-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Attive"}),e.jsx("button",{onClick:()=>u("scadute"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${g==="scadute"?"bg-gray-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Scadute"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Totali:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-900 dark:text-gray-100",children:v.totali})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Attive:"}),e.jsx("span",{className:"ml-2 font-semibold text-green-700 dark:text-green-300",children:v.attive})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Scadute:"}),e.jsx("span",{className:"ml-2 font-semibold text-gray-600 dark:text-gray-400",children:v.scadute})]})]})]})}),e.jsx("div",{className:"mb-6 flex justify-end",children:e.jsx("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow text-sm font-medium",children:"+ Crea Nuova Offerta"})}),y&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Caricamento offerte..."})]}),!y&&i.length===0&&e.jsx("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Nessuna offerta trovata"})}),!y&&i.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(l=>e.jsx(A,{offerta:l,onUpdate:f},l.IDOfferta))}),e.jsx(V,{isOpen:N,onClose:()=>d(!1),onSuccess:f})]})]})}export{R as default};
