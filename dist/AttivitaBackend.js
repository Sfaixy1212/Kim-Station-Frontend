import{r as c,j as e,z as d}from"./vendor.js";import{S as j}from"./Topbar2.js";import{C as A}from"./Card.js";import{S as o}from"./StatsCard.js";import{g as y,p as w}from"./index.js";const b=a=>{if(!a)return"N/A";try{return new Date(a).toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"N/A"}},T=a=>{switch(a){case"attivazioni@kimweb.it":return"Savana";case"c.loiacono@kimweb.it":return"Chicca";default:return a}},h=a=>{switch(a){case"APPROVE":return"‚úÖ";case"REJECT":return"‚ùå";case"CHANGE_STATUS":return"üîÑ";default:return"üìù"}},g=a=>{switch(a){case"APPROVE":return"Approvato";case"REJECT":return"Rifiutato";case"CHANGE_STATUS":return"Cambio Stato";default:return a}},E=a=>{switch(a){case"CONTRATTO":return"üìÑ";case"ATTIVAZIONE":return"üì±";default:return"üìã"}};function D(){const[a,u]=c.useState({targets:[]}),[r,n]=c.useState(!1),[x,l]=c.useState(""),m=async({skipLoader:s}={})=>{const i=!s;i&&n(!0),l("");try{const t=await y("/supermaster/backend-activity");return u(t||{targets:[]}),!0}catch(t){return console.error("[ATTIVITA-BACKEND] Errore:",t),l("Errore nel caricamento delle attivit√† backend"),d.error("Errore nel caricamento dati"),!1}finally{i&&n(!1)}};c.useEffect(()=>{m()},[]);const f=async()=>{n(!0),l("");try{if(await w("/supermaster/backend-activity/refresh",{daysBack:60,dryRun:!1}),await m({skipLoader:!0}))try{d.success("Attivit√† aggiornate")}catch{}}catch(s){console.error("[ATTIVITA-BACKEND][REFRESH] Errore:",s),l("Errore durante il refresh delle attivit√† backend");try{d.error("Errore durante il refresh delle attivit√† backend")}catch{}}finally{n(!1)}},p=a.targets.reduce((s,i)=>s+i.totalActivities,0),v=a.targets.filter(s=>s.totalActivities>0).length;return e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Attivit√† Backoffice"}),e.jsx("button",{onClick:f,disabled:r,className:`px-4 py-2 text-sm rounded-md text-white ${r?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:r?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"Aggiornamento..."]}):"Aggiorna"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(o,{title:"Account Monitorati",value:a.targets.length.toString(),icon:"üë•",trend:"flat"}),e.jsx(o,{title:"Account Attivi",value:v.toString(),icon:"üü¢",trend:"flat"}),e.jsx(o,{title:"Attivit√† Totali",value:p.toString(),icon:"üìä",trend:"flat"}),e.jsx(o,{title:"Ultimo Aggiornamento",value:new Date().toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),icon:"üïê",trend:"flat"})]}),r&&e.jsx("div",{className:"w-full h-1 bg-gray-200 rounded overflow-hidden",children:e.jsx("div",{className:"h-1 bg-blue-600 animate-[progress_1.2s_ease-in-out_infinite]",style:{width:"40%"}})}),x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Errore"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:x})]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:a.targets.map((s,i)=>e.jsx(A,{title:`OPERATORE: ${T(s.email)}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Attivit√† Totali"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:s.totalActivities})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Ultima Attivit√†"}),e.jsx("div",{className:"text-sm text-gray-700",children:s.lastActivityPretty||"Nessuna attivit√†"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Ultima Azione"}),e.jsx("div",{className:"text-sm text-gray-700 flex items-center gap-1",children:s.lastAction?e.jsxs(e.Fragment,{children:[h(s.lastAction),g(s.lastAction)]}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Master ID"}),e.jsx("div",{className:"text-sm text-gray-700 font-mono",children:s.masterId||"N/A"})]})]}),s.rows&&s.rows.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Attivit√† Recenti (ultime 20)"}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:s.rows.map((t,N)=>e.jsxs("div",{className:"border rounded-lg p-3 bg-white hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[E(t.entityType),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[t.entityType," #",t.entityId]}),t.titoloOfferta&&t.entityType==="ATTIVAZIONE"&&e.jsx("span",{className:"text-xs text-gray-500 italic",children:t.titoloOfferta})]}),h(t.action),e.jsx("span",{className:"text-sm text-gray-600",children:g(t.action)})]}),e.jsx("div",{className:"text-xs text-gray-500",children:b(t.createdAt)})]}),(t.statoPrecedente||t.statoSuccessivo)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Stato: ",t.statoPrecedenteDesc||t.statoPrecedente||"N/A"," ‚Üí ",t.statoSuccessivoDesc||t.statoSuccessivo||"N/A"]}),t.motivazione&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Motivazione:"})," ",t.motivazione.substring(0,100),t.motivazione.length>100&&"..."]}),t.ipAddress&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 font-mono",children:["IP: ",t.ipAddress]})]},N))})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"üì≠"}),e.jsx("div",{className:"text-sm",children:"Nessuna attivit√† registrata"})]})]})},s.email))}),!r&&a.targets.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üîç"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun account monitorato"}),e.jsx("p",{className:"text-gray-500",children:"Non sono stati trovati account da monitorare."})]})]})]})}export{D as default};
