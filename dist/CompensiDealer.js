import{r as o,j as e,C as re,U,S as N,e as le,E as D,T as ie,I as A,f as V,g as q,X as ne,h as F,L as oe}from"./vendor.js";import{u as ce}from"./index.js";import{S as de}from"./Topbar2.js";function he(){const{user:xe}=ce(),[u,K]=o.useState(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`}),[n,k]=o.useState(null),[b,P]=o.useState(""),[G,Q]=o.useState([]),[I,j]=o.useState(!1),[i,_]=o.useState(null),[y,f]=o.useState(!1),[O,h]=o.useState(""),[J,v]=o.useState({}),[X,$]=o.useState({}),[l,p]=o.useState({open:!1,bucket:null,bucketOriginale:null,data:[],loading:!1,error:"",page:1,search:"",totaleEuro:0}),w=50,g=t=>Number(t||0).toLocaleString("it-IT",{style:"currency",currency:"EUR"}),H=t=>{if(!t)return"-";try{const s=new Date(t);return Number.isNaN(s.getTime())?t:s.toLocaleDateString("it-IT")}catch{return t}},T=(t,s)=>{const a=Number(s)<0;switch(t){case"ANTICIPO":return"border-red-200 bg-red-50 text-red-700";case"CESSIONE_SIM":return"border-amber-200 bg-amber-50 text-amber-700";default:return a?"border-red-200 bg-red-50 text-red-700":"border-blue-200 bg-blue-50 text-blue-700"}},M=t=>{try{const s=new URLSearchParams(window.location.search),a=Object.entries(t).filter(([,c])=>c).map(([c])=>c).join(",");a?s.set("seg",a):s.delete("seg");const r=s.toString(),m=`${window.location.pathname}${r?`?${r}`:""}`;window.history.replaceState({},"",m)}catch(s){console.warn("Impossibile aggiornare querystring segmenti",s)}};o.useEffect(()=>{const s=new URLSearchParams(window.location.search).get("seg");if(s){const a={};s.split(",").forEach(r=>{r&&(a[r]=!0)}),v(a)}},[]),o.useEffect(()=>{(async()=>{try{const s=await fetch("/api/supermaster/compensi-dealer/dealers",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const a=await s.json();Q(a.dealers||[])}}catch(s){console.error("Errore caricamento dealer:",s)}})()},[]);const L=G.filter(t=>t.ragioneSociale?.toLowerCase().includes(b.toLowerCase())||t.agente?.toLowerCase().includes(b.toLowerCase())||t.citta?.toLowerCase().includes(b.toLowerCase())||t.provincia?.toLowerCase().includes(b.toLowerCase())),Y=t=>{k(t),P(t.ragioneSociale),j(!1)},Z=async()=>{if(!n){h("Seleziona un dealer");return}f(!0),h("");try{const t=`${u}-01`,s=await fetch("/api/supermaster/compensi-dealer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({monthStart:t,dealerId:n.idDealer})});if(s.ok){const a=await s.json();console.log("[COMPENSI DEALER] Risposta API:",a),_(a),p(r=>({...r,open:!1,bucket:null,bucketOriginale:null,data:[],error:"",page:1,search:"",totaleEuro:0}))}else{const a=await s.json();console.error("[COMPENSI DEALER] Errore API:",a),h(a.message||"Errore nel caricamento dei compensi")}}catch(t){h("Errore di connessione"),console.error("Errore ricerca compensi:",t)}finally{f(!1)}},W=async()=>{if(!(!i||!n))try{f(!0);const t=(i.grouped||[]).map(r=>({nome:r.segmento,categorie:r.categorie.flatMap(m=>m.buckets.map(c=>({nome:m.categoria,bucket:c.bucket,qty:c.qtyTotale,importoPerPezzo:c.rows.find(d=>d.ambito==="TLC")?.importoPerPezzo??c.rows[0]?.importoPerPezzo??0,euroCalcolati:c.totale,note:c.rows[0]?.note||""})))})),s={dealer:{ragioneSociale:n.ragioneSociale,indirizzo:n.indirizzo||"",cap:n.cap||"",citta:n.citta||"",provincia:n.provincia||"",piva:n.piva||"",agente:n.agente||""},intestatario:{ragioneSociale:"KIM srls",indirizzo:"Via Appia, 322/324",cap:"72100",citta:"Brindisi",provincia:"BR",piva:"02567150749",codiceFiscale:"02567150749",codiceDestinatario:"M5UXCR1"},compensi:{mese:new Date(u+"-01").toLocaleDateString("it-IT",{month:"long",year:"numeric"}),totaleCompensi:i.totaleCompensi,totaleAttivazioni:i.totaleAttivazioni,segmenti:t,dettagli:i.dettagli||[]},dataGenerazione:new Date().toLocaleDateString("it-IT"),numeroProgressivo:`INV-${n.idDealer}-${u.replace("-","")}`},a=await fetch("/api/supermaster/compensi-dealer/genera-invito",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(s)});if(a.ok){const r=await a.json();r.success&&r.downloadUrl?(window.open(r.downloadUrl,"_blank"),console.log("Invito a fatturare generato:",r.filename)):h(r.message||"Errore nella generazione dell'invito")}else{const r=await a.json();h(r.message||"Errore nella generazione dell'invito")}}catch(t){h("Errore di connessione durante la generazione dell'invito"),console.error("Errore generazione invito:",t)}finally{f(!1)}},S=o.useMemo(()=>i?.totaliPerAmbito||[],[i]);o.useEffect(()=>{i?.grouped&&(v(t=>{const s={...t};let a=!1;return i.grouped.forEach(r=>{s[r.segmento]===void 0&&(s[r.segmento]=!0,a=!0)}),a&&M(s),s}),$(t=>{const s={...t};return i.grouped.forEach(a=>{a.categorie.forEach(r=>{const m=`${a.segmento}|${r.categoria}`;s[m]===void 0&&(s[m]=!0)})}),s}))},[i]);const ee=t=>{v(s=>{const a={...s,[t]:!s[t]};return M(a),a})},te=(t,s)=>{const a=`${t}|${s}`;$(r=>({...r,[a]:!r[a]}))},se=async(t,s)=>{if(n){p(a=>({...a,open:!0,bucket:t,bucketOriginale:s,loading:!0,error:"",data:[],page:1,search:""}));try{const a=new URLSearchParams({monthStart:`${u}-01`,dealerId:n.idDealer,bucket:t}),r=await fetch(`/api/supermaster/compensi-dealer/attivazioni?${a.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!r.ok){const c=await r.json().catch(()=>({}));throw new Error(c.message||"Errore nel recupero attivazioni")}const m=await r.json();p(c=>({...c,loading:!1,data:m.attivazioni||[],totaleEuro:m.totaleEuro??0}))}catch(a){console.error("[COMPENSI DEALER] Drill-down error:",a),p(r=>({...r,loading:!1,error:a.message||"Errore inatteso durante il caricamento delle attivazioni"}))}}},R=()=>{p(t=>({...t,open:!1,bucket:null,bucketOriginale:null,data:[],error:"",search:"",page:1,totaleEuro:0}))},C=o.useMemo(()=>{if(!l.search)return l.data;const t=l.search.toLowerCase();return l.data.filter(s=>[s.activationKey,s.mnpOperator,s.numeroPratica,s.numeroOrdine,s.sottoVoce].filter(Boolean).some(a=>a.toLowerCase().includes(t)))},[l.data,l.search]),z=Math.max(1,Math.ceil(C.length/w)),B=C.slice((l.page-1)*w,l.page*w);o.useEffect(()=>{p(t=>({...t,page:1}))},[l.search]);const E=(t,s)=>e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-full border ${s}`,children:t});return e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Compensi Dealer"}),e.jsx("p",{className:"text-gray-600",children:"Calcola e visualizza i compensi per dealer specifico"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"inline w-4 h-4 mr-1"}),"Mese"]}),e.jsx("input",{type:"month",value:u,onChange:t=>K(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(U,{className:"inline w-4 h-4 mr-1"}),"Dealer"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:b,onChange:t=>{P(t.target.value),j(!0),t.target.value||k(null)},onFocus:()=>j(!0),placeholder:"Cerca dealer...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10"}),e.jsx(N,{className:"absolute right-3 top-2.5 w-4 h-4 text-gray-400"}),I&&L.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:L.slice(0,10).map(t=>e.jsxs("div",{onClick:()=>Y(t),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.ragioneSociale}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center justify-between",children:[e.jsxs("span",{children:["Agente: ",t.agente||"N/A"]}),e.jsxs("span",{children:[t.citta," (",t.provincia,")"]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",t.idDealer]})]},t.idDealer))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:Z,disabled:y||!n,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Caricamento..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4"}),"Cerca"]})})})]}),O&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-red-600 text-sm",children:O})})]}),i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:["Riepilogo Compensi Dealer: ",n?.ragioneSociale]}),e.jsxs("p",{className:"text-gray-600",children:["Mese: ",new Date(u+"-01").toLocaleDateString("it-IT",{month:"long",year:"numeric"})]})]}),e.jsxs("button",{onClick:W,disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),y?"Generando...":"GENERA INVITO"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 p-6 rounded-lg mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Compenso Totale"}),e.jsx("p",{className:"text-4xl font-bold text-blue-900",children:g(i.totaleCompensi)})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ie,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-900",children:"Totale Attivazioni (righe TLC)"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:i.totaleAttivazioni||0}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["Qty complessiva TLC: ",i.totaleAttivazioniQty||0]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),"Agente di riferimento"]}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n?.agente||"N/A"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Dealer #",n?.idDealer??"-"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-600 mb-2 flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-blue-500"}),"Totali per Ambito"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.length===0&&e.jsx("span",{className:"text-sm text-gray-500",children:"Nessun ambito disponibile"}),S.map(t=>e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 text-xs font-semibold rounded-full border ${T(t.ambito,t.euro)}`,children:[e.jsx("span",{children:t.ambito}),e.jsx("span",{children:g(t.euro)})]},t.ambito))]})]})]})]}),i.grouped&&i.grouped.length>0?e.jsx("div",{className:"space-y-4",children:i.grouped.map(t=>{const s=J[t.segmento]??!0;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>ee(t.segmento),className:"w-full flex items-center justify-between px-6 py-4 bg-gray-50 border-b border-gray-200 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:t.segmento==="RES"?"ðŸ“ˆ":"ðŸ¢"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.segmento==="RES"?"Segmento Residenziale (RES)":"Segmento Business (SHP)"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Categorie: ",t.categorie.length]})]})]}),s?e.jsx(V,{className:"w-5 h-5 text-gray-500"}):e.jsx(q,{className:"w-5 h-5 text-gray-500"})]}),s&&e.jsx("div",{className:"divide-y divide-gray-200",children:t.categorie.map(a=>{const r=`${t.segmento}|${a.categoria}`,m=X[r]??!0,c=a.categoria.replace(/_/g," ");return e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("button",{type:"button",onClick:()=>te(t.segmento,a.categoria),className:"w-full flex items-center justify-between text-left",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold text-gray-800",children:c}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Bucket: ",a.buckets.length]})]}),m?e.jsx(V,{className:"w-4 h-4 text-gray-500"}):e.jsx(q,{className:"w-4 h-4 text-gray-500"})]}),m&&e.jsx("div",{className:"mt-4 space-y-4",children:a.buckets.map(d=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 bg-gray-50 px-4 py-3 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase text-gray-500",children:"Bucket"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:d.bucket}),d.bucketOriginale&&d.bucketOriginale!==d.bucket&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Bucket originale: ",d.bucketOriginale]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Totale Bucket"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:g(d.totale)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Qty complessiva"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:d.qtyTotale})]}),e.jsxs("button",{type:"button",onClick:()=>se(d.bucket,d.bucketOriginale),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium rounded-md border border-blue-200 text-blue-600 hover:bg-blue-50",children:[e.jsx(N,{className:"w-4 h-4"}),"Vedi attivazioni"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{className:"border-b border-gray-200 text-left text-xs uppercase text-gray-500",children:[e.jsx("th",{className:"px-4 py-2",children:"Ambito"}),e.jsx("th",{className:"px-4 py-2",children:"RuleId"}),e.jsx("th",{className:"px-4 py-2",children:"Note"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Importo unitario"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Totale"})]})}),e.jsxs("tbody",{children:[d.rows.map((x,ae)=>e.jsxs("tr",{className:"border-b last:border-0 border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 align-top",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-full border ${T(x.ambito,x.euroCalcolati)}`,children:x.ambito})}),e.jsx("td",{className:"px-4 py-2 align-top text-sm text-gray-700",children:x.ruleId?e.jsxs("span",{className:"inline-flex items-center gap-1",title:`Soglia min: ${x.sogliaMin??"-"} | Soglia max: ${x.sogliaMax??"-"}`,children:[x.ruleId,e.jsx(A,{className:"w-3 h-3 text-gray-400"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs("td",{className:"px-4 py-2 align-top text-sm text-gray-700 space-y-1",children:[x.note?e.jsx("span",{children:x.note}):e.jsx("span",{className:"text-gray-400",children:"-"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.flags?.esclusoMnpVodafone&&E("Escluso MNP Vodafone","border-orange-300 bg-orange-50 text-orange-700"),x.flags?.scontoMnpVodafone&&E("Sconto 10â‚¬ MNP Voda","border-amber-300 bg-amber-50 text-amber-700"),x.flags?.convergenza&&E("Convergenza","border-emerald-300 bg-emerald-50 text-emerald-700")]})]}),e.jsx("td",{className:"px-4 py-2 text-right font-medium text-gray-900",children:g(x.importoPerPezzo)}),e.jsx("td",{className:"px-4 py-2 text-right text-gray-900 font-medium",children:x.qty}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold text-gray-900",children:g(x.euroCalcolati)})]},`${d.bucket}-${x.ambito}-${ae}`)),e.jsxs("tr",{className:"bg-gray-50 border-t border-gray-200",children:[e.jsx("td",{className:"px-4 py-2 font-semibold text-gray-700",children:"Totale bucket"}),e.jsx("td",{className:"px-4 py-2",colSpan:3}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold text-gray-900",children:d.qtyTotale}),e.jsx("td",{className:"px-4 py-2 text-right font-bold text-gray-900",children:g(d.totale)})]})]})]})})]},`${r}-${d.bucket}`))})]},r)})})]},t.segmento)})}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 text-center text-sm text-gray-500",children:"Nessun dettaglio disponibile per il periodo selezionato."}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-blue-500"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Totali per ambito"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-xs uppercase text-gray-500 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Ambito"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Totale â‚¬"})]})}),e.jsxs("tbody",{children:[S.map(t=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 text-sm font-medium text-gray-700",children:t.ambito}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold text-gray-900",children:g(t.euro)})]},t.ambito)),e.jsxs("tr",{className:"bg-gray-50 border-t border-gray-200",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900",children:"Totale generale"}),e.jsx("td",{className:"px-4 py-3 text-right font-bold text-gray-900",children:g(i.totaleGenerale)})]})]})]})})]})]}),!i&&!y&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(D,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun dato disponibile"}),e.jsx("p",{className:"text-gray-500",children:"Seleziona un dealer e un mese per visualizzare i compensi"})]}),I&&e.jsx("div",{className:"fixed inset-0 z-5",onClick:()=>j(!1)})]})}),l.open&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-40",onClick:R}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-3xl bg-white shadow-xl z-50 flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Dettaglio attivazioni"}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[l.bucket," ",l.bucketOriginale&&l.bucketOriginale!==l.bucket?`(${l.bucketOriginale})`:""]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Totale ",g(l.totaleEuro)," Â· ",l.data.length," righe"]})]}),e.jsx("button",{onClick:R,className:"p-2 rounded-md border border-gray-200 text-gray-500 hover:bg-gray-100",children:e.jsx(ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(F,{className:"w-4 h-4 text-blue-500"}),"Ricerca locale su ActivationKey, Operatore MNP, Numero pratica/ordine."]}),e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(N,{className:"absolute left-3 top-2.5 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:l.search,onChange:t=>p(s=>({...s,search:t.target.value})),placeholder:"Cerca...",className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:l.loading?e.jsxs("div",{className:"h-full flex items-center justify-center text-gray-500",children:[e.jsx(oe,{className:"w-6 h-6 animate-spin mr-2"})," Caricamento attivazioni..."]}):l.error?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-red-500 px-6",children:[e.jsx(F,{className:"w-6 h-6 mb-2"}),e.jsx("p",{className:"text-sm font-semibold",children:l.error})]}):l.data.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 px-6",children:[e.jsx(D,{className:"w-10 h-10 text-gray-300 mb-3"}),e.jsx("p",{className:"text-sm",children:"Nessuna attivazione disponibile per questo bucket."})]}):e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-xs uppercase text-gray-500 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Pratica / Ordine"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"MNP Operator"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"RA"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Convergenza"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"SottoVoce"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Ambito"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Importo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Totale riga"})]})}),e.jsx("tbody",{children:B.map((t,s)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700",children:H(t.dataAttivazione)}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:t.numeroPratica||"-"}),t.numeroOrdine&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Ordine: ",t.numeroOrdine]}),t.activationKey&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Key: ",t.activationKey]})]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700",children:t.mnpOperator||"-"}),e.jsx("td",{className:`px-4 py-2 text-sm font-medium ${t.isRA?"text-emerald-600":"text-gray-500"}`,children:t.isRA?"SÃ¬":"No"}),e.jsx("td",{className:`px-4 py-2 text-sm font-medium ${t.inConvergenza?"text-emerald-600":"text-gray-500"}`,children:t.inConvergenza?"+30â‚¬":"No"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700",children:t.sottoVoce||"-"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700",children:t.ambito}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-gray-700",children:g(t.importoPerPezzo)}),e.jsx("td",{className:"px-4 py-2 text-right text-sm font-semibold text-gray-900",children:g(t.euroCalcolati)})]},`${t.activationKey||s}`))})]})})}),e.jsxs("div",{className:"px-6 py-3 border-t border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Mostra ",B.length," di ",C.length," attivazioni (totale ",l.data.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>p(t=>({...t,page:Math.max(1,t.page-1)})),disabled:l.page===1,className:"px-3 py-1.5 text-sm rounded-md border border-gray-200 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Prec."}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Pagina ",l.page," / ",z]}),e.jsx("button",{type:"button",onClick:()=>p(t=>({...t,page:Math.min(z,t.page+1)})),disabled:l.page===z,className:"px-3 py-1.5 text-sm rounded-md border border-gray-200 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Succ."})]})]})]})]})]})}export{he as default};
