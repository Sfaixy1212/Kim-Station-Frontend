import{r as a,j as e}from"./vendor.js";import{C as v}from"./Card.js";import{d as j}from"./index.js";function C(){const n=new URLSearchParams(typeof window<"u"?window.location.search:""),l=n.get("token")||"",o=decodeURIComponent(n.get("email")||""),[s,x]=a.useState(""),[d,p]=a.useState(""),[i,c]=a.useState(!1),[m,r]=a.useState(""),[g,f]=a.useState(!1),h=a.useMemo(()=>{const t=s.length>=8,u=/[A-Z]/.test(s),b=/[a-z]/.test(s),y=/\d/.test(s);return t&&u&&b&&y},[s]),w=async t=>{if(t.preventDefault(),r(""),!l||!o){r("Link non valido: token o email mancanti.");return}if(s!==d){r("Le password non coincidono.");return}if(!h){r("La password non rispetta i requisiti minimi.");return}c(!0);try{await j("/password-reset-confirm",{method:"POST",body:JSON.stringify({token:l,email:o,newPassword:s})}),f(!0)}catch{r("Token non valido o scaduto. Richiedi un nuovo reset.")}finally{c(!1)}};return e.jsx("div",{className:"min-h-screen w-full bg-gray-50 flex items-center justify-center px-4 py-8",children:e.jsx("div",{className:"w-full max-w-lg",children:e.jsx(v,{title:"Imposta nuova password",subtitle:`Account: ${o||"—"}`,children:g?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 rounded-md bg-emerald-50 border border-emerald-200 text-emerald-700 text-sm",children:"Password aggiornata con successo."}),e.jsx("a",{href:"/login",className:"inline-block px-3 py-2 rounded-md bg-blue-600 text-white text-sm hover:bg-blue-700",children:"Vai al login"})]}):e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[m&&e.jsx("div",{className:"p-3 rounded-md bg-rose-50 border border-rose-200 text-rose-700 text-sm",children:m}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Nuova password"}),e.jsx("input",{type:"password",value:s,onChange:t=>x(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"}),e.jsx("div",{className:"text-[11px] text-gray-500",children:"Min 8 caratteri, almeno 1 maiuscola, 1 minuscola, 1 numero."})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Conferma password"}),e.jsx("input",{type:"password",value:d,onChange:t=>p(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:i,className:"px-3 py-2 rounded-md bg-blue-600 text-white text-sm hover:bg-blue-700 disabled:opacity-60",children:i?"Salvataggio…":"Salva password"}),e.jsx("a",{href:"/login",className:"text-sm text-gray-600 hover:text-gray-800",children:"Annulla"})]})]})})})})}export{C as default};
