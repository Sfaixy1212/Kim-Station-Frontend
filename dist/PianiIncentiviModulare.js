import{j as e,r as o,z as P}from"./vendor.js";import{S as L}from"./Topbar2.js";import{c as _,g as z}from"./index.js";import{t as f,s as j,e as y,r as v}from"./rateizzazioni.js";function T({title:a,subtitle:r,logoSrc:s,rightLogoSrc:t}){return e.jsx("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 text-white mb-6",children:e.jsx("div",{className:"px-6 py-8 sm:px-10",children:e.jsxs("div",{className:"flex items-center gap-4",children:[s&&e.jsx("img",{src:s,alt:"brand",className:"h-10 w-auto drop-shadow"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:a}),r&&e.jsx("p",{className:"text-white/90 mt-1",children:r})]}),e.jsx("div",{className:"ml-auto",children:t&&e.jsx("img",{src:t,alt:"partner",className:"h-10 w-auto opacity-90"})})]})})})}function M({tabs:a=[],current:r,onChange:s}){return e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex flex-wrap gap-2","aria-label":"Tabs",children:a.map(t=>{const i=t.id===r;return e.jsxs("button",{onClick:()=>s?.(t.id),className:(i?"border-indigo-500 text-indigo-600 bg-indigo-50":"border-transparent text-gray-600 hover:text-gray-800 hover:bg-gray-50")+" whitespace-nowrap rounded-t-md border px-4 py-2 text-sm font-medium transition-colors",children:[t.icon&&e.jsx("span",{className:"mr-2",children:t.icon}),t.label]},t.id)})})})}function N({title:a,columns:r=[],rows:s=[],footnotes:t=[]}){return e.jsxs("div",{className:"mb-6",children:[a&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:a}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 bg-white shadow-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:r.map((i,n)=>e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:i},n))})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.map((i,n)=>e.jsx("tr",{className:n%2?"bg-white":"bg-gray-50/40",children:i.map((l,c)=>e.jsx("td",{className:"px-4 py-2 whitespace-pre-line text-gray-800",children:l},c))},n))})]})}),t&&t.length>0&&e.jsx("ul",{className:"mt-2 list-disc pl-5 text-xs text-gray-600 space-y-1",children:t.map((i,n)=>e.jsx("li",{children:i},n))})]})}function w({title:a="Regole",bullets:r=[],notes:s=[]}){return(!r||r.length===0)&&(!s||s.length===0)?null:e.jsxs("div",{className:"mb-6 rounded-lg border border-amber-200 bg-amber-50 p-4",children:[e.jsx("h3",{className:"font-semibold text-amber-900 mb-2",children:a}),s&&s.length>0&&e.jsx("ul",{className:"mb-2 list-disc pl-5 text-sm text-amber-900/90 space-y-1",children:s.map((t,i)=>e.jsx("li",{children:t},i))}),r&&r.length>0&&e.jsx("ul",{className:"list-disc pl-5 text-sm text-amber-900/90 space-y-1",children:r.map((t,i)=>e.jsx("li",{children:t},i))})]})}function $({planKey:a,data:r,rightLogo:s}){const[t,i]=o.useState(!1),n=async()=>{try{i(!0);const l=await _("/api/supermaster/incentivi/pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan:a,data:r,logos:{right:s}})}),c=window.URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=`piano_${a}.pdf`,document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(c)}catch(l){console.error("Export PDF error",l),alert("Errore durante l'export del PDF")}finally{i(!1)}};return e.jsx("div",{className:"flex items-center justify-end mb-4",children:e.jsx("button",{onClick:n,disabled:t,className:"inline-flex items-center gap-2 rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-60",children:t?"Generazione…":"Esporta PDF"})})}function I({section:a}){if(!a)return null;const{title:r,notes:s,table:t,bullets:i,footnotes:n,subsections:l}=a;return e.jsxs("div",{className:"mb-8",children:[r&&e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-3",children:r}),s&&s.length>0&&e.jsx(w,{title:"Note",notes:s}),t&&e.jsx(N,{title:t.title,columns:t.columns,rows:t.rows,footnotes:n}),i&&i.length>0&&e.jsx(w,{title:"Regole",bullets:i}),Array.isArray(l)&&l.map((c,d)=>e.jsx("div",{className:"mt-6",children:e.jsx(N,{title:c.title,columns:c.table?.columns||[],rows:c.table?.rows||[]})},d))]})}function x({data:a,rightLogo:r}){const s=a?.sections||[];return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx(T,{title:a?.brand?.title||"Piano Incentivi",subtitle:a?.brand?.subtitle,logoSrc:a?.brand?.logo,rightLogoSrc:r}),e.jsx($,{planKey:(a?.brand?.title||"piano").toLowerCase().replace(/[^a-z]+/g,"-"),data:a,rightLogo:r}),e.jsx("div",{className:"space-y-6",children:s.map(t=>e.jsx(I,{section:t},t.id))})]})}function J(){const[a,r]=o.useState("tlc"),[s,t]=o.useState(()=>{const m=new Date;return`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`}),[i,n]=o.useState(f),[l,c]=o.useState(j),[d,k]=o.useState(y),[b,S]=o.useState(v),[U,u]=o.useState(!1),R=o.useMemo(()=>[{id:"tlc",label:"TLC (Fisso + Mobile)"},{id:"sky",label:"SKY"},{id:"energia",label:"Energia"},{id:"rate",label:"Rateizzazioni"}],[]),C=o.useMemo(()=>{switch(a){case"sky":return e.jsx(x,{data:l,rightLogo:l?.brand?.logoBusiness||"/sky_business_logo.svg"});case"energia":return e.jsx(x,{data:d,rightLogo:"/fastweb_vodafone-logo.svg"});case"rate":return e.jsx(x,{data:b,rightLogo:"/fastweb_vodafone-logo.svg"});case"tlc":default:return e.jsx(x,{data:i,rightLogo:"/fastweb_vodafone-logo.svg"})}},[a,i,l,d,b]);return o.useEffect(()=>{const m={tlc:{key:"fastweb_tlc",setter:n,fallback:f},sky:{key:"sky",setter:c,fallback:j},energia:{key:"energia",setter:k,fallback:y},rate:{key:"rate",setter:S,fallback:v}};(async()=>{try{u(!0);for(const p of Object.keys(m)){const{key:D,setter:h,fallback:E}=m[p];try{const g=await z(`/supermaster/piani-incentivi/config?plan=${encodeURIComponent(D)}&period=${encodeURIComponent(s)}`,{method:"GET"});g?.data_json?h(g.data_json):h(E)}catch{h(m[p].fallback)}}}catch{P.error("Errore caricamento piani, uso versioni statiche")}finally{u(!1)}})()},[s]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100",children:[e.jsx(L,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(M,{tabs:R,current:a,onChange:r}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Periodo"}),e.jsx("input",{value:s,onChange:m=>t(m.target.value),className:"px-3 py-2 border rounded-md text-sm",placeholder:"YYYY-MM"}),e.jsx("a",{href:`/supermaster/piani-incentivazione?plan=${a==="tlc"?"fastweb_tlc":a}&period=${encodeURIComponent(s)}`,className:"ml-3 inline-flex items-center px-3 py-2 rounded-md text-sm font-medium bg-indigo-600 text-white hover:bg-indigo-700",children:"✏️ Modifica JSON"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsx("a",{href:"/supermaster/piani-incentivi-modulare",className:"hover:text-gray-700",children:"Piani Incentivazione"}),e.jsx("span",{className:"mx-1",children:"›"}),e.jsx("a",{href:`/supermaster/piani-incentivazione?plan=${a==="tlc"?"fastweb_tlc":a}&period=${encodeURIComponent(s)}`,className:"text-indigo-600 hover:text-indigo-700",children:"Editor JSON"})]})]}),C]})}export{J as default};
