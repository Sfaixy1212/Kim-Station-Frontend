import{r as l,u as vt,b as St,a5 as wt,j as e}from"./vendor.js";import{u as at,g as P,k as Fe,a as Be}from"./index.js";function Pe(x){const r=(x||"").toString().toUpperCase().replace(/\s+/g,"_");return r.includes("ATTIVATO")||r.includes("SUBENTRO_EFFETTUATO")||r.includes("SIM_SOSTITUITA")||r.includes("RESET_ESEGUITO")||r.includes("CLIENTE_ACQUISIBILE")||r.includes("PRENOTATO")||r.includes("CONFERMATO")||r.includes("CLIENTE_SBLOCCATO")||r.includes("TICKET_GESTITO_CON_NOTA")||r.includes("SUCCESS")?"bg-green-100 text-green-800":r.includes("CLIENTE_NON_ACQUISIBILE")||r.includes("ANNULLATO")||r.includes("ERRORE")||r.includes("KO")||r.includes("FAILED")?"bg-red-100 text-red-800":r.includes("ATTESA_INTEGRAZIONE")||r.includes("ATTESA_MODULO")||r.includes("PDA_DA_FIRMARE")||r.includes("TICKET_APERTO")||r.includes("MODULO_INVIATO")||r.includes("PDA_FIRMATA")||r.includes("IN_LAVORAZIONE")||r.includes("TICKET_IN_LAVORAZIONE")||r.includes("PENDING")||r.includes("PROCESS")?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}function At(x){if(!x)return"-";if(typeof x=="string"){const p=x.trim().match(/^(\d{4})-(\d{2})-(\d{2})\s+(\d{2}):(\d{2}):(\d{2})(?:\.\d+)?$/);if(p){const N=p[1],h=p[2],w=p[3],g=p[4],Q=p[5];return w==="00"||h==="00"?"-":`${w}/${h}/${N} ${g}:${Q}`}}try{const r=new Date(x);if(!isNaN(r.getTime())){const p=String(r.getDate()).padStart(2,"0"),N=String(r.getMonth()+1).padStart(2,"0"),h=r.getFullYear(),w=String(r.getHours()).padStart(2,"0"),g=String(r.getMinutes()).padStart(2,"0");return`${p}/${N}/${h} ${w}:${g}`}}catch{}return ve(x)}function ve(x){if(!x)return"-";if(typeof x=="string"){const p=x.trim().match(/^(\d{4})-(\d{2})-(\d{2})\s+(\d{2}):(\d{2}):(\d{2})(?:\.\d+)?$/);if(p){const N=p[1],h=p[2],w=p[3];return w==="00"||h==="00"?"-":`${w}/${h}/${N}`}}try{const r=new Date(x);if(!isNaN(r.getTime())){const p=String(r.getDate()).padStart(2,"0"),N=String(r.getMonth()+1).padStart(2,"0"),h=r.getFullYear();return p==="00"||N==="00"?"-":`${p}/${N}/${h}`}}catch{}if(typeof x=="string"){const r=x.trim();if(/gg|mm|aaaa/i.test(r)||/[a-zA-Z]/.test(r))return"-";const p=r.match(/^(\d{1,2})[./-](\d{1,2})[./-](\d{4})$/);if(p){const N=parseInt(p[1],10),h=parseInt(p[2],10),w=p[3];return!N||!h?"-":N<=12&&h>12?`${String(h).padStart(2,"0")}/${String(N).padStart(2,"0")}/${w}`:`${String(N).padStart(2,"0")}/${String(h).padStart(2,"0")}/${w}`}if(/^\d{8}$/.test(r)){const N=r.slice(0,4),h=r.slice(4,6),w=r.slice(6,8);return w==="00"||h==="00"?"-":`${w}/${h}/${N}`}if(/00/.test(r))return"-"}return String(x)}function tt(x){try{const r=x?.url||x?.URL||x?.FullPath||x?.fullPath||x?.Link||x?.Href||"";if(r&&/^(https?:\/\/|\/.+)/i.test(String(r)))return r;const p=x?.Payload||x?.payload||{};if(p?.s3Url)return String(p.s3Url);if(p?.s3Key)return`https://attivazionistation.s3.eu-west-1.amazonaws.com/${p.s3Key}`;const N=(x?.TipoFile||x?.tipo||"").toString().trim().toUpperCase(),h=x?.NomeFile||x?.nomeFile||x?.FileName||x?.filename||"";if(N==="PDA"&&h)return`https://attivazionistation.s3.eu-west-1.amazonaws.com/PDA/${h}`}catch{}return""}function Tt(){const[x,r]=l.useState([]),[p,N]=l.useState([]),[h,w]=l.useState(!1),[g,Q]=l.useState(!0),[de,xe]=l.useState(null);vt();const[Se]=St(),me=wt?.()||{},{user:G}=at(),pe=(G?.role||"").toString().toLowerCase(),I=pe==="agente"||pe==="agent",U=I?"/agente":"/dealer",[$,M]=l.useState(!1),[we,ue]=l.useState(!1),[S,ge]=l.useState(null),[n,ae]=l.useState(null),[Y,q]=l.useState(!1),[B,H]=l.useState(null),[K,J]=l.useState(!1),[X,W]=l.useState(""),[ee,se]=l.useState(""),[te,i]=l.useState(""),[f,k]=l.useState(null),[D,L]=l.useState("allegato"),[E,u]=l.useState(!1),[re,Z]=l.useState(""),[ie,ne]=l.useState(null),[y,le]=l.useState(!1),[oe,_]=l.useState(""),[z,ce]=l.useState(null),[Ae,Ie]=l.useState(!1),[Oe,ye]=l.useState(""),[$e,Me]=l.useState({}),[st,Te]=l.useState({}),[Ze,Qe]=l.useState(!1),[Ye,Ee]=l.useState(""),[rt,qe]=l.useState(!1),[He,Je]=l.useState(!1),[Le,Xe]=l.useState([]),[De,ze]=l.useState(!1),[Ce,Ue]=l.useState(""),[he,it]=l.useState(""),[et,nt]=l.useState(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`}),lt=l.useMemo(()=>{try{const t=c=>(c||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toUpperCase().replace(/\s+/g,"_");return(t(n?.TemplateCodice)||t(n?.Template?.template||n?.Template))==="SOSTITUZIONE_GUASTO_O_CAMBIO_FORMATO"}catch{return!1}},[n]),ot=l.useMemo(()=>{try{const t=c=>(c||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toUpperCase().replace(/\s+/g,"_");return(t(n?.TemplateCodice)||t(n?.Template?.template||n?.Template))==="FURTO_SMARRIMENTO"}catch{return!1}},[n]),fe=l.useMemo(()=>{try{const t=Array.isArray(n?.Documenti)?n.Documenti:[],a=d=>{const O=(d?.tipo||d?.TipoFile||"").toString().toUpperCase(),A=(d?.nomeOriginale||d?.NomeFile||d?.filename||"").toString().toUpperCase();return/MODULO/.test(O)||/MODULO/.test(A)},c=d=>{const O=(d?.tipo||d?.TipoFile||"").toString().toUpperCase(),A=(d?.nomeOriginale||d?.NomeFile||d?.filename||"").toString().toUpperCase();return/PDA/.test(O)||/PDA/.test(A)};return t.find(a)||t.find(c)||t[0]||null}catch{return null}},[n?.Documenti]),_e=async()=>{qe(!0),setTimeout(()=>Je(!0),0),Ue(""),ze(!0);try{const t=(G?.agentenome||G?.name||"").toString(),a=new URLSearchParams({...t?{agentenome:t}:{}}).toString(),c=new URLSearchParams({}).toString();let d=[];if(I)try{const[s,o]=et.split("-"),b=new URLSearchParams({...t?{agentenome:t}:{},anno:s,mese:o}).toString(),m=await P(`${U}/attivazioni-dettaglio?${b}`);d=Array.isArray(m?.data)?m.data:Array.isArray(m)?m:[]}catch(s){console.error("Errore caricamento dettagli attivazioni agente:",s),d=[]}else try{const s=await P(`${U}/ultime-attivazioni?${c}`);d=Array.isArray(s?.data)?s.data:Array.isArray(s)?s:[]}catch{}const O=(s,o)=>{if(!s)return;const b=Object.keys(s);for(const m of o){const v=b.find(j=>m.test(j));if(v&&s[v]!=null)return s[v]}},A=(d||[]).map(s=>I?{data:ve(s.BatchDate||s.DataOra||s.DataInserimento||s.Data),point:s.Point||"-",tipo:s.TIPO||"-",convergenza:s.IsConvergenzaMobile===1?"SI":"",tipoRicarica:s.TipoRicaNorm||"-",offertaFisso:s.ValoreFisso||"-",offertaMobile:s.Offerta||"-"}:{id:s.ID||s.IDOrdine||"-",data:ve(s.Data||s.DataOra||s.DataInserimento),titolo:s.Titolo||s.ValoreFisso||"-",tipo:s.Tipo||s.TIPO||"-",segmento:s.Segmento||s.TipoRicaNorm||"-",stato:s.Stato||"-"});Xe(A)}catch(t){Ue(t?.message||"Errore nel caricamento")}finally{ze(!1)}},Ne=()=>{Je(!1),setTimeout(()=>qe(!1),200),Xe([]),Ue(""),ze(!1)},ct=l.useMemo(()=>{try{const t=Number(n?.Stato);if(!isNaN(t)&&(t===28||t===9))return!0;const a=(n?.StatoEsteso||"").toString().toUpperCase();return/PDA/.test(a)&&/FIRMA/.test(a)||/ATTESTA FIRMA|IN ATTESA FIRMA/.test(a)}catch{return!1}},[n?.Stato,n?.StatoEsteso]);l.useMemo(()=>{try{const t=c=>(c||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toUpperCase().replace(/\s+/g,"_"),a=t(n?.TemplateCodice)||t(n?.Template?.template||n?.Template);return a==="CERTIFICAZIONE_INDIRIZZO"||a==="INFO_PRATICA"}catch{return!1}},[n]);const ke=l.useMemo(()=>{const t=he.trim().toLowerCase();return t?Le.filter(a=>{const c=d=>(d||"").toString().toLowerCase().includes(t);return I?[a.data,a.point,a.tipo,a.offertaFisso,a.offertaMobile,a.tipoRicarica].some(c):[a.id,a.titolo,a.tipo,a.segmento,a.stato].some(c)}):Le},[Le,he,I]),be=async()=>{try{xe(null),Q(!0);let t=[];if(I){const s=`${U}/ultime-attivazioni-agente`,o=`${U}/ultime-attivazioni`,b=(G?.agentenome||G?.name||"").toString(),m=b?`?${new URLSearchParams({agentenome:b}).toString()}`:"";try{const v=await P(`${s}${m}`),j=Array.isArray(v?.data)?v.data:Array.isArray(v)?v:[];try{console.debug("[UltimeAttivazioni][AGG] items:",j.length,"keys:",j[0]?Object.keys(j[0]):[])}catch{}if(j&&j.length>0)t=j;else{const T=await P(`${o}${m}`),C=Array.isArray(T?.data)?T.data:Array.isArray(T)?T:[];try{console.debug("[UltimeAttivazioni][RAW] items:",C.length,"keys:",C[0]?Object.keys(C[0]):[])}catch{}t=C}}catch{try{const j=await P(`${o}${m}`),T=Array.isArray(j?.data)?j.data:Array.isArray(j)?j:[];try{console.debug("[UltimeAttivazioni][RAW-after-error] items:",T.length,"keys:",T[0]?Object.keys(T[0]):[])}catch{}t=T}catch(j){throw j}}}else{const s=await P(`${U}/ultime-attivazioni`);t=Array.isArray(s?.data)?s.data:Array.isArray(s)?s:[];try{console.debug("[UltimeAttivazioni] items:",t.length,"keys:",t[0]?Object.keys(t[0]):[])}catch{}}const a=(s,o,b=void 0)=>{for(const m of o)if(s[m]!==void 0&&s[m]!==null)return s[m];return b},c=s=>!Array.isArray(s)||s.length===0?[]:s.map(o=>{let b=a(o,["Dealer","dealer","NomeDealer","nomeDealer","nome_dealer","RagioneSociale","ragione_sociale"],void 0);if(!b){const F=Object.keys(o).find(V=>/dealer|ragione.?sociale|nome.?cliente/i.test(V));b=F?o[F]:"-"}const m=F=>{const V=Number(F);return isNaN(V)?0:V},v=m(a(o,["FWFissi","fw_fissi","FW_FISSI","Fissi","fissi","FW Fissi"],void 0)),j=m(a(o,["FWMobili","fw_mobili","FW_MOBILI","Mobili","mobili","FW Mobili"],void 0)),T=m(a(o,["FWEnergy","fw_energy","FW_ENERGY","Energy","energy","FW Energy"],void 0)),C=m(a(o,["ENI","eni","Eni"],void 0)),Re=m(a(o,["Sky","SKY","sky"],void 0));if(![v,j,T,C,Re].some(F=>F!==0)){const F=Object.keys(o),V=bt=>F.filter(je=>bt.test(je)).map(je=>m(o[je])).reduce((je,jt)=>je+jt,0),gt=V(/fiss/i),yt=V(/mob/i),ht=V(/ener/i),ft=m(o.ENI||o.eni||o.Eni||0),Nt=V(/sky/i);return{dealer:b,fissi:gt,mobili:yt,energy:ht,eni:ft,sky:Nt}}return{dealer:b,fissi:v,mobili:j,energy:T,eni:C,sky:Re}});if(I){const s=c(t).filter(m=>m.dealer&&m.dealer!=="-");if(s.some(m=>m.fissi+m.mobili+m.energy+m.eni+m.sky>0)||s.length>0){w(!0),N(s.slice(0,10)),r([]);return}if(t.length>0&&Object.keys(t[0]).some(m=>/dealer|ragione.?sociale/i.test(m))){const m=c(t).filter(v=>v.dealer&&v.dealer!=="-");w(!0),N(m.slice(0,10)),r([]);return}}else if(t.length>0&&Object.keys(t[0]).some(o=>/dealer|nomedealer/i.test(o))&&Object.keys(t[0]).some(o=>/(fw\s*_?fissi|fissi)/i.test(o))){const o=c(t);w(!0),N(o.slice(0,10)),r([]);return}w(!1);const d=(s,o)=>{if(!s)return;const b=Object.keys(s);for(const m of o){const v=b.find(j=>m.test(j));if(v&&s[v]!=null)return s[v]}},A=[...t.map(s=>{const o=s.IDOrdine??s.id??s.ID??null,b=s.Data??s.date??s.createdAt??s.DataOrdine??d(s,[/^data/i,/data.?ordine/i,/created/i]),m=s.Titolo??s.title??s.Valore??s.RagioneSociale??d(s,[/titolo/i,/valore/i,/ragione.?sociale/i,/cliente/i,/offerta/i]),v=s.Tipo??s.type??s.TipoOrdine??d(s,[/tipo/i,/categoria/i]),j=s.Segmento??s.segment??d(s,[/segment/i]),T=s.Stato??s.status??s.StatoEsteso??s.StatoNome??d(s,[/stato/i,/status/i]);return{id:o,date:ve(b),title:m||"-",type:v||"-",segment:j||"-",status:T||"-",raw:s}})].sort((s,o)=>{const b=s.id?0:1,m=o.id?0:1;if(b!==m)return b-m;const v=s.raw?.DataOrdinamento?new Date(s.raw.DataOrdinamento):null,j=o.raw?.DataOrdinamento?new Date(o.raw.DataOrdinamento):null;return v&&j?j-v:0});r(A.slice(0,10))}catch(t){console.error("Errore fetch ultime attivazioni:",t),xe(t.message||"Errore di caricamento")}finally{Q(!1)}};l.useEffect(()=>{be()},[]),l.useEffect(()=>{const t=Se,a=t.get("attivazione")||t.get("id")||t.get("open");if(a){const c=parseInt(a,10)||a;c&&R(c)}},[Se]),l.useEffect(()=>{const t=me?.id;if(t){const a=parseInt(t,10)||t;a&&R(a)}},[me?.id]);const R=async t=>{if(t){ge(t),M(!0),setTimeout(()=>ue(!0),0),ae(null),H(null),q(!0);try{const a=await P(`${U}/attivazione/${t}`);console.log("[Dettaglio attivazione] payload ricevuto:",a),ae(a),W(""),se(""),i(""),Me({}),Te({}),Ee("")}catch(a){console.error("Errore caricamento dettaglio attivazione:",a),H(a?.message||"Errore di caricamento dettaglio")}finally{q(!1)}}},Ve=()=>{ue(!1),setTimeout(()=>M(!1),200),ge(null),ae(null),H(null),q(!1),W(""),J(!1)};l.useEffect(()=>{if(n)try{const t=n?.Payload??n?.payload??{},a=n?.PayloadIntestario??n?.payloadIntestario??{};let c={},d={};try{c=typeof t=="string"?JSON.parse(t):t||{}}catch{c=t||{}}try{d=typeof a=="string"?JSON.parse(a):a||{}}catch{d=a||{}}const O=c&&typeof c.Payload=="object"?c.Payload:{},A={...c,...d,...O};Me(A),Te({})}catch{}},[n]);const dt=async()=>{if(!S)return;if(ye(""),!z){ye("Seleziona il file MODULO (PDF/JPEG/PNG).");return}if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(z.type)){ye("Formato non consentito. Ammessi: PDF, JPEG, PNG");return}const a=10*1024*1024;if(z.size>a){ye("Il file supera i 10MB consentiti.");return}Ie(!0);try{const c=new FormData;c.append("file",z),await Be(`/dealer/attivazione/${S}/upload-modulo`,c),ce(null),await R(S)}catch(c){ye(c?.message||"Errore durante l'upload del MODULO")}finally{Ie(!1)}},xt=async()=>{if(S){if(i(""),!ee.trim()){i("La nota Ã¨ obbligatoria.");return}J(!0);try{await Fe(`/dealer/ordine/${S}/modifica-integrazione`,{payloadAggiornato:{},resetState:!0,nota:ee.trim()}),await R(S),await be()}catch(t){W(t?.message||"Errore durante l'invio della nota")}finally{J(!1)}}},mt=async()=>{if(!S)return;if(Z(""),!f){Z("Seleziona un file da allegare.");return}if(!["application/pdf","image/jpeg","image/png"].includes(f.type)){Z("Formato non consentito. Ammessi: PDF, JPEG, PNG");return}const a=10*1024*1024;if(f.size>a){Z("Il file supera i 10MB consentiti.");return}u(!0);try{const c=new FormData;c.append("file",f),c.append("tipo",D||"allegato"),c.append("TipoFile",D||"allegato"),await Be(`/dealer/ordine/${S}/file`,c);try{await Fe(`/dealer/ordine/${S}/modifica-integrazione`,{payloadAggiornato:{},resetState:!0})}catch{}k(null),await R(S)}catch(c){Z(c?.message||"Errore durante l'upload del file")}finally{u(!1)}},pt=async()=>{if(!S)return;if(_(""),!ie){_("Seleziona il file PDA (PDF).");return}if(ie.type!=="application/pdf"){_("Sono consentiti solo file PDF.");return}const t=10*1024*1024;if(ie.size>t){_("Il file supera i 10MB consentiti.");return}le(!0);try{const a=new FormData;a.append("file",ie),await Be(`/dealer/attivazione/${S}/upload-pda`,a),ne(null),await R(S),await be()}catch(a){_(a?.message||"Errore durante l'upload della PDA")}finally{le(!1)}},ut=async()=>{if(S){W(""),J(!0);try{await Fe(`/dealer/ordine/${S}/modifica-integrazione`,{payloadAggiornato:{},resetState:!0}),await R(S),await be()}catch(t){W(t?.message||"Errore durante il reinvio dell'ordine")}finally{J(!1)}}};return e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:"Ultime Attivazioni"}),e.jsx("button",{type:"button",onClick:_e,className:"text-sm text-primary-600 hover:text-primary-700 font-medium","aria-label":"Vedi dettagli attivazioni",children:"Espandi"})]}),g&&e.jsx("div",{className:"py-2 space-y-2",children:[...Array(3)].map((t,a)=>e.jsx("div",{className:"h-5 bg-gray-100 rounded animate-pulse"},a))}),rt&&e.jsxs("div",{className:"fixed inset-0 z-[49] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 transition-opacity duration-200",style:{opacity:He?1:0},onClick:Ne}),e.jsxs("div",{className:`relative bg-white rounded-2xl shadow-2xl w-full mx-4 flex flex-col transition-all duration-200 ease-out transform ${He?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 translate-y-1"}`,style:{maxWidth:"min(1200px, calc(100vw - 32px))",maxHeight:"90vh"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:I?"Dettaglio Attivazioni":"Attivazioni"}),e.jsx("button",{onClick:Ne,className:"text-gray-500 hover:text-gray-700","aria-label":"Chiudi",children:"âœ•"})]}),e.jsxs("div",{className:"p-4 flex-1 overflow-auto",children:[!De&&!Ce&&e.jsxs("div",{className:"mb-3 space-y-3",children:[I&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filtro per mese:"}),e.jsx("input",{type:"month",value:et,onChange:t=>{nt(t.target.value),setTimeout(()=>_e(),100)},className:"px-3 py-1.5 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("input",{type:"text",value:he,onChange:t=>it(t.target.value),placeholder:"Cerca per point, tipo, offerta...",className:"w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),De&&e.jsx("div",{className:"space-y-2",children:[...Array(4)].map((t,a)=>e.jsx("div",{className:"h-5 bg-gray-100 rounded animate-pulse"},a))}),Ce&&!De&&e.jsxs("div",{className:"text-sm text-red-600 flex items-center justify-between",children:[e.jsx("span",{children:Ce}),e.jsx("button",{onClick:_e,className:"ml-3 px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs",children:"Riprova"})]}),!De&&!Ce&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-[900px] w-full table-auto",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-100",children:I?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Point"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Convergenza"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo Ricarica"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Offerta Fisso"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Offerta Mobile"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Titolo"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Segmento"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stato"})]})})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:(()=>{const t=I?7:6;return ke.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:t,className:"py-6 text-center text-sm text-gray-500",children:he?"Nessun risultato trovato":"Nessuna attivazione trovata"})}):ke.map((a,c)=>e.jsx("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{!I&&a.id&&(R(a.id),Ne())},children:I?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-2 px-2 text-sm text-gray-600",children:a.data}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900",children:a.point}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 text-center",children:a.tipo}),e.jsx("td",{className:"py-2 px-2 text-sm text-center",children:a.convergenza&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:a.convergenza})}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 text-center",children:a.tipoRicarica}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900",children:a.offertaFisso}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900",children:a.offertaMobile})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-2 px-2 text-sm text-gray-600",children:a.id}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-600",children:a.data}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900",children:a.titolo}),e.jsx("td",{className:"py-2 px-2 text-sm text-center",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:a.tipo})}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 text-center",children:a.segmento}),e.jsx("td",{className:"py-2 px-2 text-sm text-center",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${Pe(a.stato)}`,children:a.stato})})]})},c))})()})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:ke.length===0?e.jsx("div",{className:"py-6 text-center text-sm text-gray-500",children:he?"Nessun risultato trovato":"Nessuna attivazione trovata"}):ke.map((t,a)=>e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-gray-50 p-3 text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:t.data||t.id}),!I&&t.id&&e.jsx("button",{type:"button",onClick:()=>{R(t.id),Ne()},className:"text-[11px] font-semibold text-primary-600",children:"Apri"})]}),I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.point}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-700",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 uppercase text-[11px]",children:t.tipo}),t.tipoRicarica&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-gray-200 text-gray-800 text-[11px]",children:t.tipoRicarica}),t.convergenza&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-[11px]",children:t.convergenza})]}),t.offertaFisso&&e.jsxs("div",{className:"text-gray-700",children:["Fisso: ",e.jsx("span",{className:"font-medium",children:t.offertaFisso})]}),t.offertaMobile&&e.jsxs("div",{className:"text-gray-700",children:["Mobile: ",e.jsx("span",{className:"font-medium",children:t.offertaMobile})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.titolo}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 uppercase text-[11px]",children:t.tipo}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-gray-200 text-gray-800 text-[11px]",children:t.segmento}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-medium ${Pe(t.stato)}`,children:t.stato})]})]})]},a))})]})]}),e.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:e.jsx("button",{onClick:Ne,className:"px-3 py-1.5 text-sm rounded bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Chiudi"})})]})]}),de&&!g&&e.jsxs("div",{className:"py-4 text-sm flex items-center justify-between",children:[e.jsx("span",{className:"text-red-600",children:de}),e.jsx("button",{type:"button",onClick:be,className:"ml-4 px-3 py-1.5 text-xs rounded bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Riprova"})]}),!g&&!de&&e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:h?e.jsxs("table",{className:"min-w-[640px] sm:min-w-full table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dealer"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FW Fissi"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FW Mobili"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"FW Energy"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ENI"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sky"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-6 text-center text-sm text-gray-500",children:"Nessun dato disponibile"})}):p.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900",children:t.dealer}),e.jsx("td",{className:"py-2 px-2 text-sm text-center text-gray-900",children:t.fissi}),e.jsx("td",{className:"py-2 px-2 text-sm text-center text-gray-900",children:t.mobili}),e.jsx("td",{className:"py-2 px-2 text-sm text-center text-gray-900",children:t.energy}),e.jsx("td",{className:"py-2 px-2 text-sm text-center text-gray-900",children:t.eni||0}),e.jsx("td",{className:"py-2 px-2 text-sm text-center text-gray-900",children:t.sky})]},a))})]}):e.jsxs("table",{className:"min-w-[800px] sm:min-w-full table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap w-20",children:"ID"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap w-24",children:"Data"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Titolo"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap w-20",children:"Tipo"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap w-20",children:"Segmento"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap w-28",children:"Stato"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-6 text-center text-sm text-gray-500",children:"Nessuna attivazione trovata"})}):x.map(t=>e.jsxs("tr",{className:`transition-colors ${t.id?"hover:bg-gray-50 cursor-pointer":"opacity-70 cursor-not-allowed"}`,onClick:()=>t.id&&R(t.id),title:t.id?"Apri dettagli attivazione":"Dettaglio non disponibile (fonte esterna, nessun ID ordine)",children:[e.jsx("td",{className:"py-2 px-2 text-sm text-gray-600 whitespace-nowrap font-mono text-xs",children:t.id||"-"}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 whitespace-nowrap",children:t.date}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 max-w-[200px] truncate",children:t.title}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-600 whitespace-nowrap",children:e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap",children:t.type})}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-600 whitespace-nowrap",children:e.jsx("span",{className:"bg-gray-100 text-gray-800 px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap",children:t.segment})}),e.jsx("td",{className:"py-2 px-2 text-sm whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap ${Pe(t.status)}`,children:t.status})})]},(t.id??t.title)+""))})]})}),$&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:`absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-200 ${we?"opacity-100":"opacity-0"}`,onClick:Ve}),e.jsxs("div",{className:`relative bg-white rounded-lg shadow-xl w-full max-w-3xl mx-4 transition-all duration-200 ease-out transform ${we?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 translate-y-1"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsxs("h4",{className:"text-base font-semibold text-gray-900",children:["Dettaglio Attivazione",S?` #${S}`:""]}),e.jsx("button",{onClick:Ve,className:"text-gray-500 hover:text-gray-700","aria-label":"Chiudi",children:"âœ•"})]}),e.jsxs("div",{className:"p-4 max-h-[70vh] overflow-auto",children:[B&&!Y&&e.jsx("div",{className:"text-sm text-red-600",children:B}),!Y&&!B&&n&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[{label:"Data ordine",value:At(n.DataOrdine)},{label:"Stato",value:n.StatoEsteso,isStatus:!0},{label:"Offerta",value:n.TitoloOfferta},{label:"Dealer",value:n.NomeDealer}].filter(t=>t.value&&t.value!=="-").map((t,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:t.label}),t.isStatus?e.jsx("div",{className:`inline-block mt-0.5 px-2 py-0.5 rounded-full text-xs ${Pe(t.value)}`,children:t.value}):e.jsx("div",{className:"text-sm text-gray-900",children:t.value})]},a))}),(n.Intestatario||n.PayloadIntestario||n.Payload)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Intestatario"}),(()=>{const t=n.Intestatario||{},a={...n.Payload||{},...n.PayloadIntestario||{}},c=t.RagioneSociale||[t.Nome,t.Cognome].filter(Boolean).join(" ").trim()||(a.NOME_E_COGNOME_INTESTATARIO_CONTRATTO||"").trim()||[a.NOME,a.COGNOME].filter(Boolean).join(" ").trim(),d=t.CodiceFiscale||a.CODICE_FISCALE_INTESTATARIO||a.CODICE_FISCALE_NUOVO_INTESTATARIO||a.CodiceFiscale||a.CODICE_FISCALE||a.CF,O=[{label:"Nome e Cognome / Ragione sociale",value:c},{label:"Codice Fiscale",value:d},{label:"Data di nascita",value:t.DataNascita||a.DATA_DI_NASCITA},{label:"Luogo di nascita",value:t.LuogoNascita||a.LUOGO_DI_NASCITA},{label:"Indirizzo e civico attivazione",value:t.Indirizzo||a.INDIRIZZO_E_CIVICO_ATTIVAZIONE},{label:"CAP",value:t.CAP||a.CAP},{label:"CittÃ ",value:t.Citta||a.CITTA},{label:"Provincia",value:t.Provincia||a.PROVINCIA},{label:"P.IVA",value:t.PIVA||a.PARTITA_IVA},{label:"Email",value:t.Email||a.EMAIL},{label:"Recapito di riferimento",value:t.Telefono||a.TELEFONO||a.NUMERO_TELEFONO||a.RECAPITO_DI_RIFERIMENTO}].filter(A=>{const s=A.value;return s&&s!==""&&s!=="-"&&s!==null&&s!==void 0&&String(s).trim()!==""});return O.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:O.map((A,s)=>e.jsxs("div",{className:A.label==="Indirizzo e civico attivazione"?"sm:col-span-2":"",children:[e.jsx("div",{className:"text-xs text-gray-500",children:A.label}),e.jsx("div",{className:"text-gray-800 break-words",children:A.value})]},s))}):e.jsx("div",{className:"text-sm text-gray-500",children:"Nessun dato intestatario disponibile"})})()]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-700 mb-2",children:["Dati Attivazione ",n.Template?.template?`(${n.Template.template})`:""]}),n.Template?.campi?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:n.Template.campi.map((t,a)=>{const c=String(n?.Stato??n?.stato??"")==="3",d=t.key,O=$e?.[d]??(n.Intestatario||{})[d]??"",A=o=>Me(b=>({...b,[d]:o})),s=st?.[d];if(!c){let o=O;return t.tipo==="date"&&o&&(o=ve(o)),!o||o==="-"?null:e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:t.label}),e.jsx("div",{className:"text-gray-800 break-words",children:String(o)})]},a)}return e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:t.label}),t.tipo==="date"?e.jsx("input",{type:"date",value:(()=>{try{if(!O)return"";const o=String(O).trim().match(/^(\d{1,2})[./-](\d{1,2})[./-](\d{4})$/);if(o){let T=parseInt(o[1],10),C=parseInt(o[2],10);const Re=o[3];if(!T||!C)return"";let Ge=T,F=C;return T<=12&&C>12&&(Ge=C,F=T),`${Re}-${String(F).padStart(2,"0")}-${String(Ge).padStart(2,"0")}`}const b=new Date(O);if(isNaN(b.getTime()))return"";const m=b.getFullYear(),v=String(b.getMonth()+1).padStart(2,"0"),j=String(b.getDate()).padStart(2,"0");return`${m}-${v}-${j}`}catch{return String(O||"")}})(),onChange:o=>A(o.target.value),className:"w-full rounded border border-gray-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsx("input",{type:"text",value:O??"",onChange:o=>A(o.target.value),className:`w-full border border-gray-200 rounded p-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 ${s?"border-red-400":""}`}),s&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:s})]},a)})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[{label:"Nome e Cognome",value:intestatario.nome&&intestatario.cognome?`${intestatario.nome} ${intestatario.cognome}`:intestatario.nomeCompleto},{label:"Ragione sociale",value:intestatario.ragioneSociale},{label:"Codice Fiscale",value:intestatario.codiceFiscale},{label:"Data di nascita",value:intestatario.dataNascita},{label:"Luogo di nascita",value:intestatario.luogoNascita},{label:"Indirizzo e civico attivazione",value:intestatario.indirizzoAttivazione},{label:"CAP",value:intestatario.cap},{label:"CittÃ ",value:intestatario.citta},{label:"Provincia",value:intestatario.provincia},{label:"P.IVA",value:intestatario.partitaIva},{label:"Email",value:intestatario.email},{label:"Recapito di riferimento",value:intestatario.telefono}].filter(t=>t.value&&t.value!==""&&t.value!=="-").map((t,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:t.label}),e.jsx("div",{className:"text-gray-800 break-words",children:t.value})]},a))}),ct&&e.jsxs("div",{className:"mt-3 p-4 bg-red-50 border-2 border-red-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-bold text-red-900 mb-1",children:"ATTENZIONE: PDA da firmare"}),e.jsxs("div",{className:"text-xs text-red-800 leading-relaxed",children:["ðŸ“¥ ",e.jsx("strong",{children:"Scarica la PDA"})," dall'elenco documenti qui sotto",e.jsx("br",{}),"âœï¸ ",e.jsx("strong",{children:"Falla firmare"})," dal cliente",e.jsx("br",{}),"ðŸ“¤ ",e.jsx("strong",{children:"Ricaricala qui"})," firmata (PDF, max 10MB)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"application/pdf",onChange:t=>ne(t.target.files?.[0]||null),className:"text-sm flex-1"}),e.jsx("button",{type:"button",onClick:pt,disabled:y||!ie,className:"px-4 py-2 text-sm font-semibold rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-60 disabled:cursor-not-allowed shadow-md",children:y?"Caricamento...":"Carica PDA"})]}),oe&&e.jsxs("div",{className:"text-xs text-red-700 mt-2 font-medium bg-red-100 p-2 rounded",children:["âŒ ",oe]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-medium text-gray-700 mb-2",children:["Documenti ",n.Documenti?.length?`(${n.Documenti.length})`:""]}),n.Documenti&&n.Documenti.length>0?e.jsx("div",{className:"space-y-2",children:n.Documenti.map((t,a)=>{const c=tt(t),d=(t.tipo||"").toUpperCase().includes("PDA");return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded border-2 transition-all ${d?"bg-green-50 border-green-300 shadow-md":"bg-gray-50 border-transparent"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`text-sm font-semibold ${d?"text-green-900":"text-gray-700"}`,children:t.tipo}),d&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-green-600 text-white animate-pulse",children:"â­ IMPORTANTE"})]}),e.jsx("div",{className:`text-xs ${d?"text-green-700":"text-gray-500"}`,children:t.nomeOriginale})]}),c?e.jsx("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:`text-xs px-3 py-1.5 rounded font-medium transition-colors ${d?"bg-green-600 text-white hover:bg-green-700 shadow-sm":"bg-blue-100 text-blue-800 hover:bg-blue-200"}`,children:"Visualizza"}):e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600",children:"Non disponibile"})]},a)})}):e.jsx("div",{className:"text-sm text-gray-500",children:"Nessun documento allegato"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:"Storico"}),Array.isArray(n.Storico)&&n.Storico.length>0?e.jsx("div",{className:"border border-gray-100 rounded",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-600",children:[e.jsx("th",{className:"text-left px-2 py-1",children:"Data"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Utente"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Da"}),e.jsx("th",{className:"text-left px-2 py-1",children:"A"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Nota"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:n.Storico.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 whitespace-nowrap",children:t.DataOra}),e.jsx("td",{className:"px-2 py-1",children:t.Utente}),e.jsx("td",{className:"px-2 py-1",children:t.StatoPrecedenteNome||t.StatoPrecedente}),e.jsx("td",{className:"px-2 py-1",children:t.StatoNuovoNome||t.StatoNuovo}),e.jsx("td",{className:"px-2 py-1",children:t.Nota})]},a))})]})}):e.jsx("div",{className:"text-sm text-gray-500",children:"Nessuno storico disponibile"})]}),e.jsxs("div",{className:"border border-gray-200 rounded p-3 bg-gray-50",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Note"}),n?.note_dealer||n?.NoteDealer?e.jsx("div",{className:"text-sm whitespace-pre-line bg-white border border-gray-200 rounded p-2 text-gray-800",children:n.note_dealer||n.NoteDealer}):e.jsx("div",{className:"text-sm text-gray-500",children:"Nessuna nota"}),String(n?.Stato??n?.stato??"")==="3"&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",htmlFor:"dealer-note",children:"Nota per il Master"}),e.jsx("textarea",{id:"dealer-note",value:ee,onChange:t=>se(t.target.value),rows:3,className:"w-full text-sm border border-gray-200 rounded p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Inserisci la nota da inviare al Master..."}),te&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:te}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsx("button",{type:"button",onClick:xt,disabled:K,className:"px-3 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:K?"Invio...":"Invia Nota (reset a 0)"})}),X&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:X})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Allega File"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[e.jsx("input",{type:"file",accept:"application/pdf,image/jpeg,image/png",onChange:t=>k(t.target.files&&t.target.files[0]?t.target.files[0]:null),className:"text-sm"}),e.jsx("input",{type:"text",value:D,onChange:t=>L(t.target.value),placeholder:"Tipo file (es. tessera, documento, allegato)",className:"w-full sm:w-60 text-sm border border-gray-200 rounded p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"}),e.jsx("button",{type:"button",onClick:mt,disabled:E,className:"px-3 py-1.5 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-60",children:E?"Caricamento...":"Allega File"})]}),re&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:re})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[e.jsx("button",{type:"button",onClick:async()=>{if(!S)return;Ee(""),Te({});const t={};try{(n?.Template?.campi||[]).forEach(c=>{const d=c.key,O=(c.label||"").toString().toLowerCase(),A=($e?.[d]??"").toString().trim();if(A&&((/codice\s*fiscale|\bcf\b/i.test(O)||/CF|CODICE_FISCALE/i.test(d))&&(/^[A-Z0-9]{16}$/i.test(A)||(t[d]="Codice Fiscale non valido (16 caratteri alfanumerici).")),(/email/i.test(O)||/EMAIL/i.test(d))&&(/^\S+@\S+\.[\w]{2,}$/i.test(A)||(t[d]="Email non valida.")),c.tipo==="date")){const s=new Date(A);isNaN(s.getTime())&&(t[d]="Data non valida.")}})}catch{}if(Object.keys(t).length>0){Te(t),Ee("Correggi i campi evidenziati prima di salvare.");return}Qe(!0);try{await Fe(`/dealer/ordine/${S}/modifica-integrazione`,{payloadAggiornato:$e,resetState:!0}),await R(S)}catch(a){Ee(a?.message||"Errore durante il salvataggio delle modifiche")}finally{Qe(!1)}},disabled:Ze,className:"px-3 py-1.5 text-sm rounded bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60",children:Ze?"Salvataggio...":"Salva modifiche (reset a 0)"}),Ye&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:Ye})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsx("button",{type:"button",onClick:ut,disabled:K,className:"px-3 py-1.5 text-sm rounded bg-gray-800 text-white hover:bg-gray-900 disabled:opacity-60",children:K?"Invio...":"Reinvia (reset a stato 0)"})})]}),(lt||ot)&&String(n?.Stato??n?.stato??"")==="10"&&e.jsxs("div",{className:"mt-3 space-y-3 border-t border-gray-200 pt-3",children:[fe?e.jsxs("div",{className:"rounded border border-blue-200 bg-blue-50 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 mb-1",children:"Documento inviato da KIM"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs text-blue-900/80 truncate",children:fe.nomeOriginale||fe.NomeFile||fe.filename||"Documento"}),(()=>{const t=tt(fe);return t?e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-xs px-2 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:"Scarica Documento"}):e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600",children:"Non disponibile"})})()]})]}):e.jsx("div",{className:"rounded border border-amber-200 bg-amber-50 p-3 text-xs text-amber-900",children:"In attesa del documento inviato da KIM."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Carica MODULO compilato (PDF/JPEG/PNG)"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[e.jsx("input",{type:"file",accept:"application/pdf,image/jpeg,image/png,image/jpg",onChange:t=>ce(t.target.files&&t.target.files[0]?t.target.files[0]:null),className:"text-sm"}),e.jsx("button",{type:"button",onClick:dt,disabled:Ae,className:"px-3 py-1.5 text-sm rounded bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60",children:Ae?"Caricamento...":"Allega MODULO (stato 30)"})]}),Oe&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:Oe})]})]})]})]})]}),e.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:e.jsx("button",{onClick:Ve,className:"px-3 py-1.5 text-sm rounded bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Chiudi"})})]})]})]})}function Ke(x){const r=(x||"").toString().toUpperCase().replace(/\s+/g,"_");return r.includes("ATTIVATO")||r.includes("SUBENTRO_EFFETTUATO")||r.includes("SIM_SOSTITUITA")||r.includes("RESET_ESEGUITO")||r.includes("CLIENTE_ACQUISIBILE")||r.includes("PRENOTATO")||r.includes("CONFERMATO")||r.includes("CLIENTE_SBLOCCATO")||r.includes("TICKET_GESTITO_CON_NOTA")||r.includes("PAGATO")||r.includes("CONSEGNATO")||r.includes("SUCCESS")?"bg-green-100 text-green-800":r.includes("CLIENTE_NON_ACQUISIBILE")||r.includes("ANNULLATO")||r.includes("ERRORE")||r.includes("KO")||r.includes("FAILED")||r.includes("RIFIUTATO")?"bg-red-100 text-red-800":r.includes("ATTESA_INTEGRAZIONE")||r.includes("ATTESA_MODULO")||r.includes("PDA_DA_FIRMARE")||r.includes("TICKET_APERTO")||r.includes("MODULO_INVIATO")||r.includes("PDA_FIRMATA")||r.includes("IN_LAVORAZIONE")||r.includes("TICKET_IN_LAVORAZIONE")||r.includes("ATTESA")||r.includes("PREPARAZIONE")||r.includes("PENDING")||r.includes("PROCESS")?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}function We(x){if(!x)return"-";try{const r=new Date(x);if(!isNaN(r.getTime())){const p=String(r.getDate()).padStart(2,"0"),N=String(r.getMonth()+1).padStart(2,"0"),h=r.getFullYear();return`${p}/${N}/${h}`}}catch{}if(typeof x=="string"){const p=x.trim().match(/^(\d{1,2})[./-](\d{1,2})[./-](\d{4})$/);if(p){const N=parseInt(p[1],10),h=parseInt(p[2],10),w=p[3];return N<=12&&h>12?`${String(h).padStart(2,"0")}/${String(N).padStart(2,"0")}/${w}`:`${String(N).padStart(2,"0")}/${String(h).padStart(2,"0")}/${w}`}}return String(x)}function Et(){const[x,r]=l.useState([]),[p,N]=l.useState(!0),[h,w]=l.useState(null),[g,Q]=l.useState(null),[de,xe]=l.useState(!1),[Se,me]=l.useState(!1),[G,pe]=l.useState(!1),{user:I}=at(),U=(I?.role||"").toString().toLowerCase(),$=U==="agente"||U==="agent",M=$?"/agente":"/dealer",[we,ue]=l.useState(!1),[S,ge]=l.useState(!1),[n,ae]=l.useState([]),[Y,q]=l.useState(!1),[B,H]=l.useState(""),[K,J]=l.useState(()=>{const i=new Date;return`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`}),X=l.useCallback(async()=>{try{N(!0);const i=$?`${M}/ultimi-ordini-agente`:`${M}/ultimi-ordini`,f=await P(i),k=f?.data?.data??f?.data?.items??f?.data??f?.items??f,D=Array.isArray(k)?k:[];try{console.debug("[UltimiOrdini] path:",i,"items:",D.length,"keys:",D[0]?Object.keys(D[0]):[])}catch{}const L=u=>typeof u=="number"?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(u):u??"-",E=D.map((u,re)=>$?{id:u.IDOrdine??u.IDOrdineProdotto??u.id??null,date:u.Data??"-",product:u.Dealer??u.Inserimento??"-",type:u.TipoProdotto??"-",amount:L(u.Importo),status:u.Stato??"-"}:{id:u.IDOrdine??u.IDOrdineProdotto??u.id??re,date:We(u.Data??u.DataOra??u.date??"-"),product:u.Prodotto??u.Titolo??u.product??"-",type:u.Tipo??u.type??"-",amount:L(u.Importo??u.ImportoTotale??u.amount),status:u.Stato??u.StatoEsteso??u.status??"-"});r(E.slice(0,10))}catch(i){console.error("Errore fetch ultimi ordini:",i),w(i.message||"Errore di caricamento")}finally{N(!1)}},[M,$]);l.useEffect(()=>{X()},[X]),l.useEffect(()=>{const i=()=>X();return window.addEventListener("order-paid",i),()=>window.removeEventListener("order-paid",i)},[X]);const W=async i=>{try{xe(!0),me(!0),setTimeout(()=>pe(!0),0);const f=await P(`${M}/ordine-prodotto/${i}`);Q(f)}catch(f){console.error("Errore recupero dettaglio ordine:",f),alert("Errore nel caricamento del dettaglio ordine")}finally{xe(!1)}},ee=()=>{pe(!1),setTimeout(()=>{me(!1),Q(null)},200)},se=l.useCallback(async(i=K)=>{if($){ue(!0),setTimeout(()=>ge(!0),0),H(""),q(!0);try{const f=(I?.agentenome||I?.name||"").toString(),[k,D]=i.split("-"),L=new URLSearchParams({year:k,month:D,...f?{agentenome:f}:{}}).toString();let E=await P(`${M}/ultimi-ordini-agente?${L}`),u=Array.isArray(E)?E:Array.isArray(E?.data)?E.data:[];if(console.log("[RecentOrders] Ordini ricevuti per",i,":",u.length),!u||u.length===0)try{E=await P(`${M}/ultimi-ordini?${L}`),u=Array.isArray(E)?E:Array.isArray(E?.data)?E.data:[]}catch{}const re=y=>typeof y=="number"?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(y):y??"-",Z=(y,le)=>{if(!y)return;const oe=Object.keys(y);for(const _ of le){const z=oe.find(ce=>_.test(ce));if(z&&y[z]!=null)return y[z]}},ne=(u||[]).map((y,le)=>{const oe=y.IDOrdine??y.IDOrdineProdotto??y.id??le,_=We(y.DataOraCompleta??y.DataOra??y.Data??y.createdAt??Z(y,[/^data/i,/data.?ordine/i,/created/i])),z=y.Dealer??y.RagioneSociale??y.OrdineDA??Z(y,[/dealer|ragione.?sociale|ordinato.?da/i])??"-",ce=y.Prodotto??y.Titolo??y.NomeProdotto??y.Inserimento??"-",Ae=y.TipoProdotto??y.Tipo??y.type??"-",Ie=re(y.Importo??y.ImportoTotale??y.amount),Oe=y.Stato??y.StatoEsteso??y.status??"-";return{id:oe,date:_,dealer:z,product:ce,type:Ae,amount:Ie,status:Oe}}).slice(0,100);console.log("[RecentOrders] Settando listRows con",ne.length,"elementi"),console.log("[RecentOrders] Primi 3:",ne.slice(0,3)),ae(ne)}catch(f){H(f?.message||"Errore nel caricamento")}finally{q(!1)}}},[M,$,I?.agentenome,I?.name,K]),te=()=>{ge(!1),setTimeout(()=>ue(!1),200),ae([]),H(""),q(!1)};return e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:"Ultimi Ordini"}),e.jsx("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",onClick:()=>{$&&se()},"aria-label":"Vedi tutti gli ordini",children:"Vedi tutti"})]}),p&&e.jsx("div",{className:"py-6 text-sm text-gray-500",children:"Caricamentoâ€¦"}),h&&!p&&e.jsx("div",{className:"py-6 text-sm text-red-600",children:h}),!p&&!h&&e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsxs("table",{className:"min-w-[760px] sm:min-w-full table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Data"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:$?"Dealer":"Prodotto"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Tipo"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Importo"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Stato"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-6 text-center text-sm text-gray-500",children:"Nessun ordine trovato"})}):x.map(i=>{const f=!!i.id;return e.jsxs("tr",{className:`hover:bg-gray-50 transition-colors ${f?"cursor-pointer":"cursor-default"}`,onClick:()=>f&&W(i.id),children:[e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 whitespace-nowrap",children:i.date}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 max-w-[220px] truncate",children:i.product}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-600 whitespace-nowrap",children:e.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap",children:i.type})}),e.jsx("td",{className:"py-2 px-2 text-sm font-semibold text-gray-900 whitespace-nowrap",children:i.amount}),e.jsx("td",{className:"py-2 px-2 text-sm whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap ${Ke(i.status)}`,children:i.status})})]},i.id??`${i.date}-${i.product}-${i.amount}`)})})]})}),we&&e.jsxs("div",{className:"fixed inset-0 z-40 flex items-center justify-center p-4",children:[e.jsx("div",{className:`absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-200 ${S?"opacity-100":"opacity-0"}`,onClick:te}),e.jsxs("div",{className:`relative bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden transition-all duration-200 ease-out transform ${S?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 translate-y-1"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Ordini Scuderia Agente"}),e.jsx("button",{onClick:te,className:"text-gray-400 hover:text-gray-600","aria-label":"Chiudi",children:"âœ•"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"month-filter",className:"text-sm text-gray-600",children:"Filtra per mese:"}),e.jsx("select",{id:"month-filter",value:K,onChange:i=>{J(i.target.value),se(i.target.value)},className:"px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:(()=>{const i=[],f=new Date;for(let k=0;k<12;k++){const D=new Date(f.getFullYear(),f.getMonth()-k,1),L=`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}`,E=D.toLocaleDateString("it-IT",{month:"long",year:"numeric"});i.push(e.jsx("option",{value:L,children:E.charAt(0).toUpperCase()+E.slice(1)},L))}return i})()})]})]}),e.jsxs("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:[Y&&e.jsx("div",{className:"space-y-2",children:[...Array(4)].map((i,f)=>e.jsx("div",{className:"h-5 bg-gray-100 rounded animate-pulse"},f))}),B&&!Y&&e.jsxs("div",{className:"text-sm text-red-600 flex items-center justify-between",children:[e.jsx("span",{children:B}),e.jsx("button",{onClick:se,className:"ml-3 px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs",children:"Riprova"})]}),!Y&&!B&&e.jsxs("div",{className:"overflow-x-auto",children:[console.log("[RecentOrders RENDER] listRows.length:",n.length,"listLoading:",Y,"listError:",B),e.jsxs("table",{className:"min-w-[880px] sm:min-w-full table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Data"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Dealer"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Prodotto"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Tipo"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Importo"}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Stato"}),e.jsx("th",{className:"py-2 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap",children:"Azione"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-6 text-center text-sm text-gray-500",children:"Nessun ordine trovato"})}):n.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 whitespace-nowrap",children:i.date}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-700 whitespace-nowrap",children:i.dealer}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-900 truncate max-w-[260px]",children:i.product}),e.jsx("td",{className:"py-2 px-2 text-sm text-gray-600 whitespace-nowrap",children:i.type}),e.jsx("td",{className:"py-2 px-2 text-sm font-semibold text-gray-900 whitespace-nowrap",children:i.amount}),e.jsx("td",{className:"py-2 px-2 text-sm whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${Ke(i.status)}`,children:i.status})}),e.jsx("td",{className:"py-2 px-2 text-sm whitespace-nowrap",children:i.id?e.jsx("button",{type:"button",className:"px-2 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-700",onClick:()=>{te(),W(i.id)},children:"Apri"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"â€”"})})]},(i.id??f)+""))})]})]})]}),e.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:e.jsx("button",{onClick:te,className:"px-3 py-1.5 text-sm rounded bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Chiudi"})})]})]}),Se&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:`absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-200 ${G?"opacity-100":"opacity-0"}`,onClick:ee}),e.jsxs("div",{className:`relative bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden transition-all duration-200 ease-out transform ${G?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 translate-y-1"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Dettaglio Ordine ",g?.IDOrdine?`#${g.IDOrdine}`:""]}),e.jsx("button",{onClick:ee,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:de?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"Caricamento dettagli..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Data ordine"}),e.jsx("div",{className:"text-sm text-gray-900",children:We(g.DataOra)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Stato"}),e.jsx("div",{className:"text-sm text-gray-900",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${Ke(g.StatoEsteso)}`,children:g.StatoEsteso||"-"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Importo totale"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:typeof g.ImportoTotale=="number"?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(g.ImportoTotale):g.ImportoTotale||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Metodo pagamento"}),e.jsx("div",{className:"text-sm text-gray-900",children:g.MetodoPagamento||"-"})]})]}),Array.isArray(g.Prodotti)&&g.Prodotti.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Prodotti"}),e.jsx("div",{className:"border border-gray-100 rounded",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-600",children:[e.jsx("th",{className:"text-left px-2 py-1",children:"Prodotto"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Tipo"}),e.jsx("th",{className:"text-left px-2 py-1",children:"QuantitÃ "}),e.jsx("th",{className:"text-left px-2 py-1",children:"Prezzo Unitario"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Totale"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:g.Prodotti.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1",children:i.Titolo||i.Nome||"-"}),e.jsx("td",{className:"px-2 py-1",children:i.Tipo||"-"}),e.jsx("td",{className:"px-2 py-1",children:i.Quantita||1}),e.jsx("td",{className:"px-2 py-1",children:typeof i.PrezzoUnitario=="number"?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(i.PrezzoUnitario):i.CostoUnitario?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(i.CostoUnitario):"-"}),e.jsx("td",{className:"px-2 py-1",children:typeof i.PrezzoUnitario=="number"&&typeof i.Quantita=="number"?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(i.PrezzoUnitario*i.Quantita):i.CostoUnitario&&i.Quantita?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(i.CostoUnitario*i.Quantita):"-"})]},f))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Informazioni aggiuntive"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Ordinato da"}),e.jsx("div",{className:"text-gray-800",children:g.OrdineDA||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Stato spedizione"}),e.jsx("div",{className:"text-gray-800",children:g.stato_spedizione||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Spese spedizione"}),e.jsx("div",{className:"text-gray-800",children:typeof g.SpeseSpedizione=="number"?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(g.SpeseSpedizione):g.SpeseSpedizione||"0,00 â‚¬"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Totale ordine"}),e.jsx("div",{className:"text-gray-800",children:typeof g.TotaleOrdine=="number"?new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(g.TotaleOrdine):g.TotaleOrdine||"-"})]})]})]}),(g.NoteOrdine||g.Note4Dealer||g.NoteInterne)&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Note"}),e.jsxs("div",{className:"text-sm text-gray-800 bg-gray-50 p-3 rounded space-y-2",children:[g.NoteOrdine&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Note ordine:"}),e.jsx("div",{children:g.NoteOrdine})]}),g.Note4Dealer&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Note per dealer:"}),e.jsx("div",{children:g.Note4Dealer})]}),g.NoteInterne&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600",children:"Note interne:"}),e.jsx("div",{children:g.NoteInterne})]})]})]})]})}),e.jsx("div",{className:"p-3 border-t border-gray-100 flex justify-end",children:e.jsx("button",{onClick:ee,className:"px-3 py-1.5 text-sm rounded bg-gray-100 hover:bg-gray-200 text-gray-700",children:"Chiudi"})})]})]})]})}export{Tt as R,Et as a};
